!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.SRE=e():t.SRE=e()}(this,(()=>(()=>{"use strict";var __webpack_modules__={460:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _variables_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(507);class SystemExternal{static extRequire(library){if("undefined"!=typeof process&&"undefined"!=typeof require){const nodeRequire=eval("require");return nodeRequire(library)}return null}}SystemExternal.windowSupported=!("undefined"==typeof window),SystemExternal.documentSupported=SystemExternal.windowSupported&&!(void 0===window.document),SystemExternal.xmldom=SystemExternal.documentSupported?window:SystemExternal.extRequire("xmldom-sre"),SystemExternal.document=SystemExternal.documentSupported?window.document:(new SystemExternal.xmldom.DOMImplementation).createDocument("","",0),SystemExternal.xpath=SystemExternal.documentSupported?document:function(){const t={document:{},XPathResult:{}};return SystemExternal.extRequire("wicked-good-xpath").install(t),t.document.XPathResult=t.XPathResult,t.document}(),SystemExternal.mathmapsIePath="https://cdn.jsdelivr.net/npm/sre-mathmaps-ie@"+_variables_js__WEBPACK_IMPORTED_MODULE_0__.L.VERSION+"mathmaps_ie.js",SystemExternal.commander=SystemExternal.documentSupported?null:SystemExternal.extRequire("commander"),SystemExternal.fs=SystemExternal.documentSupported?null:SystemExternal.extRequire("fs"),SystemExternal.url=_variables_js__WEBPACK_IMPORTED_MODULE_0__.L.url,SystemExternal.jsonPath=(SystemExternal.documentSupported?SystemExternal.url:process.env.SRE_JSON_PATH||global.SRE_JSON_PATH||("undefined"!=typeof __dirname?__dirname+"/mathmaps":process.cwd()))+"/",SystemExternal.WGXpath=_variables_js__WEBPACK_IMPORTED_MODULE_0__.L.WGXpath,SystemExternal.wgxpath=null;const __WEBPACK_DEFAULT_EXPORT__=SystemExternal},507:(t,e,n)=>{n.d(e,{L:()=>r});class r{static ensureLocale(t,e){return r.LOCALES.get(t)?t:(console.error(`Locale ${t} does not exist! Using ${r.LOCALES.get(e)} instead.`),e)}}r.VERSION="4.1.0-beta.5",r.LOCALES=new Map([["ca","Catalan"],["da","Danish"],["de","German"],["en","English"],["es","Spanish"],["euro","Euro"],["fr","French"],["hi","Hindi"],["it","Italian"],["nb","Bokm\xe5l"],["nn","Nynorsk"],["sv","Swedish"],["nemeth","Nemeth"]]),r.mathjaxVersion="3.2.1",r.url="https://cdn.jsdelivr.net/npm/speech-rule-engine@"+r.VERSION+"/lib/mathmaps",r.WGXpath="https://cdn.jsdelivr.net/npm/wicked-good-xpath@1.3.0/dist/wgxpath.install.js"}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var n=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t](n,n.exports,__webpack_require__),n.exports}__webpack_require__.d=(t,e)=>{for(var n in e)__webpack_require__.o(e,n)&&!__webpack_require__.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var __webpack_exports__={};return(()=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{cli:()=>lu,engineReady:()=>Hl,engineSetup:()=>Vl,exit:()=>iu,file:()=>nu,localeLoader:()=>Yl,localePath:()=>cu,move:()=>ou,number:()=>Zl,numericOrdinal:()=>Ql,ordinal:()=>Jl,processFile:()=>ru,setupEngine:()=>Gl,toDescription:()=>Kl,toEnriched:()=>zl,toJson:()=>Xl,toSemantic:()=>Wl,toSpeech:()=>ql,variables:()=>uu,version:()=>$l,vulgar:()=>tu,walk:()=>su});var t,e,n,r={};__webpack_require__.r(r),__webpack_require__.d(r,{engineReady:()=>Hl,engineSetup:()=>Vl,exit:()=>iu,file:()=>nu,localeLoader:()=>Yl,localePath:()=>cu,move:()=>ou,number:()=>Zl,numericOrdinal:()=>Ql,ordinal:()=>Jl,processFile:()=>ru,setupEngine:()=>Gl,toDescription:()=>Kl,toEnriched:()=>zl,toJson:()=>Xl,toSemantic:()=>Wl,toSpeech:()=>ql,version:()=>$l,vulgar:()=>tu,walk:()=>su}),function(t){t.DOMAIN="domain",t.STYLE="style",t.LOCALE="locale",t.TOPIC="topic",t.MODALITY="modality"}(t||(t={}));class s{static createProp(...t){const e=o.DEFAULT_ORDER,n={};for(let r=0,s=t.length,o=e.length;r<s&&r<o;r++)n[e[r]]=t[r];return new s(n)}constructor(t,e=Object.keys(t)){this.properties=t,this.order=e}getProperties(){return this.properties}getOrder(){return this.order}getAxes(){return this.order}getProperty(t){return this.properties[t]}updateProperties(t){this.properties=t}allProperties(){const t=[];return this.order.forEach((e=>t.push(this.getProperty(e).slice()))),t}toString(){const t=[];return this.order.forEach((e=>t.push(e+": "+this.getProperty(e).toString()))),t.join("\n")}}class o extends s{static createCstr(...t){const e=o.DEFAULT_ORDER,n={};for(let r=0,s=t.length,o=e.length;r<s&&r<o;r++)n[e[r]]=t[r];return new o(n)}static defaultCstr(){return o.createCstr.apply(null,o.DEFAULT_ORDER.map((function(t){return o.DEFAULT_VALUES[t]})))}static validOrder(t){const e=o.DEFAULT_ORDER.slice();return t.every((t=>{const n=e.indexOf(t);return-1!==n&&e.splice(n,1)}))}constructor(t,e){const n={};for(const[e,r]of Object.entries(t))n[e]=[r];super(n,e),this.components=t}getComponents(){return this.components}getValue(t){return this.components[t]}getValues(){return this.order.map((t=>this.getValue(t)))}allProperties(){const t=super.allProperties();for(let e,n,r=0;e=t[r],n=this.order[r];r++){const t=this.getValue(n);-1===e.indexOf(t)&&e.unshift(t)}return t}toString(){return this.getValues().join(".")}equal(t){const e=t.getAxes();if(this.order.length!==e.length)return!1;for(let n,r=0;n=e[r];r++){const e=this.getValue(n);if(!e||t.getValue(n)!==e)return!1}return!0}}o.DEFAULT_ORDER=[t.LOCALE,t.MODALITY,t.DOMAIN,t.STYLE,t.TOPIC],o.BASE_LOCALE="base",o.DEFAULT_VALUE="default",o.DEFAULT_VALUES={[t.LOCALE]:"en",[t.DOMAIN]:o.DEFAULT_VALUE,[t.STYLE]:o.DEFAULT_VALUE,[t.TOPIC]:o.DEFAULT_VALUE,[t.MODALITY]:"speech"};class i{constructor(t){this.order=t}parse(t){const e=t.split("."),n={};if(e.length>this.order.length)throw new Error("Invalid dynamic constraint: "+n);let r=0;for(let t,s=0;t=this.order[s],e.length;s++,r++){const r=e.shift();n[t]=r}return new o(n,this.order.slice(0,r))}}class c{constructor(t,e=new s(t.getProperties(),t.getOrder())){this.reference=t,this.fallback=e,this.order=this.reference.getOrder()}getReference(){return this.reference}setReference(t,e){this.reference=t,this.fallback=e||new s(t.getProperties(),t.getOrder()),this.order=this.reference.getOrder()}match(t){const e=t.getAxes();return e.length===this.reference.getAxes().length&&e.every((e=>{const n=t.getValue(e);return n===this.reference.getValue(e)||-1!==this.fallback.getProperty(e).indexOf(n)}))}compare(t,e){let n=!1;for(let r,s=0;r=this.order[s];s++){const s=t.getValue(r),o=e.getValue(r);if(!n){const t=this.reference.getValue(r);if(t===s&&t!==o)return-1;if(t===o&&t!==s)return 1;if(t===s&&t===o)continue;t!==s&&t!==o&&(n=!0)}const i=this.fallback.getProperty(r),c=i.indexOf(s),a=i.indexOf(o);if(c<a)return-1;if(a<c)return 1}return 0}toString(){return this.reference.toString()+"\n"+this.fallback.toString()}}!function(t){t.SYNC="sync",t.ASYNC="async",t.HTTP="http"}(e||(e={})),function(t){t.PITCH="pitch",t.RATE="rate",t.VOLUME="volume",t.PAUSE="pause",t.JOIN="join",t.LAYOUT="layout"}(n||(n={}));const a=[n.PITCH,n.RATE,n.VOLUME,n.PAUSE,n.JOIN];var l,u;!function(t){t.NONE="none",t.SHALLOW="shallow",t.DEEP="deep"}(l||(l={})),function(t){t.NONE="none",t.LAYOUT="layout",t.PUNCTUATION="punctuation",t.SSML="ssml",t.ACSS="acss",t.SABLE="sable",t.VOICEXML="voicexml"}(u||(u={}));const h={mathspeak:"default",clearspeak:"default"};var d=__webpack_require__(460);class p{static getInstance(){return p.instance=p.instance||new p,p.instance}init(t){return t&&this.startDebugFile_(t),this.isActive_=!0,this.fileHandle}output(...t){this.isActive_&&this.output_(t)}generateOutput(t){this.isActive_&&this.output_(t.apply(t,[]))}exit(t=(()=>{})){this.fileHandle.then((()=>{this.isActive_&&this.stream_&&this.stream_.end("","",t)}))}constructor(){this.isActive_=!1,this.outputFunction_=console.info,this.fileHandle=Promise.resolve(),this.stream_=null}startDebugFile_(t){this.fileHandle=d.Z.fs.promises.open(t,"w"),this.fileHandle=this.fileHandle.then((e=>{this.stream_=e.createWriteStream(t),this.outputFunction_=function(...t){this.stream_.write(t.join(" ")),this.stream_.write("\n")}.bind(this),this.stream_.on("error",function(t){console.info("Invalid log file. Debug information sent to console."),this.outputFunction_=console.info}.bind(this)),this.stream_.on("finish",(function(){console.info("Finalizing debug file.")}))}))}output_(t){console.info!==this.outputFunction_?this.fileHandle.then((()=>this.outputFunction_.apply(this.outputFunction_,["Speech Rule Engine Debugger:"].concat(t)))):this.outputFunction_.apply(console,["Speech Rule Engine Debugger:"].concat(t))}}var f=__webpack_require__(507);class m extends Error{constructor(t=""){super(),this.message=t,this.name="SRE Error"}}class g{set defaultLocale(t){this._defaultLocale=f.L.ensureLocale(t,this._defaultLocale)}get defaultLocale(){return this._defaultLocale}static getInstance(){return g.instance=g.instance||new g,g.instance}static defaultEvaluator(t,e){return t}static evaluateNode(t){return g.nodeEvaluator(t)}getRate(){const t=parseInt(this.rate,10);return isNaN(t)?100:t}setDynamicCstr(e){if(this.defaultLocale&&(o.DEFAULT_VALUES[t.LOCALE]=this.defaultLocale),e){const t=Object.keys(e);for(let n=0;n<t.length;n++){const r=t[n];if(-1!==o.DEFAULT_ORDER.indexOf(r)){const t=e[r];this[r]=t}}}h[this.domain]=this.style;const n=[this.locale,this.modality,this.domain,this.style].join("."),r=s.createProp([o.DEFAULT_VALUES[t.LOCALE]],[o.DEFAULT_VALUES[t.MODALITY]],[o.DEFAULT_VALUES[t.DOMAIN]],[o.DEFAULT_VALUES[t.STYLE]]),i=this.comparators[this.domain],a=this.parsers[this.domain];this.parser=a||this.defaultParser,this.dynamicCstr=this.parser.parse(n),this.dynamicCstr.updateProperties(r.getProperties()),this.comparator=i?i():new c(this.dynamicCstr)}constructor(){this.customLoader=null,this.parsers={},this.comparator=null,this.mode=e.SYNC,this.init=!0,this.delay=!1,this.comparators={},this.domain="mathspeak",this.style=o.DEFAULT_VALUES[t.STYLE],this._defaultLocale=o.DEFAULT_VALUES[t.LOCALE],this.locale=this.defaultLocale,this.subiso="",this.modality=o.DEFAULT_VALUES[t.MODALITY],this.speech=l.NONE,this.markup=u.NONE,this.mark=!0,this.automark=!1,this.character=!0,this.cleanpause=!0,this.rate="100",this.walker="Table",this.structure=!1,this.aria=!1,this.ruleSets=[],this.strict=!1,this.isIE=!1,this.isEdge=!1,this.pprint=!1,this.config=!1,this.rules="",this.prune="",this.evaluator=g.defaultEvaluator,this.defaultParser=new i(o.DEFAULT_ORDER),this.parser=this.defaultParser,this.dynamicCstr=o.defaultCstr()}configurate(t){this.mode!==e.HTTP||this.config||(!function(t){const e=document.documentElement.querySelectorAll('script[type="text/x-sre-config"]');for(let n=0,r=e.length;n<r;n++){let r;try{r=e[n].innerHTML;const s=JSON.parse(r);for(const[e,n]of Object.entries(s))t[e]=n}catch(t){p.getInstance().output("Illegal configuration ",r)}}}(t),this.config=!0),function(t){if("undefined"!=typeof SREfeature)for(const[e,n]of Object.entries(SREfeature))t[e]=n}(t)}setCustomLoader(t){t&&(this.customLoader=t)}}g.BINARY_FEATURES=["automark","mark","character","cleanpause","strict","structure","aria","pprint"],g.STRING_FEATURES=["markup","style","domain","speech","walker","defaultLocale","locale","delay","modality","rate","rules","subiso","prune"],g.nodeEvaluator=function(t){return[]};const N=g;class S{static get(t=g.getInstance().locale){return S.promises[t]||Promise.resolve("")}static getall(){return Promise.all(Object.values(S.promises))}}function E(){return"undefined"!=typeof XPathResult}S.loaded={},S.promises={};const b={currentDocument:null,evaluate:E()?document.evaluate:d.Z.xpath.evaluate,result:E()?XPathResult:d.Z.xpath.XPathResult,createNSResolver:E()?document.createNSResolver:d.Z.xpath.createNSResolver},A={xhtml:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",mml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function y(t){return A[t]||null}class T{constructor(){this.lookupNamespaceURI=y}}function _(t,n,r){return N.getInstance().mode!==e.HTTP||N.getInstance().isIE||N.getInstance().isEdge?b.evaluate(t,n,new T,r,null):b.currentDocument.evaluate(t,n,y,r,null)}function I(t,e){let n;try{n=_(t,e,b.result.ORDERED_NODE_ITERATOR_TYPE)}catch(t){return[]}const r=[];for(let t=n.iterateNext();t;t=n.iterateNext())r.push(t);return r}function C(t){if(N.getInstance().mode!==e.HTTP)return;let n=t;for(;n&&!n.evaluate;)n=n.parentNode;n&&n.evaluate?b.currentDocument=n:t.ownerDocument&&(b.currentDocument=t.ownerDocument)}function O(t){const e=[];for(let n=0,r=t.length;n<r;n++)e.push(t[n]);return e}function x(t){const n=new d.Z.xmldom.DOMParser,r=function(t){return(t=t.replace(/&nbsp;/g,"\xa0")).replace(/>[ \f\n\r\t\v\u200b]+</g,"><").trim()}(t),s=!!r.match(/&(?!lt|gt|amp|quot|apos)\w+;/g);if(!r)throw new Error("Empty input!");try{const t=n.parseFromString(r,s?"text/html":"text/xml");return N.getInstance().mode===e.HTTP?(b.currentDocument=t,s?t.body.childNodes[0]:t.documentElement):t.documentElement}catch(t){throw new m("Illegal input: "+t.message)}}var L;function M(t,e){t.parentNode&&(t.parentNode.insertBefore(e,t),t.parentNode.removeChild(t))}function R(t){return d.Z.document.createElement(t)}function v(t,e){return d.Z.document.createElementNS(t,e)}function F(t){let e="",n=/(>)(<)(\/*)/g,r=0,s=(t=t.replace(n,"$1\r\n$2$3")).split("\r\n");for(n=/(\.)*(<)(\/*)/g,s=s.map((t=>t.replace(n,"$1\r\n$2$3").split("\r\n"))).reduce(((t,e)=>t.concat(e)),[]);s.length;){let t=s.shift();if(!t)continue;let n=0;if(t.match(/^<\w[^>/]*>[^>]+$/)){const e=w(t,s[0]);e[0]?e[1]?(t+=s.shift().slice(0,-e[1].length),e[1].trim()&&s.unshift(e[1])):t+=s.shift():n=1}else if(t.match(/^<\/\w/))0!==r&&(r-=1);else if(t.match(/^<\w[^>]*[^/]>.*$/))n=1;else if(t.match(/^<\w[^>]*\/>.+$/)){const e=t.indexOf(">")+1,n=t.slice(e);n.trim()&&s.unshift(),t=t.slice(0,e)+n}else n=0;e+=new Array(r+1).join("  ")+t+"\r\n",r+=n}return e}function w(t,e){if(!e)return[!1,""];const n=t.match(/^<([^> ]+).*>/),r=e.match(/^<\/([^>]+)>(.*)/);return n&&r&&n[1]===r[1]?[!0,r[2]]:[!1,""]}function D(t,e,n){return t.querySelectorAll?O(t.querySelectorAll(`[${e}="${n}"]`)):I(`.//*[@${e}="${n}"]`,t)}function P(t,e){return t.querySelectorAll?O(t.querySelectorAll(e)):I(`.//${e}`,t)}function k(t){return t.tagName.toUpperCase()}function U(t){return t.cloneNode(!0)}function B(t){return(new d.Z.xmldom.XMLSerializer).serializeToString(t)}function j(t,e){return t.toString()}function $(t){return t.toString()}function G(t,e){return t+e.toLowerCase()}!function(t){t[t.ELEMENT_NODE=1]="ELEMENT_NODE",t[t.ATTRIBUTE_NODE=2]="ATTRIBUTE_NODE",t[t.TEXT_NODE=3]="TEXT_NODE",t[t.CDATA_SECTION_NODE=4]="CDATA_SECTION_NODE",t[t.ENTITY_REFERENCE_NODE=5]="ENTITY_REFERENCE_NODE",t[t.ENTITY_NODE=6]="ENTITY_NODE",t[t.PROCESSING_INSTRUCTION_NODE=7]="PROCESSING_INSTRUCTION_NODE",t[t.COMMENT_NODE=8]="COMMENT_NODE",t[t.DOCUMENT_NODE=9]="DOCUMENT_NODE",t[t.DOCUMENT_TYPE_NODE=10]="DOCUMENT_TYPE_NODE",t[t.DOCUMENT_FRAGMENT_NODE=11]="DOCUMENT_FRAGMENT_NODE",t[t.NOTATION_NODE=12]="NOTATION_NODE"}(L||(L={}));const V={};function H(t,e=""){if(!t.childNodes||!t.childNodes[0]||!t.childNodes[0].childNodes||t.childNodes[0].childNodes.length<2||"number"!==t.childNodes[0].childNodes[0].tagName||"integer"!==t.childNodes[0].childNodes[0].getAttribute("role")||"number"!==t.childNodes[0].childNodes[1].tagName||"integer"!==t.childNodes[0].childNodes[1].getAttribute("role"))return{convertible:!1,content:t.textContent};const n=t.childNodes[0].childNodes[1].textContent,r=t.childNodes[0].childNodes[0].textContent,s=Number(n),o=Number(r);return isNaN(s)||isNaN(o)?{convertible:!1,content:`${r} ${e} ${n}`}:{convertible:!0,enumerator:o,denominator:s}}function Y(t,e,n){const r=H(t);if(r.convertible){const t=r.enumerator,s=r.denominator;return t>0&&t<e&&s>0&&s<n}return!1}function q(){return{zero:"zero",ones:[],tens:[],large:[],special:{},wordOrdinal:$,numericOrdinal:$,numberToWords:$,numberToOrdinal:j,vulgarSep:" ",numSep:" "}}V.identityCombiner=function(t,e,n){return t+e+n},V.prefixCombiner=function(t,e,n){return t=n?n+" "+t:t,e?e+" "+t:t},V.postfixCombiner=function(t,e,n){return t=n?n+" "+t:t,e?t+" "+e:t},V.romanceCombiner=function(t,e,n){return t=n?t+" "+n:t,e?t+" "+e:t};const W=X();function X(){return{FUNCTIONS:{fracNestDepth:t=>Y(t,10,100),radicalNestDepth:t=>"",combineRootIndex:function(t,e){return t},combineNestedFraction:V.identityCombiner,combineNestedRadical:V.identityCombiner,fontRegexp:function(t){return new RegExp("^"+t.split(/ |-/).join("( |-)")+"( |-)")},si:G,plural:$},MESSAGES:{MS:{},MSroots:{},font:{},embellish:{},role:{},enclose:{},navigate:{},regexp:{},unitTimes:""},ALPHABETS:{latinSmall:[],latinCap:[],greekSmall:[],greekCap:[],capPrefix:{default:""},smallPrefix:{default:""},digitPrefix:{default:""},languagePrefix:{},digitTrans:{default:$,mathspeak:$,clearspeak:$},letterTrans:{default:$},combiner:(t,e,n)=>t},NUMBERS:q(),COMBINERS:{},CORRECTIONS:{},SUBISO:{default:"",current:"",all:[]}}}function K(t){switch(t){case 1:return W.MESSAGES.MS.ONCE||"";case 2:return W.MESSAGES.MS.TWICE;default:return t.toString()}}function z(t,e){return t===W.MESSAGES.MS.ROOTINDEX||t===W.MESSAGES.MS.INDEX?t:t+" "+e}function Z(t){return J(W.MESSAGES.font[t],t)}function J(t,e){return void 0===t?e:"string"==typeof t?t:t[0]}const Q="grammar";class tt{static getInstance(){return tt.instance=tt.instance||new tt,tt.instance}static parseInput(t){const e={},n=t.split(":");for(const t of n){const n=t.split("="),r=n[0].trim();n[1]?e[r]=n[1].trim():r.match(/^!/)?e[r.slice(1)]=!1:e[r]=!0}return e}static parseState(t){const e={},n=t.split(" ");for(const t of n){const n=t.split(":"),r=n[0],s=n[1];e[r]=s||!0}return e}static translateString(t){if(t.match(/:unit$/))return tt.translateUnit(t);const e=N.getInstance();let n=e.evaluator(t,e.dynamicCstr);return n=null===n?t:n,tt.getInstance().getParameter("plural")&&(n=W.FUNCTIONS.plural(n)),n}static translateUnit(t){t=tt.prepareUnit(t);const e=N.getInstance(),n=tt.getInstance().getParameter("plural"),r=e.strict,s=`${e.locale}.${e.modality}.default`;let o,i;return e.strict=!0,n&&(o=e.defaultParser.parse(s+".plural"),i=e.evaluator(t,o)),i?(e.strict=r,i):(o=e.defaultParser.parse(s+".default"),i=e.evaluator(t,o),e.strict=r,i?(n&&(i=W.FUNCTIONS.plural(i)),i):tt.cleanUnit(t))}static prepareUnit(t){const e=t.match(/:unit$/);return e?t.slice(0,e.index).replace(/\s+/g," ")+t.slice(e.index):t}static cleanUnit(t){return t.match(/:unit$/)?t.replace(/:unit$/,""):t}clear(){this.parameters_={},this.stateStack_=[]}setParameter(t,e){const n=this.parameters_[t];return e?this.parameters_[t]=e:delete this.parameters_[t],n}getParameter(t){return this.parameters_[t]}setCorrection(t,e){this.corrections_[t]=e}setPreprocessor(t,e){this.preprocessors_[t]=e}getCorrection(t){return this.corrections_[t]}getState(){const t=[];for(const[e,n]of Object.entries(this.parameters_))t.push("string"==typeof n?e+":"+n:e);return t.join(" ")}processSingles(){const t={};for(const e of this.singles)t[e]=!1;this.singles=[],this.pushState(t)}pushState(t){for(let[e,n]of Object.entries(t))e.match(/^\?/)&&(delete t[e],e=e.slice(1),this.singles.push(e)),t[e]=this.setParameter(e,n);this.stateStack_.push(t)}popState(){const t=this.stateStack_.pop();for(const[e,n]of Object.entries(t))this.setParameter(e,n)}setAttribute(t){if(t&&t.nodeType===L.ELEMENT_NODE){const e=this.getState();e&&t.setAttribute(Q,e)}}preprocess(t){return this.runProcessors(t,this.preprocessors_)}correct(t){return this.runProcessors(t,this.corrections_)}apply(t,e){return this.currentFlags=e||{},t=this.currentFlags.adjust||this.currentFlags.preprocess?tt.getInstance().preprocess(t):t,(this.parameters_.translate||this.currentFlags.translate)&&(t=tt.translateString(t)),t=this.currentFlags.adjust||this.currentFlags.correct?tt.getInstance().correct(t):t,this.currentFlags={},t}runProcessors(t,e){for(const[n,r]of Object.entries(this.parameters_)){const s=e[n];s&&(t=!0===r?s(t):s(t,r))}return t}constructor(){this.currentFlags={},this.parameters_={},this.corrections_={},this.preprocessors_={},this.stateStack_=[],this.singles=[]}}function et(t,e){if(!e||!t)return t;const n=W.FUNCTIONS.fontRegexp(Z(e));return t.replace(n,"")}function nt(t){const e=t%1e3,n=Math.floor(e/100),r=n?1===n?"cent":ot.ones[n]+"-cents":"",s=function(t){const e=t%100;if(e<20)return ot.ones[e];const n=Math.floor(e/10),r=ot.tens[n],s=ot.ones[e%10];return r&&s?r+(2===n?"-i-":"-")+s:r||s}(e%100);return r&&s?r+ot.numSep+s:r||s}function rt(t){if(0===t)return ot.zero;if(t>=Math.pow(10,36))return t.toString();let e=0,n="";for(;t>0;){const r=t%(e>1?1e6:1e3);if(r){let t=ot.large[e];if(e)if(1===e)n=(1===r?"":nt(r)+ot.numSep)+t+(n?ot.numSep+n:"");else{const e=rt(r);t=1===r?t:t.replace(/\u00f3$/,"ons"),n=e+ot.numSep+t+(n?ot.numSep+n:"")}else n=nt(r)}t=Math.floor(t/(e>1?1e6:1e3)),e++}return n}function st(t){const e=tt.getInstance().getParameter("gender");return t.toString()+("f"===e?"a":"n")}tt.getInstance().setCorrection("localFont",Z),tt.getInstance().setCorrection("localRole",(function(t){return J(W.MESSAGES.role[t],t)})),tt.getInstance().setCorrection("localEnclose",(function(t){return J(W.MESSAGES.enclose[t],t)})),tt.getInstance().setCorrection("ignoreFont",et),tt.getInstance().setPreprocessor("annotation",(function(t,e){return t+":"+e})),tt.getInstance().setPreprocessor("noTranslateText",(function(t){return t.match(new RegExp("^["+W.MESSAGES.regexp.TEXT+"]+$"))&&(tt.getInstance().currentFlags.translate=!1),t})),tt.getInstance().setCorrection("ignoreCaps",(function(t){let e=W.ALPHABETS.capPrefix[N.getInstance().domain];return void 0===e&&(e=W.ALPHABETS.capPrefix.default),et(t,e)})),tt.getInstance().setPreprocessor("numbers2alpha",(function(t){return t.match(/\d+/)?W.NUMBERS.numberToWords(parseInt(t,10)):t}));const ot=q();ot.numericOrdinal=st,ot.numberToWords=rt,ot.numberToOrdinal=function(t,e){if(t>1999)return st(t);if(t<=10)return ot.special.onesOrdinals[t-1];const n=rt(t);return n.match(/mil$/)?n.replace(/mil$/,"mil\xb7l\xe8sima"):n.match(/u$/)?n.replace(/u$/,"vena"):n.match(/a$/)?n.replace(/a$/,"ena"):n+(n.match(/e$/)?"na":"ena")};const it=ot,ct=function(t,e,n){return t="sans serif "+(n?n+" "+t:t),e?t+" "+e:t};let at=null;function lt(t,e=!1){return t===pt.ones[1]?e?"et":"en":t}function ut(t,e=!1){let n=t%1e3,r="",s=pt.ones[Math.floor(n/100)];if(r+=s?lt(s,!0)+" hundrede":"",n%=100,n)if(r+=r?" og ":"",s=e?pt.special.smallOrdinals[n]:pt.ones[n],s)r+=s;else{const t=e?pt.special.tensOrdinals[Math.floor(n/10)]:pt.tens[Math.floor(n/10)];s=pt.ones[n%10],r+=s?lt(s)+"og"+t:t}return r}function ht(t,e=!1){if(0===t)return pt.zero;if(t>=Math.pow(10,36))return t.toString();let n=0,r="";for(;t>0;){const s=t%1e3;if(s){const t=ut(s,e&&!n);if(n){const e=pt.large[n],o=s>1?"er":"";r=lt(t,n<=1)+" "+e+o+(r?" og ":"")+r}else r=lt(t)+r}t=Math.floor(t/1e3),n++}return r}function dt(t){if(t%100)return ht(t,!0);const e=ht(t);return e.match(/e$/)?e:e+"e"}const pt=q();pt.wordOrdinal=dt,pt.numericOrdinal=function(t){return t.toString()+"."},pt.numberToWords=ht,pt.numberToOrdinal=function(t,e){return 1===t?e?"hel":"hele":2===t?e?"halv":"halve":dt(t)+(e?"dele":"del")};const ft=pt;let mt=null;function gt(t,e=!1){return t===bt.ones[1]?e?"eine":"ein":t}function Nt(t){let e=t%1e3,n="",r=bt.ones[Math.floor(e/100)];if(n+=r?gt(r)+"hundert":"",e%=100,e)if(n+=n?bt.numSep:"",r=bt.ones[e],r)n+=r;else{const t=bt.tens[Math.floor(e/10)];r=bt.ones[e%10],n+=r?gt(r)+"und"+t:t}return n}function St(t){if(0===t)return bt.zero;if(t>=Math.pow(10,36))return t.toString();let e=0,n="";for(;t>0;){const r=t%1e3;if(r){const s=Nt(t%1e3);if(e){const t=bt.large[e],o=e>1&&r>1?t.match(/e$/)?"n":"en":"";n=gt(s,e>1)+t+o+n}else n=gt(s,e>1)+n}t=Math.floor(t/1e3),e++}return n.replace(/ein$/,"eins")}function Et(t){if(1===t)return"erste";if(3===t)return"dritte";if(7===t)return"siebte";if(8===t)return"achte";return St(t)+(t<19?"te":"ste")}const bt=q();bt.wordOrdinal=Et,bt.numericOrdinal=function(t){return t.toString()+"."},bt.numberToWords=St,bt.numberToOrdinal=function(t,e){return 1===t?"eintel":2===t?e?"halbe":"halb":Et(t)+"l"};const At=bt,yt=function(t,e,n){return"s"===n&&(e=e.split(" ").map((function(t){return t.replace(/s$/,"")})).join(" "),n=""),t=n?n+" "+t:t,e?e+" "+t:t},Tt=function(t,e,n){return t=n&&"s"!==n?n+" "+t:t,e?t+" "+e:t};let _t=null;function It(t){let e=t%1e3,n="";return n+=xt.ones[Math.floor(e/100)]?xt.ones[Math.floor(e/100)]+xt.numSep+"hundred":"",e%=100,e&&(n+=n?xt.numSep:"",n+=xt.ones[e]||xt.tens[Math.floor(e/10)]+(e%10?xt.numSep+xt.ones[e%10]:"")),n}function Ct(t){if(0===t)return xt.zero;if(t>=Math.pow(10,36))return t.toString();let e=0,n="";for(;t>0;){t%1e3&&(n=It(t%1e3)+(e?"-"+xt.large[e]+"-":"")+n),t=Math.floor(t/1e3),e++}return n.replace(/-$/,"")}function Ot(t){let e=Ct(t);return e.match(/one$/)?e=e.slice(0,-3)+"first":e.match(/two$/)?e=e.slice(0,-3)+"second":e.match(/three$/)?e=e.slice(0,-5)+"third":e.match(/five$/)?e=e.slice(0,-4)+"fifth":e.match(/eight$/)?e=e.slice(0,-5)+"eighth":e.match(/nine$/)?e=e.slice(0,-4)+"ninth":e.match(/twelve$/)?e=e.slice(0,-6)+"twelfth":e.match(/ty$/)?e=e.slice(0,-2)+"tieth":e+="th",e}const xt=q();xt.wordOrdinal=Ot,xt.numericOrdinal=function(t){const e=t%100,n=t.toString();if(e>10&&e<20)return n+"th";switch(t%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd";default:return n+"th"}},xt.numberToWords=Ct,xt.numberToOrdinal=function(t,e){if(1===t)return e?"oneths":"oneth";if(2===t)return e?"halves":"half";const n=Ot(t);return e?n+"s":n};const Lt=xt;let Mt=null;function Rt(t){const e=t%1e3,n=Math.floor(e/100),r=vt.special.hundreds[n],s=function(t){const e=t%100;if(e<30)return vt.ones[e];const n=vt.tens[Math.floor(e/10)],r=vt.ones[e%10];return n&&r?n+" y "+r:n||r}(e%100);return 1===n?s?r+"to "+s:r:r&&s?r+" "+s:r||s}const vt=q();vt.numericOrdinal=function(t){const e=tt.getInstance().getParameter("gender");return t.toString()+("f"===e?"a":"o")},vt.numberToWords=function(t){if(0===t)return vt.zero;if(t>=Math.pow(10,36))return t.toString();let e=0,n="";for(;t>0;){const r=t%1e3;if(r){let t=vt.large[e];const s=Rt(r);e?1===r?(t=t.match("/^mil( |$)/")?t:"un "+t,n=t+(n?" "+n:"")):(t=t.replace(/\u00f3n$/,"ones"),n=Rt(r)+" "+t+(n?" "+n:"")):n=s}t=Math.floor(t/1e3),e++}return n},vt.numberToOrdinal=function(t,e){if(t>1999)return t.toString()+"a";if(t<=12)return vt.special.onesOrdinals[t-1];const n=[];if(t>=1e3&&(t-=1e3,n.push("mil\xe9sima")),!t)return n.join(" ");let r=0;return r=Math.floor(t/100),r>0&&(n.push(vt.special.hundredsOrdinals[r-1]),t%=100),t<=12?n.push(vt.special.onesOrdinals[t-1]):(r=Math.floor(t/10),r>0&&(n.push(vt.special.tensOrdinals[r-1]),t%=10),t>0&&n.push(vt.special.onesOrdinals[t-1])),n.join(" ")};const Ft=vt,wt=function(t,e,n){return t="sans serif "+(n?n+" "+t:t),e?t+" "+e:t};let Dt=null;let Pt=null;function kt(t){let e=t%1e3,n="";if(n+=$t.ones[Math.floor(e/100)]?$t.ones[Math.floor(e/100)]+"-cent":"",e%=100,e){n+=n?"-":"";let t=$t.ones[e];if(t)n+=t;else{const r=$t.tens[Math.floor(e/10)];r.match(/-dix$/)?(t=$t.ones[e%10+10],n+=r.replace(/-dix$/,"")+"-"+t):n+=r+(e%10?"-"+$t.ones[e%10]:"")}}const r=n.match(/s-\w+$/);return r?n.replace(/s-\w+$/,r[0].slice(1)):n.replace(/-un$/,"-et-un")}function Ut(t){if(0===t)return $t.zero;if(t>=Math.pow(10,36))return t.toString();$t.special["tens-"+N.getInstance().subiso]&&($t.tens=$t.special["tens-"+N.getInstance().subiso]);let e=0,n="";for(;t>0;){const r=t%1e3;if(r){let t=$t.large[e];const s=kt(r);if(t&&t.match(/^mille /)){const r=t.replace(/^mille /,"");n=n.match(RegExp(r))?s+(e?"-mille-":"")+n:n.match(RegExp(r.replace(/s$/,"")))?s+(e?"-mille-":"")+n.replace(r.replace(/s$/,""),r):s+(e?"-"+t+"-":"")+n}else t=1===r&&t?t.replace(/s$/,""):t,n=s+(e?"-"+t+"-":"")+n}t=Math.floor(t/1e3),e++}return n.replace(/-$/,"")}const Bt={1:"uni\xe8me",2:"demi",3:"tiers",4:"quart"};function jt(t){if(1===t)return"premi\xe8re";let e=Ut(t);return e.match(/^neuf$/)?e=e.slice(0,-1)+"v":e.match(/cinq$/)?e+="u":e.match(/trois$/)?e+="":(e.match(/e$/)||e.match(/s$/))&&(e=e.slice(0,-1)),e+="i\xe8me",e}const $t=q();$t.wordOrdinal=jt,$t.numericOrdinal=function(t){const e=tt.getInstance().getParameter("gender");return 1===t?t.toString()+("m"===e?"er":"re"):t.toString()+"e"},$t.numberToWords=Ut,$t.numberToOrdinal=function(t,e){const n=Bt[t]||jt(t);return 3===t?n:e?n+"s":n};const Gt=$t;let Vt=null;function Ht(t){if(0===t)return qt.zero;if(t>=Math.pow(10,32))return t.toString();let e=0,n="";const r=function(t){let e=t%1e3,n="";return n+=qt.ones[Math.floor(e/100)]?qt.ones[Math.floor(e/100)]+qt.numSep+qt.special.hundred:"",e%=100,e&&(n+=n?qt.numSep:"",n+=qt.ones[e]),n}(t%1e3);if(!(t=Math.floor(t/1e3)))return r;for(;t>0;){const r=t%100;r&&(n=qt.ones[r]+qt.numSep+qt.large[e]+(n?qt.numSep+n:"")),t=Math.floor(t/100),e++}return r?n+qt.numSep+r:n}function Yt(t){const e=tt.getInstance().getParameter("gender");if(t<=0)return t.toString();if(t<10)return"f"===e?qt.special.ordinalsFeminine[t]:qt.special.ordinalsMasculine[t];return Ht(t)+("f"===e?"\u0935\u0940\u0902":"\u0935\u093e\u0901")}const qt=q();qt.wordOrdinal=Yt,qt.numericOrdinal=function(t){const e=tt.getInstance().getParameter("gender");return t>0&&t<10?"f"===e?qt.special.simpleSmallOrdinalsFeminine[t]:qt.special.simpleSmallOrdinalsMasculine[t]:t.toString().split("").map((function(t){const e=parseInt(t,10);return isNaN(e)?"":qt.special.simpleNumbers[e]})).join("")+("f"===e?"\u0935\u0940\u0902":"\u0935\u093e\u0901")},qt.numberToWords=Ht,qt.numberToOrdinal=function(t,e){return t<=10?qt.special.smallDenominators[t]:Yt(t)+" \u0905\u0902\u0936"};const Wt=qt;let Xt=null;function Kt(t){let e=t%1e3,n="";if(n+=Jt.ones[Math.floor(e/100)]?Jt.ones[Math.floor(e/100)]+Jt.numSep+"cento":"",e%=100,e){n+=n?Jt.numSep:"";const t=Jt.ones[e];if(t)n+=t;else{let t=Jt.tens[Math.floor(e/10)];const r=e%10;1!==r&&8!==r||(t=t.slice(0,-1)),n+=t,n+=r?Jt.numSep+Jt.ones[e%10]:""}}return n}function zt(t){if(0===t)return Jt.zero;if(t>=Math.pow(10,36))return t.toString();if(1===t&&tt.getInstance().getParameter("fraction"))return"un";let e=0,n="";for(;t>0;){t%1e3&&(n=Kt(t%1e3)+(e?"-"+Jt.large[e]+"-":"")+n),t=Math.floor(t/1e3),e++}return n.replace(/-$/,"")}function Zt(t){const e="m"===tt.getInstance().getParameter("gender")?"o":"a";let n=Jt.special.onesOrdinals[t];return n?n.slice(0,-1)+e:(n=zt(t),n.slice(0,-1)+"esim"+e)}const Jt=q();Jt.wordOrdinal=Zt,Jt.numericOrdinal=function(t){const e=tt.getInstance().getParameter("gender");return t.toString()+("m"===e?"o":"a")},Jt.numberToWords=zt,Jt.numberToOrdinal=function(t,e){if(2===t)return e?"mezzi":"mezzo";const n=Zt(t);if(!e)return n;const r=n.match(/o$/)?"i":"e";return n.slice(0,-1)+r};const Qt=Jt,te=function(t,e,n){return t.match(/^[a-zA-Z]$/)&&(e=e.replace("cerchiato","cerchiata")),t=n?t+" "+n:t,e?t+" "+e:t};let ee=null;function ne(t,e=!1){let n=t%1e3,r="";const s=Math.floor(n/100),o=oe.ones[s];if(r+=o?(1===s?"":o)+"hundre":"",n%=100,n){if(r+=r?"og":"",e){const t=oe.special.smallOrdinals[n];if(t)return r+t;if(n%10)return r+oe.tens[Math.floor(n/10)]+oe.special.smallOrdinals[n%10]}r+=oe.ones[n]||oe.tens[Math.floor(n/10)]+(n%10?oe.ones[n%10]:"")}return e?re(r):r}function re(t){const e=oe.special.endOrdinal[0];return"a"===e&&t.match(/en$/)?t.slice(0,-2)+oe.special.endOrdinal:t.match(/(d|n)$/)||t.match(/hundre$/)?t+"de":t.match(/i$/)?t+oe.special.endOrdinal:"a"===e&&t.match(/e$/)?t.slice(0,-1)+oe.special.endOrdinal:(t.match(/e$/),t+"nde")}function se(t){return le(t,!0)}const oe=q();oe.wordOrdinal=se,oe.numericOrdinal=function(t){return t.toString()+"."},oe.numberToWords=le,oe.numberToOrdinal=function(t,e){return se(t)};const ie=oe;function ce(t,e=!1){return t===oe.ones[1]?"ein"===t?"eitt ":e?"et":"ett":t}function ae(t,e=!1){let n=t%1e3,r="",s=oe.ones[Math.floor(n/100)];if(r+=s?ce(s)+"hundre":"",n%=100,n){if(r+=r?"og":"",e){const t=oe.special.smallOrdinals[n];if(t)return r+t}if(s=oe.ones[n],s)r+=s;else{const t=oe.tens[Math.floor(n/10)];s=oe.ones[n%10],r+=s?s+"og"+t:t}}return e?re(r):r}function le(t,e=!1){const n="alt"===N.getInstance().subiso?function(t,e=!1){if(0===t)return e?oe.special.smallOrdinals[0]:oe.zero;if(t>=Math.pow(10,36))return t.toString();let n=0,r="";for(;t>0;){const s=t%1e3;if(s){const o=ae(t%1e3,!n&&e);!n&&e&&(e=!e),r=(1===n?ce(o,!0):o)+(n>1?oe.numSep:"")+(n?oe.large[n]+(n>1&&s>1?"er":""):"")+(n>1&&r?oe.numSep:"")+r}t=Math.floor(t/1e3),n++}return e?r+(r.match(/tusen$/)?"de":"te"):r}(t,e):function(t,e=!1){if(0===t)return e?oe.special.smallOrdinals[0]:oe.zero;if(t>=Math.pow(10,36))return t.toString();let n=0,r="";for(;t>0;){const s=t%1e3;if(s){const o=ne(t%1e3,!n&&e);!n&&e&&(e=!e),r=o+(n?" "+oe.large[n]+(n>1&&s>1?"er":"")+(r?" ":""):"")+r}t=Math.floor(t/1e3),n++}return e?r+(r.match(/tusen$/)?"de":"te"):r}(t,e);return n}let ue=null;function he(t){return t.toString().split("").map((function(t){return de.ones[parseInt(t,10)]})).join("")}const de=q();de.numberToWords=he,de.numberToOrdinal=he;const pe=de,fe=function(t){return t.match(RegExp("^"+be.ALPHABETS.languagePrefix.english))?t.slice(1):t},me=function(t,e,n){return t=fe(t),e?t+e:t},ge=function(t,e,n){return e+fe(t)},Ne=function(t,e,n){return e+(n||"")+(t=fe(t))+"\u283b"},Se=function(t,e,n){return e+(n||"")+(t=fe(t))+"\u283b\u283b"},Ee=function(t,e,n){return e+(t=fe(t))+"\u283e"};let be=null;let Ae=null;function ye(t){let e=t%1e3,n="";const r=Math.floor(e/100);return n+=Ie.ones[r]?(1===r?"":Ie.ones[r]+Ie.numSep)+"hundra":"",e%=100,e&&(n+=n?Ie.numSep:"",n+=Ie.ones[e]||Ie.tens[Math.floor(e/10)]+(e%10?Ie.numSep+Ie.ones[e%10]:"")),n}function Te(t,e=!1){if(0===t)return Ie.zero;if(t>=Math.pow(10,36))return t.toString();let n=0,r="";for(;t>0;){const s=t%1e3;if(s){const o=Ie.large[n],i=s>1&&n>1&&!e?"er":"";r=(1===n&&1===s?"":(n>1&&1===s?"en":ye(t%1e3))+(n>1?" ":""))+(n?o+i+(n>1?" ":""):"")+r}t=Math.floor(t/1e3),n++}return r.replace(/ $/,"")}function _e(t){let e=Te(t,!0);return e.match(/^noll$/)?e="nollte":e.match(/ett$/)?e=e.replace(/ett$/,"f\xf6rsta"):e.match(/tv\xe5$/)?e=e.replace(/tv\xe5$/,"andra"):e.match(/tre$/)?e=e.replace(/tre$/,"tredje"):e.match(/fyra$/)?e=e.replace(/fyra$/,"fj\xe4rde"):e.match(/fem$/)?e=e.replace(/fem$/,"femte"):e.match(/sex$/)?e=e.replace(/sex$/,"sj\xe4tte"):e.match(/sju$/)?e=e.replace(/sju$/,"sjunde"):e.match(/\xe5tta$/)?e=e.replace(/\xe5tta$/,"\xe5ttonde"):e.match(/nio$/)?e=e.replace(/nio$/,"nionde"):e.match(/tio$/)?e=e.replace(/tio$/,"tionde"):e.match(/elva$/)?e=e.replace(/elva$/,"elfte"):e.match(/tolv$/)?e=e.replace(/tolv$/,"tolfte"):e.match(/tusen$/)?e=e.replace(/tusen$/,"tusonde"):e.match(/jard$/)||e.match(/jon$/)?e+="te":e+="de",e}const Ie=q();Ie.wordOrdinal=_e,Ie.numericOrdinal=function(t){const e=t.toString();return e.match(/11$|12$/)?e+":e":e+(e.match(/1$|2$/)?":a":":e")},Ie.numberToWords=Te,Ie.numberToOrdinal=function(t,e){if(1===t)return"hel";if(2===t)return e?"halva":"halv";let n=_e(t);return n=n.match(/de$/)?n.replace(/de$/,""):n,n+(e?"delar":"del")};const Ce=Ie;let Oe=null;const xe={ca:function(){return at||(at=function(){const t=X();return t.NUMBERS=it,t.COMBINERS.sansserif=ct,t.FUNCTIONS.fracNestDepth=t=>!1,t.FUNCTIONS.combineRootIndex=z,t.FUNCTIONS.combineNestedRadical=(t,e,n)=>t+n,t.FUNCTIONS.fontRegexp=t=>RegExp("^"+t+" "),t.FUNCTIONS.plural=t=>/.*os$/.test(t)?t+"sos":/.*s$/.test(t)?t+"os":/.*ga$/.test(t)?t.slice(0,-2)+"gues":/.*\xe7a$/.test(t)?t.slice(0,-2)+"ces":/.*ca$/.test(t)?t.slice(0,-2)+"ques":/.*ja$/.test(t)?t.slice(0,-2)+"ges":/.*qua$/.test(t)?t.slice(0,-3)+"q\xfces":/.*a$/.test(t)?t.slice(0,-1)+"es":/.*(e|i)$/.test(t)?t+"ns":/.*\xed$/.test(t)?t.slice(0,-1)+"ins":t+"s",t.FUNCTIONS.si=(t,e)=>(e.match(/^metre/)&&(t=t.replace(/a$/,"\xe0").replace(/o$/,"\xf2").replace(/i$/,"\xed")),t+e),t.ALPHABETS.combiner=V.prefixCombiner,t}()),at},da:function(){return mt||(mt=function(){const t=X();return t.NUMBERS=ft,t.FUNCTIONS.radicalNestDepth=K,t.FUNCTIONS.fontRegexp=e=>e===t.ALPHABETS.capPrefix.default?RegExp("^"+e+" "):RegExp(" "+e+"$"),t.ALPHABETS.combiner=V.postfixCombiner,t.ALPHABETS.digitTrans.default=ft.numberToWords,t}()),mt},de:function(){return _t||(_t=function(){const t=X();return t.NUMBERS=At,t.COMBINERS.germanPostfix=Tt,t.ALPHABETS.combiner=yt,t.FUNCTIONS.radicalNestDepth=e=>e>1?t.NUMBERS.numberToWords(e)+"fach":"",t.FUNCTIONS.combineRootIndex=(t,e)=>{const n=e?e+"wurzel":"";return t.replace("Wurzel",n)},t.FUNCTIONS.combineNestedRadical=(t,e,n)=>{const r=(e?e+" ":"")+(t=n.match(/exponent$/)?t+"r":t);return n.match(/ /)?n.replace(/ /," "+r+" "):r+" "+n},t.FUNCTIONS.fontRegexp=function(t){return t=t.split(" ").map((function(t){return t.replace(/s$/,"(|s)")})).join(" "),new RegExp("((^"+t+" )|( "+t+"$))")},t.CORRECTIONS.correctOne=t=>t.replace(/^eins$/,"ein"),t.CORRECTIONS.localFontNumber=t=>Z(t).split(" ").map((function(t){return t.replace(/s$/,"")})).join(" "),t.CORRECTIONS.lowercase=t=>t.toLowerCase(),t.CORRECTIONS.article=t=>{const e=tt.getInstance().getParameter("case"),n=tt.getInstance().getParameter("plural");return"dative"===e?{der:"dem",die:n?"den":"der",das:"dem"}[t]:t},t.CORRECTIONS.masculine=t=>"dative"===tt.getInstance().getParameter("case")?t+"n":t,t}()),_t},en:function(){return Mt||(Mt=function(){const t=X();return t.NUMBERS=Lt,t.FUNCTIONS.radicalNestDepth=K,t.FUNCTIONS.plural=t=>/.*s$/.test(t)?t:t+"s",t.ALPHABETS.combiner=V.prefixCombiner,t.ALPHABETS.digitTrans.default=Lt.numberToWords,t.CORRECTIONS.article=t=>tt.getInstance().getParameter("noArticle")?"":t,t}()),Mt},es:function(){return Dt||(Dt=function(){const t=X();return t.NUMBERS=Ft,t.COMBINERS.sansserif=wt,t.FUNCTIONS.fracNestDepth=t=>!1,t.FUNCTIONS.combineRootIndex=z,t.FUNCTIONS.combineNestedRadical=(t,e,n)=>t+n,t.FUNCTIONS.fontRegexp=t=>RegExp("^"+t+" "),t.FUNCTIONS.plural=t=>/.*(a|e|i|o|u)$/.test(t)?t+"s":/.*z$/.test(t)?t.slice(0,-1)+"ces":/.*c$/.test(t)?t.slice(0,-1)+"ques":/.*g$/.test(t)?t+"ues":/.*\u00f3n$/.test(t)?t.slice(0,-2)+"ones":t+"es",t.FUNCTIONS.si=(t,e)=>(e.match(/^metro/)&&(t=t.replace(/a$/,"\xe1").replace(/o$/,"\xf3").replace(/i$/,"\xed")),t+e),t.ALPHABETS.combiner=V.prefixCombiner,t}()),Dt},euro:function(){return Pt||(Pt=X()),Pt},fr:function(){return Vt||(Vt=function(){const t=X();return t.NUMBERS=Gt,t.FUNCTIONS.radicalNestDepth=K,t.FUNCTIONS.combineRootIndex=z,t.FUNCTIONS.combineNestedFraction=(t,e,n)=>n.replace(/ $/g,"")+e+t,t.FUNCTIONS.combineNestedRadical=(t,e,n)=>n+" "+t,t.FUNCTIONS.fontRegexp=t=>RegExp(" (en |)"+t+"$"),t.FUNCTIONS.plural=t=>/.*s$/.test(t)?t:t+"s",t.CORRECTIONS.article=t=>tt.getInstance().getParameter("noArticle")?"":t,t.ALPHABETS.combiner=V.romanceCombiner,t.SUBISO={default:"fr",current:"fr",all:["fr","be","ch"]},t}()),Vt},hi:function(){return Xt||(Xt=function(){const t=X();return t.NUMBERS=Wt,t.ALPHABETS.combiner=V.prefixCombiner,t.FUNCTIONS.radicalNestDepth=K,t}()),Xt},it:function(){return ee||(ee=function(){const t=X();return t.NUMBERS=Qt,t.COMBINERS.italianPostfix=te,t.FUNCTIONS.radicalNestDepth=K,t.FUNCTIONS.combineRootIndex=z,t.FUNCTIONS.combineNestedFraction=(t,e,n)=>n.replace(/ $/g,"")+e+t,t.FUNCTIONS.combineNestedRadical=(t,e,n)=>n+" "+t,t.FUNCTIONS.fontRegexp=t=>RegExp(" (en |)"+t+"$"),t.ALPHABETS.combiner=V.romanceCombiner,t}()),ee},nb:function(){return ue||(ue=function(){const t=X();return t.NUMBERS=ie,t.ALPHABETS.combiner=V.prefixCombiner,t.ALPHABETS.digitTrans.default=ie.numberToWords,t.FUNCTIONS.radicalNestDepth=K,t}()),ue},nn:function(){return Ae||(Ae=function(){const t=X();return t.NUMBERS=ie,t.ALPHABETS.combiner=V.prefixCombiner,t.ALPHABETS.digitTrans.default=ie.numberToWords,t.FUNCTIONS.radicalNestDepth=K,t.SUBISO={default:"",current:"",all:["","alt"]},t}()),Ae},sv:function(){return Oe||(Oe=function(){const t=X();return t.NUMBERS=Ce,t.FUNCTIONS.radicalNestDepth=K,t.FUNCTIONS.fontRegexp=function(t){return new RegExp("((^"+t+" )|( "+t+"$))")},t.ALPHABETS.combiner=V.prefixCombiner,t.ALPHABETS.digitTrans.default=Ce.numberToWords,t.CORRECTIONS.correctOne=t=>t.replace(/^ett$/,"en"),t}()),Oe},nemeth:function(){return be||(be=function(){const t=X();return t.NUMBERS=pe,t.COMBINERS={postfixCombiner:me,germanCombiner:ge,embellishCombiner:Ne,doubleEmbellishCombiner:Se,parensCombiner:Ee},t.FUNCTIONS.fracNestDepth=t=>!1,t.FUNCTIONS.fontRegexp=t=>RegExp("^"+t),t.FUNCTIONS.si=$,t.ALPHABETS.combiner=(t,e,n)=>e?e+n+t:fe(t),t.ALPHABETS.digitTrans={default:pe.numberToWords},t}()),be}};function Le(){const t=function(){const t=f.L.ensureLocale(N.getInstance().locale,N.getInstance().defaultLocale);return N.getInstance().locale=t,xe[t]()}();if(function(t){const e=N.getInstance().subiso;-1===t.SUBISO.all.indexOf(e)&&(N.getInstance().subiso=t.SUBISO.default);t.SUBISO.current=N.getInstance().subiso}(t),t){for(const e of Object.getOwnPropertyNames(t))W[e]=t[e];for(const[e,n]of Object.entries(t.CORRECTIONS))tt.getInstance().setCorrection(e,n)}}function Me(){return"undefined"!=typeof window&&"ActiveXObject"in window&&"clipboardData"in window&&(we(d.Z.mathmapsIePath),ve(),!0)}const Re=null;function ve(t){we(d.Z.WGXpath),Fe(t)}function Fe(t,e){let n=e||1;"undefined"==typeof wgxpath&&n<10?setTimeout((function(){Fe(t,n++)}),200):n>=10||(d.Z.wgxpath=wgxpath,t?d.Z.wgxpath.install({document}):d.Z.wgxpath.install(),b.evaluate=document.evaluate,b.result=XPathResult,b.createNSResolver=document.createNSResolver)}function we(t){const e=d.Z.document.createElement("script");e.type="text/javascript",e.src=t,d.Z.document.head?d.Z.document.head.appendChild(e):d.Z.document.body.appendChild(e)}function De(t){return t.match("/$")?t:t+"/"}function Pe(t,e="json"){return De(d.Z.jsonPath)+t+(e.match(/^\./)?e:"."+e)}var ke,Ue,Be;function je(t){const e=t.toString(16).toUpperCase();return e.length>3?e:("000"+e).slice(-4)}function $e([t,e],n){const r=parseInt(t,16),s=parseInt(e,16),o=[];for(let t=r;t<=s;t++){let e=je(t);!1!==n[e]&&(e=n[e]||e,o.push(e))}return o}function Ge(t,e={}){return $e(t,e).map((t=>String.fromCodePoint(parseInt(t,16))))}!function(t){t.BOLD="bold",t.BOLDFRAKTUR="bold-fraktur",t.BOLDITALIC="bold-italic",t.BOLDSCRIPT="bold-script",t.DOUBLESTRUCK="double-struck",t.DOUBLESTRUCKITALIC="double-struck-italic",t.FULLWIDTH="fullwidth",t.FRAKTUR="fraktur",t.ITALIC="italic",t.MONOSPACE="monospace",t.NORMAL="normal",t.SCRIPT="script",t.SANSSERIF="sans-serif",t.SANSSERIFITALIC="sans-serif-italic",t.SANSSERIFBOLD="sans-serif-bold",t.SANSSERIFBOLDITALIC="sans-serif-bold-italic"}(ke||(ke={})),function(t){t.SUPER="super",t.SUB="sub",t.CIRCLED="circled",t.PARENTHESIZED="parenthesized",t.PERIOD="period",t.NEGATIVECIRCLED="negative-circled",t.DOUBLECIRCLED="double-circled",t.CIRCLEDSANSSERIF="circled-sans-serif",t.NEGATIVECIRCLEDSANSSERIF="negative-circled-sans-serif",t.COMMA="comma",t.SQUARED="squared",t.NEGATIVESQUARED="negative-squared"}(Ue||(Ue={})),function(t){t.LATINCAP="latinCap",t.LATINSMALL="latinSmall",t.GREEKCAP="greekCap",t.GREEKSMALL="greekSmall",t.DIGIT="digit"}(Be||(Be={}));const Ve=[{interval:["1D400","1D419"],base:Be.LATINCAP,subst:{},capital:!0,category:"Lu",font:ke.BOLD},{interval:["1D41A","1D433"],base:Be.LATINSMALL,subst:{},capital:!1,category:"Ll",font:ke.BOLD},{interval:["1D56C","1D585"],base:Be.LATINCAP,subst:{},capital:!0,category:"Lu",font:ke.BOLDFRAKTUR},{interval:["1D586","1D59F"],base:Be.LATINSMALL,subst:{},capital:!1,category:"Ll",font:ke.BOLDFRAKTUR},{interval:["1D468","1D481"],base:Be.LATINCAP,subst:{},capital:!0,category:"Lu",font:ke.BOLDITALIC},{interval:["1D482","1D49B"],base:Be.LATINSMALL,subst:{},capital:!1,category:"Ll",font:ke.BOLDITALIC},{interval:["1D4D0","1D4E9"],base:Be.LATINCAP,subst:{},capital:!0,category:"Lu",font:ke.BOLDSCRIPT},{interval:["1D4EA","1D503"],base:Be.LATINSMALL,subst:{},capital:!1,category:"Ll",font:ke.BOLDSCRIPT},{interval:["1D538","1D551"],base:Be.LATINCAP,subst:{"1D53A":"2102","1D53F":"210D","1D545":"2115","1D547":"2119","1D548":"211A","1D549":"211D","1D551":"2124"},capital:!0,category:"Lu",font:ke.DOUBLESTRUCK},{interval:["1D552","1D56B"],base:Be.LATINSMALL,subst:{},capital:!1,category:"Ll",font:ke.DOUBLESTRUCK},{interval:["1D504","1D51D"],base:Be.LATINCAP,subst:{"1D506":"212D","1D50B":"210C","1D50C":"2111","1D515":"211C","1D51D":"2128"},capital:!0,category:"Lu",font:ke.FRAKTUR},{interval:["1D51E","1D537"],base:Be.LATINSMALL,subst:{},capital:!1,category:"Ll",font:ke.FRAKTUR},{interval:["FF21","FF3A"],base:Be.LATINCAP,subst:{},capital:!0,category:"Lu",font:ke.FULLWIDTH},{interval:["FF41","FF5A"],base:Be.LATINSMALL,subst:{},capital:!1,category:"Ll",font:ke.FULLWIDTH},{interval:["1D434","1D44D"],base:Be.LATINCAP,subst:{},capital:!0,category:"Lu",font:ke.ITALIC},{interval:["1D44E","1D467"],base:Be.LATINSMALL,subst:{"1D455":"210E"},capital:!1,category:"Ll",font:ke.ITALIC},{interval:["1D670","1D689"],base:Be.LATINCAP,subst:{},capital:!0,category:"Lu",font:ke.MONOSPACE},{interval:["1D68A","1D6A3"],base:Be.LATINSMALL,subst:{},capital:!1,category:"Ll",font:ke.MONOSPACE},{interval:["0041","005A"],base:Be.LATINCAP,subst:{},capital:!0,category:"Lu",font:ke.NORMAL},{interval:["0061","007A"],base:Be.LATINSMALL,subst:{},capital:!1,category:"Ll",font:ke.NORMAL},{interval:["1D49C","1D4B5"],base:Be.LATINCAP,subst:{"1D49D":"212C","1D4A0":"2130","1D4A1":"2131","1D4A3":"210B","1D4A4":"2110","1D4A7":"2112","1D4A8":"2133","1D4AD":"211B"},capital:!0,category:"Lu",font:ke.SCRIPT},{interval:["1D4B6","1D4CF"],base:Be.LATINSMALL,subst:{"1D4BA":"212F","1D4BC":"210A","1D4C4":"2134"},capital:!1,category:"Ll",font:ke.SCRIPT},{interval:["1D5A0","1D5B9"],base:Be.LATINCAP,subst:{},capital:!0,category:"Lu",font:ke.SANSSERIF},{interval:["1D5BA","1D5D3"],base:Be.LATINSMALL,subst:{},capital:!1,category:"Ll",font:ke.SANSSERIF},{interval:["1D608","1D621"],base:Be.LATINCAP,subst:{},capital:!0,category:"Lu",font:ke.SANSSERIFITALIC},{interval:["1D622","1D63B"],base:Be.LATINSMALL,subst:{},capital:!1,category:"Ll",font:ke.SANSSERIFITALIC},{interval:["1D5D4","1D5ED"],base:Be.LATINCAP,subst:{},capital:!0,category:"Lu",font:ke.SANSSERIFBOLD},{interval:["1D5EE","1D607"],base:Be.LATINSMALL,subst:{},capital:!1,category:"Ll",font:ke.SANSSERIFBOLD},{interval:["1D63C","1D655"],base:Be.LATINCAP,subst:{},capital:!0,category:"Lu",font:ke.SANSSERIFBOLDITALIC},{interval:["1D656","1D66F"],base:Be.LATINSMALL,subst:{},capital:!1,category:"Ll",font:ke.SANSSERIFBOLDITALIC},{interval:["0391","03A9"],base:Be.GREEKCAP,subst:{"03A2":"03F4"},capital:!0,category:"Lu",font:ke.NORMAL},{interval:["03B0","03D0"],base:Be.GREEKSMALL,subst:{"03B0":"2207","03CA":"2202","03CB":"03F5","03CC":"03D1","03CD":"03F0","03CE":"03D5","03CF":"03F1","03D0":"03D6"},capital:!1,category:"Ll",font:ke.NORMAL},{interval:["1D6A8","1D6C0"],base:Be.GREEKCAP,subst:{},capital:!0,category:"Lu",font:ke.BOLD},{interval:["1D6C1","1D6E1"],base:Be.GREEKSMALL,subst:{},capital:!1,category:"Ll",font:ke.BOLD},{interval:["1D6E2","1D6FA"],base:Be.GREEKCAP,subst:{},capital:!0,category:"Lu",font:ke.ITALIC},{interval:["1D6FB","1D71B"],base:Be.GREEKSMALL,subst:{},capital:!1,category:"Ll",font:ke.ITALIC},{interval:["1D71C","1D734"],base:Be.GREEKCAP,subst:{},capital:!0,category:"Lu",font:ke.BOLDITALIC},{interval:["1D735","1D755"],base:Be.GREEKSMALL,subst:{},capital:!1,category:"Ll",font:ke.BOLDITALIC},{interval:["1D756","1D76E"],base:Be.GREEKCAP,subst:{},capital:!0,category:"Lu",font:ke.SANSSERIFBOLD},{interval:["1D76F","1D78F"],base:Be.GREEKSMALL,subst:{},capital:!1,category:"Ll",font:ke.SANSSERIFBOLD},{interval:["1D790","1D7A8"],base:Be.GREEKCAP,subst:{},capital:!0,category:"Lu",font:ke.SANSSERIFBOLDITALIC},{interval:["1D7A9","1D7C9"],base:Be.GREEKSMALL,subst:{},capital:!1,category:"Ll",font:ke.SANSSERIFBOLDITALIC},{interval:["0030","0039"],base:Be.DIGIT,subst:{},offset:0,category:"Nd",font:ke.NORMAL},{interval:["2070","2079"],base:Be.DIGIT,subst:{2071:"00B9",2072:"00B2",2073:"00B3"},offset:0,category:"No",font:Ue.SUPER},{interval:["2080","2089"],base:Be.DIGIT,subst:{},offset:0,category:"No",font:Ue.SUB},{interval:["245F","2473"],base:Be.DIGIT,subst:{"245F":"24EA"},offset:0,category:"No",font:Ue.CIRCLED},{interval:["3251","325F"],base:Be.DIGIT,subst:{},offset:21,category:"No",font:Ue.CIRCLED},{interval:["32B1","32BF"],base:Be.DIGIT,subst:{},offset:36,category:"No",font:Ue.CIRCLED},{interval:["2474","2487"],base:Be.DIGIT,subst:{},offset:1,category:"No",font:Ue.PARENTHESIZED},{interval:["2487","249B"],base:Be.DIGIT,subst:{2487:"1F100"},offset:0,category:"No",font:Ue.PERIOD},{interval:["2775","277F"],base:Be.DIGIT,subst:{2775:"24FF"},offset:0,category:"No",font:Ue.NEGATIVECIRCLED},{interval:["24EB","24F4"],base:Be.DIGIT,subst:{},offset:11,category:"No",font:Ue.NEGATIVECIRCLED},{interval:["24F5","24FE"],base:Be.DIGIT,subst:{},offset:1,category:"No",font:Ue.DOUBLECIRCLED},{interval:["277F","2789"],base:Be.DIGIT,subst:{"277F":"1F10B"},offset:0,category:"No",font:Ue.CIRCLEDSANSSERIF},{interval:["2789","2793"],base:Be.DIGIT,subst:{2789:"1F10C"},offset:0,category:"No",font:Ue.NEGATIVECIRCLEDSANSSERIF},{interval:["FF10","FF19"],base:Be.DIGIT,subst:{},offset:0,category:"Nd",font:ke.FULLWIDTH},{interval:["1D7CE","1D7D7"],base:Be.DIGIT,subst:{},offset:0,category:"Nd",font:ke.BOLD},{interval:["1D7D8","1D7E1"],base:Be.DIGIT,subst:{},offset:0,category:"Nd",font:ke.DOUBLESTRUCK},{interval:["1D7E2","1D7EB"],base:Be.DIGIT,subst:{},offset:0,category:"Nd",font:ke.SANSSERIF},{interval:["1D7EC","1D7F5"],base:Be.DIGIT,subst:{},offset:0,category:"Nd",font:ke.SANSSERIFBOLD},{interval:["1D7F6","1D7FF"],base:Be.DIGIT,subst:{},offset:0,category:"Nd",font:ke.MONOSPACE},{interval:["1F101","1F10A"],base:Be.DIGIT,subst:{},offset:0,category:"No",font:Ue.COMMA},{interval:["24B6","24CF"],base:Be.LATINCAP,subst:{},capital:!0,category:"So",font:Ue.CIRCLED},{interval:["24D0","24E9"],base:Be.LATINSMALL,subst:{},capital:!1,category:"So",font:Ue.CIRCLED},{interval:["1F110","1F129"],base:Be.LATINCAP,subst:{},capital:!0,category:"So",font:Ue.PARENTHESIZED},{interval:["249C","24B5"],base:Be.LATINSMALL,subst:{},capital:!1,category:"So",font:Ue.PARENTHESIZED},{interval:["1F130","1F149"],base:Be.LATINCAP,subst:{},capital:!0,category:"So",font:Ue.SQUARED},{interval:["1F170","1F189"],base:Be.LATINCAP,subst:{},capital:!0,category:"So",font:Ue.NEGATIVESQUARED},{interval:["1F150","1F169"],base:Be.LATINCAP,subst:{},capital:!0,category:"So",font:Ue.NEGATIVECIRCLED}],He=new Map;function Ye(t,e){return t+e.split("-").map((t=>t[0].toUpperCase()+t.slice(1))).join("")}for(const t of Ve){const e=Ye(t.base,t.font),n=Ge(t.interval,t.subst);let r=He.get(e);r?r.unicode=r.unicode.concat(n):(r=t,r.unicode=n,He.set(e,r))}var qe;!function(t){t.CALIGRAPHIC="caligraphic",t.CALIGRAPHICBOLD="caligraphic-bold",t.OLDSTYLE="oldstyle",t.OLDSTYLEBOLD="oldstyle-bold",t.UNKNOWN="unknown"}(qe||(qe={}));const We=Object.assign(Object.assign(Object.assign({},ke),qe),Ue);var Xe;!function(t){t.ALLLETTERS="allLetters",t.D="d",t.BAR="bar",t.TILDE="tilde"}(Xe||(Xe={}));const Ke=Object.assign(Object.assign({},Be),Xe);var ze,Ze,Je=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]])}return n};!function(t){t.functionApplication=String.fromCodePoint(8289),t.invisibleTimes=String.fromCodePoint(8290),t.invisibleComma=String.fromCodePoint(8291),t.invisiblePlus=String.fromCodePoint(8292)}(ze||(ze={}));class Qe extends Map{get(t){return super.get(t)||{role:"unknown",type:"unknown",font:We.UNKNOWN}}}class tn extends Map{set(t,e,n=""){return super.set(this.secKey(e,t),n||e),this}has(t,e){return super.has(this.secKey(e,t))}get(t,e){return super.get(this.secKey(e,t))}secKey(t,e){return e?`${t} ${e}`:`${t}`}}function en(t,e){for(const n of t)Ze.Meaning.set(n,{role:e.role||"unknown",type:e.type||"unknown",font:e.font||We.UNKNOWN}),e.secondary&&Ze.Secondary.set(n,e.secondary)}function nn(t,e,n=1){const r={},s=function(t){let e=[];for(const n of t)Array.isArray(n)?e=e.concat($e(n,{}).map((t=>parseInt(t,16)))):e.push(parseInt(n,16));return e}(e);for(const e of s)r[e]||(t.set(String.fromCodePoint(e),String.fromCodePoint(e+n)),r[e]=!0,r[e+n]=!0)}!function(t){t.Meaning=new Qe,t.Secondary=new tn,t.FencesHoriz=new Map,t.FencesVert=new Map}(Ze||(Ze={}));const rn=["cos","cot","csc","sec","sin","tan","arccos","arccot","arccsc","arcsec","arcsin","arctan"].concat(["cosh","coth","csch","sech","sinh","tanh","arcosh","arcoth","arcsch","arsech","arsinh","artanh"],["deg","det","dim","hom","ker","Tr"],["log","ln","lg","exp","gcd","lcm","arg","im","re","Pr"]);function sn(t,e,n,r,s,o=[],i={},c={}){const a=He.get(Ye(t,r));a&&(a.unicode.forEach((t=>{Ze.Meaning.set(t,{type:e,role:n,font:s}),o.forEach((e=>Ze.Secondary.set(t,e)))})),function(t,e){for(const[n,r]of Object.entries(e)){const e=t[n];void 0!==e&&Ze.Meaning.set(e,r)}}(a.unicode,i),function(t,e){for(const[n,r]of Object.entries(e)){const e=t[n];void 0!==e&&Ze.Secondary.set(e,r)}}(a.unicode,c))}[{set:["23","25","26","40","5c","a1","a7","b6","bf","2017",["2022","2025"],"2027","2030","2031","203b","203c",["2041","2043"],["2047","2049"],["204b","204d"],"2050","2055","2056",["2058","205e"],"2234","2235","fe45","fe46","fe5f","fe60","fe68","fe6a","fe6b","ff03","ff05","ff06","ff0f","ff20","ff3c"],type:"punctuation",role:"unknown"},{set:["22","ab","bb","2dd",["2018","201f"],"2039","203a",["301d","301f"],"fe10","ff02","ff07"],type:"punctuation",role:"quotes"},{set:["3b","204f","2a1f","2a3e","fe14","fe54","ff1b"],type:"punctuation",role:"semicolon"},{set:["3f","203d","fe16","fe56","ff1f"],type:"punctuation",role:"question"},{set:["21","fe15","fe57","ff01"],type:"punctuation",role:"exclamation"},{set:["5e","60","a8","aa","b4","ba","2c7",["2d8","2da"],"2040","207a","207d","207e","ff3e","ff40"],type:"punctuation",role:"overaccent"},{set:["b8","2db","2038","203f","2054","208a","208d","208e"],type:"punctuation",role:"underaccent"},{set:["3a","2982","fe13","fe30","fe55","ff1a"],type:"punctuation",role:"colon"},{set:["2c","2063","fe50","ff0c"],type:"punctuation",role:"comma"},{set:["2026",["22ee","22f1"],"fe19"],type:"punctuation",role:"ellipsis"},{set:["2e","fe52","ff0e"],type:"punctuation",role:"fullstop"},{set:["2d","5f","af",["2010","2015"],"203e","203e","207b","208b","2212","2796",["fe49","fe4f"],"fe58","fe63","ff0d","ff3f","ffe3"],type:"operator",role:"dash",secondary:Ke.BAR},{set:["7e","2dc","2f7","303","330","334","2053","223c","223d","301c","ff5e"],type:"operator",role:"tilde",secondary:Ke.TILDE},{set:["27","2b9","2ba",["2032","2037"],"2057"],type:"punctuation",role:"prime"},{set:["b0"],type:"punctuation",role:"degree"},{set:["2b","b1","2064","2213","2214","2228","222a",["228c","228e"],"2294","2295","229d","229e","22bb","22bd","22c4","22ce","22d3","2304","271b","271c","2795","27cf","29fa","29fb","29fe",["2a22","2a28"],"2a2d","2a2e","2a39","2a42","2a45","2a46","2a48","2a4a","2a4c","2a4f","2a50","2a52","2a54","2a56","2a57","2a59","2a5b","2a5d",["2a61","2a63"],"2adc","2add","fe62","ff0b"],type:"operator",role:"addition"},{set:["2a","b7","d7","2020","2021","204e","2051","2062",["2217","2219"],"2227","2229","2240","2293","2297",["2299","229b"],"22a0","22a1","22b9","22bc",["22c5","22cc"],"22cf","22d2","22d4","2303","2305","2306","25cb","2715","2716","27ce","27d1",["29d1","29d7"],"29e2","2a1d",["2a2f","2a37"],["2a3b","2a3d"],"2a40","2a43","2a44","2a47","2a49","2a4b","2a4d","2a4e","2a51","2a53","2a55","2a58","2a5a","2a5c",["2a5e","2a60"],"2ada","2adb","fe61","ff0a"],type:"operator",role:"multiplication"},{set:["2d","af","2010","2011","2052","207b","208b","2212","2216","2238","2242","2296","229f","2796","29ff",["2a29","2a2c"],"2a3a","2a41","fe63","ff0d"],type:"operator",role:"subtraction"},{set:["2f","f7","2044","2215","2298","2797","27cc","29bc",["29f5","29f9"],"2a38"],type:"operator",role:"division"},{set:["ac","2200","2201","2203","2204","2206",["221a","221c"],"2310","ffe2"],type:"operator",role:"prefix operator"},{set:["2320","2321","23aa","23ae","23af","23b2","23b3","23b6","23b7"],type:"operator",role:"prefix operator"},{set:["1d7ca","1d7cb"],type:"operator",role:"prefix operator",font:We.BOLD},{set:["3d","7e","207c","208c","221d","2237",["223a","223f"],"2243","2245","2248",["224a","224e"],["2251","225f"],"2261","2263","229c","22cd","22d5","29e4","29e6","2a66","2a67",["2a6a","2a6c"],["2a6c","2a78"],"fe66","ff1d"],type:"relation",role:"equality"},{set:["3c","3e","2241","2242","2244","2246","2247","2249","224f","2250","2260","2262",["2264","2281"],"22b0","22b1",["22d6","22e1"],["22e6","22e9"],["2976","2978"],"29c0","29c1","29e1","29e3","29e5",["2a79","2abc"],["2af7","2afa"],"fe64","fe65","ff1c","ff1e"],type:"relation",role:"inequality"},{set:[["2282","228b"],["228f","2292"],["22b2","22b8"],"22d0","22d1",["22e2","22e5"],["22ea","22ed"],"27c3","27c4",["27c7","27c9"],["27d5","27d7"],"27dc",["2979","297b"],"29df",["2abd","2ad8"]],type:"relation",role:"set"},{set:["2236",["27e0","27e5"],"292b","292c",["29b5","29bb"],"29be","29bf",["29c2","29d0"]],type:"relation",role:"unknown"},{set:["2205",["29b0","29b4"]],type:"identifier",role:"set empty"},{set:["1ab2","221e",["29dc","29de"]],type:"identifier",role:"infty"},{set:["22a2","22a3",["22a6","22af"],"27da","27db","27dd","27de","2ade",["2ae2","2ae6"],"2aec","2aed"],type:"relation",role:"logic"},{set:["22a4","22a5","22ba","27d8","27d9","27df","2adf","2ae0",["2ae7","2aeb"],"2af1"],type:"identifier",role:"logic"},{set:[["2190","21ff"],"2301","2324","238b","2794",["2798","27af"],["27b1","27be"],["27f0","27ff"],["2900","292a"],["292d","2975"],["297c","297f"],["2b00","2b11"],["2b30","2b4c"],["ffe9","ffec"]],type:"relation",role:"arrow"},{set:["2208","220a",["22f2","22f9"],"22ff","27d2","2ad9"],type:"operator",role:"element"},{set:["2209"],type:"operator",role:"nonelement"},{set:["220b","220d",["22fa","22fe"]],type:"operator",role:"reelement"},{set:["220c"],type:"operator",role:"renonelement"},{set:[["220f","2211"],["22c0","22c3"],["2a00","2a0b"],"2a3f","2afc","2aff"],type:"largeop",role:"sum"},{set:["2140"],type:"largeop",role:"sum",font:We.DOUBLESTRUCK},{set:[["222b","2233"],["2a0c","2a17"],["2a17","2a1c"]],type:"largeop",role:"integral"},{set:[["2500","257F"]],type:"relation",role:"box"},{set:[["2580","259F"]],type:"identifier",role:"block"},{set:[["25A0","25FF"],["2B12","2B2F"],["2B50","2B59"]],type:"relation",role:"geometry"},{set:["220e","2300","2302","2311","29bd","29e0",["29e8","29f3"],"2a1e","2afe","ffed","ffee"],type:"operator",role:"geometry"},{set:[["221f","2222"],"22be","22bf",["2312","2314"],"237c","27c0",["299b","29af"]],type:"operator",role:"geometry"},{set:["24",["a2","a5"],"b5","2123",["2125","2127"],"212a","212b","fe69","ff04","ffe0","ffe1","ffe5","ffe6"],type:"identifier",role:"unknown"},{set:["a9","ae","210f","2114","2116","2117",["211e","2122"],"212e","2132",["2139","213b"],["2141","2144"],"214d","214e",["1f12a","1f12c"],"1f18a"],type:"identifier",role:"otherletter"},{set:["2224","2226","2239","2307","27b0","27bf","27c1","27c2","27ca","27cb","27cd","27d0","27d3","27d4","2981","2999","299a","29e7","29f4","2a20","2a21","2a64","2a65","2a68","2a69","2ae1",["2aee","2af0"],"2af2","2af3","2af5","2af6","2afb","2afd"],type:"operator",role:"unknown"},{set:["2605","2606","26aa","26ab",["2720","274d"]],type:"operator",role:"unknown"},{set:[["2145","2149"]],type:"identifier",role:"latinletter",font:We.DOUBLESTRUCKITALIC,secondary:Ke.ALLLETTERS},{set:[["213c","213f"]],type:"identifier",role:"greekletter",font:We.DOUBLESTRUCK,secondary:Ke.ALLLETTERS},{set:["3d0","3d7","3f6",["1d26","1d2a"],"1d5e","1d60",["1d66","1d6a"]],type:"identifier",role:"greekletter",font:We.NORMAL,secondary:Ke.ALLLETTERS},{set:[["2135","2138"]],type:"identifier",role:"otherletter",font:We.NORMAL,secondary:Ke.ALLLETTERS},{set:["131","237"],type:"identifier",role:"latinletter",font:We.NORMAL},{set:["1d6a4","1d6a5"],type:"identifier",role:"latinletter",font:We.ITALIC},{set:["2113","2118"],type:"identifier",role:"latinletter",font:We.SCRIPT},{set:[["c0","d6"],["d8","f6"],["f8","1bf"],["1c4","2af"],["1d00","1d25"],["1d6b","1d9a"],["1e00","1ef9"],["363","36f"],["1dd3","1de6"],["1d62","1d65"],"1dca","2071","207f",["2090","209c"],"2c7c"],type:"identifier",role:"latinletter",font:We.NORMAL},{set:[["00bc","00be"],["2150","215f"],"2189"],type:"number",role:"float"},{set:["23E8",["3248","324f"]],type:"number",role:"integer"},{set:[["214A","214C"],"2705","2713","2714","2717","2718"],type:"identifier",role:"unknown"},{set:["20","a0","ad",["2000","200f"],["2028","202f"],["205f","2060"],"206a","206b","206e","206f","feff",["fff9","fffb"]],type:"text",role:"space"},{set:["7c","a6","2223","23b8","23b9","23d0","2758",["fe31","fe34"],"ff5c","ffe4","ffe8"],type:"fence",role:"neutral"},{set:["2016","2225","2980","2af4"],type:"fence",role:"metric"}].forEach((t=>{var{set:e}=t,n=Je(t,["set"]);return en(function(t){let e=[];for(const n of t)Array.isArray(n)?e=e.concat(Ge(n)):e.push(String.fromCodePoint(parseInt(n,16)));return e}(e),n)})),nn(Ze.FencesVert,["23b4",["23dc","23e1"],["fe35","fe44"],"fe47"]),nn(Ze.FencesHoriz,["28","2045",["2308","230f"],["231c","231f"],"2329","23b0",["2768","2775"],"27c5",["27e6","27ef"],["2983","2998"],["29d8","29db"],"29fc",["2e22","2e29"],["3008","3011"],["3014","301b"],"fd3e","fe17",["fe59","fe5e"],"ff08","ff5f","ff62"]),nn(Ze.FencesHoriz,["5b","7b","ff3b","ff5b"],2),nn(Ze.FencesHoriz,[["239b","23a6"]],3),nn(Ze.FencesHoriz,[["23a7","23a9"]],4),en([...Ze.FencesHoriz.keys()],{type:"fence",role:"open"}),en([...Ze.FencesHoriz.values()],{type:"fence",role:"close"}),en([...Ze.FencesVert.keys()],{type:"fence",role:"top"}),en([...Ze.FencesVert.values()],{type:"fence",role:"bottom"}),function(){for(const[t,e]of Object.entries(We)){const n=!!Ue[t]?We.UNKNOWN:e===We.FULLWIDTH?We.NORMAL:e;sn(Be.LATINCAP,"identifier","latinletter",e,n,[Ke.ALLLETTERS]),sn(Be.LATINSMALL,"identifier","latinletter",e,n,[Ke.ALLLETTERS],{},{3:Ke.D}),sn(Be.GREEKCAP,"identifier","greekletter",e,n,[Ke.ALLLETTERS]),sn(Be.GREEKSMALL,"identifier","greekletter",e,n,[Ke.ALLLETTERS],{0:{type:"operator",role:"prefix operator",font:n},26:{type:"operator",role:"prefix operator",font:n}}),sn(Be.DIGIT,"number","integer",e,n)}}(),en(["inf","lim","liminf","limsup","max","min","sup","injlim","projlim"],{type:"function",role:"limit function"}),en(rn,{type:"function",role:"prefix function"}),en(["mod","rem"],{type:"operator",role:"prefix function"});class on{constructor(){this.rules=new Map}static parseUnicode(t){const e=parseInt(t,16);return String.fromCodePoint(e)}static testDynamicConstraints_(t,e){return N.getInstance().strict?e.cstr.equal(t):N.getInstance().comparator.match(e.cstr)}defineRulesFromMappings(t,e,n){for(const[r,s]of Object.entries(n))for(const[n,o]of Object.entries(s))this.defineRuleFromStrings(t,e,r,n,o)}getRules(t){let e=this.rules.get(t);return e||(e=[],this.rules.set(t,e)),e}defineRuleFromStrings(t,e,n,r,s){let o=this.getRules(t);const i=N.getInstance().parsers[n]||N.getInstance().defaultParser,c=N.getInstance().comparators[n],a=`${t}.${e}.${n}.${r}`,l=i.parse(a),u=c?c():N.getInstance().comparator,h=u.getReference();u.setReference(l);const d={cstr:l,action:s};o=o.filter((t=>!l.equal(t.cstr))),o.push(d),this.rules.set(t,o),u.setReference(h)}lookupRule(e,n){let r=this.getRules(n.getValue(t.LOCALE));return r=r.filter((function(t){return on.testDynamicConstraints_(n,t)})),1===r.length?r[0]:r.length?r.sort(((t,e)=>N.getInstance().comparator.compare(t.cstr,e.cstr)))[0]:null}}let cn=o.DEFAULT_VALUES[t.LOCALE],an=o.DEFAULT_VALUES[t.MODALITY];function ln(t){return!(!t.locale&&!t.modality)&&(cn=t.locale||cn,an=t.modality||an,!0)}let un={};function hn(t){un=t}const dn=new Map,pn=new Map;function fn(t,e){let n=dn.get(e);return n||(n=new on,n.base=pn.get(t),dn.set(e,n),n)}function mn(t){const e=pn.get(t.key);if(!e)return;const n=t.names;Object.assign(t,e),n&&e.names&&(t.names=t.names.concat(n))}function gn(t,e,n){fn(t,e).defineRulesFromMappings(cn,an,n)}function Nn(t,e,n,r){fn(n,n).defineRuleFromStrings(cn,an,t,e,r)}function Sn(t){if(!ln(t))for(const[e,n]of Object.entries(t))Nn("default","default",e,n)}function En(t){for(let e,n=0;e=t.names[n];n++)gn(t.key,e,t.mappings)}function bn(t){for(const e of Object.keys(un)){const n=Object.assign({},t);n.mappings={};const r=un[e];n.names=n.names.map((function(t){return e+t}));for(const e of Object.keys(t.mappings)){n.mappings[e]={};for(const s of Object.keys(t.mappings[e]))n.mappings[e][s]=xe[cn]().FUNCTIONS.si(r,t.mappings[e][s])}En(n)}}function An(t={}){for(const e of dn.values())for(const[,n]of e.rules.entries())for(const{cstr:e}of n)t=yn(e.getValues(),t);return t}function yn(t,e){return e=e||{},t.length?(e[t[0]]=yn(t.slice(1),e[t[0]]),e):e}N.getInstance().evaluator=function(t,e){const n=function(t,e){const n=dn.get(t);return n?n.lookupRule(null,e):null}(t,e);return n?n.action:null};class Tn{constructor(t,e){this.speech=t,this.attributes=e}static empty(){return new Tn("",{})}static stringEmpty(t){return new Tn(t,{})}static stringAttr(t,e){return new Tn(t,e)}static singleton(t,e={}){return[Tn.stringAttr(t,e)]}static node(t,e,n={}){const r=Tn.getAttributes(e);return Object.assign(r,n),new Tn(t,r)}static getAttributes(t){const e={};for(const n of Tn.attributeList)t.hasAttribute(n)&&(e[n]=t.getAttribute(n));return e}}Tn.attributeList=["id","extid"];class _n{static create(t,e={}){return t.text=tt.getInstance().apply(t.text,e),new _n(t)}constructor({context:t,text:e,userValue:n,annotation:r,attributes:s,personality:o,layout:i}){this.context=t||"",this.text=e||"",this.userValue=n||"",this.annotation=r||"",this.attributes=s||{},this.personality=o||{},this.layout=i||""}isEmpty(){return 0===this.context.length&&0===this.text.length&&0===this.userValue.length&&0===this.annotation.length}clone(){let t,e;if(this.personality){t={};for(const[e,n]of Object.entries(this.personality))t[e]=n}if(this.attributes){e={};for(const[t,n]of Object.entries(this.attributes))e[t]=n}return new _n({context:this.context,text:this.text,userValue:this.userValue,annotation:this.annotation,personality:t,attributes:e,layout:this.layout})}toString(){return'AuditoryDescription(context="'+this.context+'"  text="'+this.text+'"  userValue="'+this.userValue+'"  annotation="'+this.annotation+'")'}descriptionString(){return this.context&&this.text?this.context+" "+this.text:this.context||this.text}descriptionSpan(){return Tn.stringAttr(this.descriptionString(),this.attributes)}equals(t){return this.context===t.context&&this.text===t.text&&this.userValue===t.userValue&&this.annotation===t.annotation}}const In=new Map;function Cn(t,e,n){const r={};if(e){const t=In.get(e)||{};Object.assign(r,t)}In.set(t,Object.assign(r,n))}function On(t,e){const n=t.length;let r=0,s=e;return e||(s=""),function(){return r<n&&(r+=1),s+" "+r}}function xn(t,e){const n=parseFloat(e),r=isNaN(n)?e:n;return function(){return[_n.create({text:"",personality:{pause:r}})]}}function Ln(t,e){let n;return n=t.length>0?I("../../content/*",t[0]):[],function(){const t=n.shift(),r=e?[_n.create({text:e},{translate:!0})]:[];if(!t)return r;const s=N.evaluateNode(t);return r.concat(s)}}class Mn{constructor(t,e,n){this.domain=t,this.name=e,this.func=n,this.active=!1}annotate(t){t.childNodes.forEach(this.annotate.bind(this)),t.addAnnotation(this.domain,this.func(t))}}class Rn{constructor(t,e,n,r={}){this.domain=t,this.name=e,this.func=n,this.def=r,this.active=!1}visit(t,e){let n=this.func(t,e);t.addAnnotation(this.domain,n[0]);for(let e,r=0;e=t.childNodes[r];r++)n=this.visit(e,n[1]);return n}}const vn=new Map,Fn=new Map;function wn(t){const e=t.domain+":"+t.name;t instanceof Mn?vn.set(e,t):Fn.set(e,t)}function Dn(t,e){const n=t+":"+e,r=vn.get(n)||Fn.get(n);r&&(r.active=!0)}function Pn(t,e){const n=e.split("-"),r=On(t,n[0]||""),s=n[1]||"",o=n[2]||"";let i=!0;return function(){const t=r();return i?(i=!1,o+t+s):t+s}}function kn(t){return $n(t)||function(t){return Bn(t)||"infixop"===t.type&&"implicit"===t.role&&(2===t.childNodes.length&&(Bn(t.childNodes[0])||$n(t.childNodes[0]))&&Bn(t.childNodes[1])||3===t.childNodes.length&&$n(t.childNodes[0])&&Bn(t.childNodes[1])&&Bn(t.childNodes[2]))}(t)||function(t){return"punctuated"===t.type&&"endpunct"===t.role&&2===t.childNodes.length&&"degree"===t.childNodes[1].role&&(Bn(t.childNodes[0])||jn(t.childNodes[0])||"prefixop"===t.childNodes[0].type&&"negative"===t.childNodes[0].role&&(Bn(t.childNodes[0].childNodes[0])||jn(t.childNodes[0].childNodes[0])))}(t)||function(t){return"prefixop"===t.type&&"negative"===t.role&&Un(t.childNodes[0])&&"prefixop"!==t.childNodes[0].type&&"appl"!==t.childNodes[0].type&&"punctuated"!==t.childNodes[0].type}(t)||function(t){return"appl"===t.type&&("prefix function"===t.childNodes[0].role||"simple function"===t.childNodes[0].role)&&(Un(t.childNodes[1])||"fenced"===t.childNodes[1].type&&Un(t.childNodes[1].childNodes[0]))}(t)}function Un(t){return t.hasAnnotation("clearspeak","simple")}function Bn(t){return"identifier"===t.type&&("latinletter"===t.role||"greekletter"===t.role||"otherletter"===t.role||"simple function"===t.role)}function jn(t){return"number"===t.type&&("integer"===t.role||"float"===t.role)}function $n(t){return jn(t)||function(t){if(Gn("Fraction_Over")||Gn("Fraction_FracOver"))return!1;if("fraction"!==t.type||"vulgar"!==t.role)return!1;if(Gn("Fraction_Ordinal"))return!0;const e=parseInt(t.childNodes[0].textContent,10),n=parseInt(t.childNodes[1].textContent,10);return e>0&&e<20&&n>0&&n<11}(t)}function Gn(t){return N.getInstance().style===t}function Vn(t){if(function(t){if(!t.hasAttribute("annotation"))return!1;const e=t.getAttribute("annotation");return!!/clearspeak:simple$|clearspeak:simple;/.exec(e)}(t))return!0;if("subscript"!==t.tagName)return!1;const e=t.childNodes[0].childNodes,n=e[1];return"identifier"===e[0].tagName&&(Hn(n)||"infixop"===n.tagName&&n.hasAttribute("role")&&"implicit"===n.getAttribute("role")&&function(t){const e=I("children/*",t);return e.every((t=>Hn(t)||"identifier"===t.tagName))}(n))}function Hn(t){return"number"===t.tagName&&t.hasAttribute("role")&&"integer"===t.getAttribute("role")}function Yn(t){return I("matrix"===t.tagName?"children/row/children/cell/children/*":"children/line/children/*",t).every(Vn)?[t]:[]}function qn(t){return Y(t,20,11)?[t]:[]}function Wn(t){const e=parseInt(t.textContent,10);return[Tn.stringEmpty(isNaN(e)?t.textContent:e>10?W.NUMBERS.numericOrdinal(e):W.NUMBERS.wordOrdinal(e))]}wn(new Mn("clearspeak","simple",(function(t){return kn(t)?"simple":""}))),wn(new Mn("clearspeak","unit",(function(t){return function(t){return"text"===t.type||"punctuated"===t.type&&"text"===t.role&&jn(t.childNodes[0])&&function(t){for(let e=0;e<t.length-1;e++)if("text"!==t[e].type||""!==t[e].textContent)return!1;return"text"===t[t.length-1].type}(t.childNodes.slice(1))||"identifier"===t.type&&"unit"===t.role||"infixop"===t.type&&("implicit"===t.role||"unit"===t.role)}(t)?"unit":""})));let Xn=null;function Kn(t){let e=0;const n=t.textContent,r="open"===t.getAttribute("role")?0:1;let s=t.parentNode;for(;s;)"fenced"===s.tagName&&s.childNodes[0].childNodes[r].textContent===n&&e++,s=s.parentNode;return Xn=e>1?W.NUMBERS.wordOrdinal(e):"",[Tn.stringEmpty(Xn)]}function zn(t){const e=t.previousSibling;let n,r;return e?(n=e,r=t):(n=t,r=t.nextSibling),r&&function(t,e){const n=Ze.Meaning.get(t);return"fence"===n.type&&("neutral"===n.role||"metric"===n.role?t===e:Ze.FencesHoriz.get(t)===e||Ze.FencesVert.get(t)===e)}(n.textContent,r.textContent)?[t]:[]}function Zn(t){const e=O(t.parentNode.childNodes),n=I("../../children/*",t),r=e.indexOf(t);return tr(n[r])||tr(n[r+1])?[t]:[]}function Jn(t){const e=O(t.parentNode.childNodes),n=I("../../children/*",t),r=e.indexOf(t);return Qn(n[r])&&n[r+1]&&(Qn(n[r+1])||"root"===n[r+1].tagName||"sqrt"===n[r+1].tagName||"superscript"===n[r+1].tagName&&n[r+1].childNodes[0].childNodes[0]&&("number"===n[r+1].childNodes[0].childNodes[0].tagName||"identifier"===n[r+1].childNodes[0].childNodes[0].tagName)&&("2"===n[r+1].childNodes[0].childNodes[1].textContent||"3"===n[r+1].childNodes[0].childNodes[1].textContent))?[t]:[]}function Qn(t){return!!t&&("number"===t.tagName||"identifier"===t.tagName||"function"===t.tagName||"appl"===t.tagName||"fraction"===t.tagName)}function tr(t){return t&&("fenced"===t.tagName||t.hasAttribute("role")&&"leftright"===t.getAttribute("role")||function(t){return!!t&&("matrix"===t.tagName||"vector"===t.tagName)}(t))}function er(t){return[Tn.stringEmpty(W.NUMBERS.wordOrdinal(parseInt(t.textContent,10)))]}function nr(t,e){const n=[];for(;t.length||e.length;)t.length&&n.push(t.shift()),e.length&&n.push(e.shift());return n}function rr(t,e){return t?e?t.filter((t=>e.indexOf(t)<0)):t:[]}tt.getInstance().setCorrection("insertNesting",(function(t,e){if(!e||!t)return t;const n=t.match(/^(open|close) /);return n?n[0]+e+" "+t.substring(n[0].length):e+" "+t}));let sr=null;function or(t){sr=t}const ir=new Map,cr={combine_juxtaposition:!0,convert_juxtaposition:!0,multioperator:!0},ar={};function lr(t){const e=t.name;ir.set(e,t),cr[e]||(cr[e]=!1)}function ur(t,e,n){const r=ir.get(t);return r&&!ar[t]&&(cr[t]||r.applicable(e))?r.apply(e):n?n(e):e}const hr=[];function dr(t,e){for(let n,r=0;n=hr[r];r++){const r=n.compare(t,e);if(0!==r)return r}return 0}function pr(t){if(t.length<=1)return t;const e=t.slice();!function(t){t.sort(dr)}(e);const n=[];let r;do{r=e.pop(),n.push(r)}while(r&&e.length&&0===dr(e[e.length-1],r));return n}function fr(t,e){return t.match(/^.+:.+$/)||!e?t:t+":"+e}new class{constructor(t,e=null){this.comparator=t,this.type=e,function(t){hr.push(t)}(this)}compare(t,e){return this.type&&this.type===t.type&&this.type===e.type?this.comparator(t,e):0}}((function(t,e){return"simple function"===t.role?1:"simple function"===e.role?-1:0}),"identifier");class mr extends Map{set(t,e){return super.set(fr(t,e.font),e),this}setNode(t){this.set(t.textContent,t.meaning())}get(t,e=null){return super.get(fr(t,e))}getNode(t){return this.get(t.textContent,t.font)}}class gr extends Map{add(t,e){const n=this.get(t);n?n.push(e):super.set(t,[e])}get(t,e=null){return super.get(fr(t,e))}getNode(t){return this.get(t.textContent,t.font)}minimize(){for(const[t,e]of this)1===e.length&&this.delete(t)}isMultiValued(){for(const t of this.values())if(t.length>1)return!0;return!1}}class Nr extends gr{add(t,e){super.add(fr(t,e.font),e)}addNode(t){this.add(t.textContent,t)}toString(){const t=[];for(const[e,n]of this){const r=Array(e.length+3).join(" "),s=n.map((t=>t.toString())).join("\n"+r);t.push(e+": "+s)}return t.join("\n")}collateMeaning(){const t=new Sr;for(const[e,n]of this)t.set(e,n.map((t=>t.meaning())));return t}}class Sr extends gr{add(t,e){const n=this.get(t,e.font);n&&n.find((function(t){return r=e,(n=t).type===r.type&&n.role===r.role&&n.font===r.font;var n,r}))||super.add(fr(t,e.font),e)}addNode(t){this.add(t.textContent,t.meaning())}toString(){const t=[];for(const[e,n]of this){const r=Array(e.length+3).join(" "),s=n.map((t=>`{type: ${t.type}, role: ${t.role}, font: ${t.font}}`)).join("\n"+r);t.push(e+": "+s)}return t.join("\n")}reduce(){for(const[t,e]of this)1!==e.length&&this.set(t,pr(e))}default(){const t=new mr;for(const[e,n]of this)1===n.length&&t.set(e,n[0]);return t}newDefault(){const t=this.default();this.reduce();const e=this.default();return t.size!==e.size?e:null}}const Er=["MO","MI","MN","MTEXT","MS","MSPACE"],br=["MERROR","MPHANTOM","MALIGNGROUP","MALIGNMARK","MPRESCRIPTS","ANNOTATION","ANNOTATION-XML"],Ar=["MATH","MROW","MPADDED","MACTION","NONE","MSTYLE","SEMANTICS"],yr=["MROOT","MSQRT"],Tr=["aria-label","exact-speech","alt"];function _r(t){return!!t&&"MATH"===k(t)}function Ir(t){return!!t&&-1!==br.indexOf(k(t))}function Cr(t){return!!t&&-1!==Ar.indexOf(k(t))}function Or(t){return!!t&&"MGLYPH"===k(t)&&!function(t){return!!t&&-1!==Er.indexOf(k(t))}(t.parentNode)}function xr(t){const e=[];for(let n,r=0;n=t[r];r++){if(n.nodeType!==L.ELEMENT_NODE)continue;const t=k(n);-1===br.indexOf(t)&&(-1!==Ar.indexOf(t)&&0===n.childNodes.length||e.push(n))}return e}function Lr(t,e){if(e.hasAttributes()){const n=e.attributes;for(let e=n.length-1;e>=0;e--){const r=n[e].name;r.match(/^ext/)&&(t.attributes[r]=n[e].value,t.nobreaking=!0),-1!==Tr.indexOf(r)&&(t.attributes["ext-speech"]=n[e].value,t.nobreaking=!0),r.match(/texclass$/)&&(t.attributes.texclass=n[e].value),"latex"===r&&(t.attributes.latex=n[e].value),"href"===r&&(t.attributes.href=n[e].value,t.nobreaking=!0)}}}function Mr(t){return t&&t.embellished&&t.childNodes.length>0?Mr(t.childNodes[0]):t}function Rr(t,e,n){n&&t.reverse();const r=[];for(let s,o=0;s=t[o];o++){if(e(s))return n?{head:t.slice(o+1).reverse(),div:s,tail:r.reverse()}:{head:r,div:s,tail:t.slice(o+1)};r.push(s)}return n?{head:[],div:null,tail:r.reverse()}:{head:r,div:null,tail:[]}}function vr(t,e){let n=t;const r=[],s=[];let o=null;do{o=Rr(n,e),s.push(o.head),r.push(o.div),n=o.tail}while(o.div);return r.pop(),{rel:r,comp:s}}class Fr{static fromXml(t){const e=parseInt(t.getAttribute("id"),10),n=new Fr(e);return n.type=t.tagName,Fr.setAttribute(n,t,"role"),Fr.setAttribute(n,t,"font"),Fr.setAttribute(n,t,"embellished"),Fr.setAttribute(n,t,"fencepointer","fencePointer"),t.getAttribute("annotation")&&n.parseAnnotation(t.getAttribute("annotation")),Lr(n,t),Fr.processChildren(n,t),n}static setAttribute(t,e,n,r){r=r||n;const s=e.getAttribute(n);s&&(t[r]=s)}static processChildren(t,e){for(const n of O(e.childNodes)){if(n.nodeType===L.TEXT_NODE){t.textContent=n.textContent;continue}const e=O(n.childNodes).map(Fr.fromXml);e.forEach((e=>e.parent=t)),"CONTENT"===k(n)?t.contentNodes=e:t.childNodes=e}}constructor(t){this.id=t,this.mathml=[],this.parent=null,this.type="unknown",this.role="unknown",this.font=We.UNKNOWN,this.embellished=null,this.fencePointer="",this.childNodes=[],this.textContent="",this.mathmlTree=null,this.contentNodes=[],this.annotation={},this.attributes={},this.nobreaking=!1}querySelectorAll(t){let e=[];for(let n,r=0;n=this.childNodes[r];r++)e=e.concat(n.querySelectorAll(t));for(let n,r=0;n=this.contentNodes[r];r++)e=e.concat(n.querySelectorAll(t));return t(this)&&e.unshift(this),e}xml(t,e){const n=function(n,r){const s=r.map((function(n){return n.xml(t,e)})),o=t.createElementNS("",n);for(let t,e=0;t=s[e];e++)o.appendChild(t);return o},r=t.createElementNS("",this.type);return e||this.xmlAttributes(r),r.textContent=this.textContent,this.contentNodes.length>0&&r.appendChild(n("content",this.contentNodes)),this.childNodes.length>0&&r.appendChild(n("children",this.childNodes)),r}toString(t=!1){const e=x("<snode/>");return B(this.xml(e.ownerDocument,t))}allAttributes(){const t=[];return t.push(["role",this.role]),this.font!==We.UNKNOWN&&t.push(["font",this.font]),Object.keys(this.annotation).length&&t.push(["annotation",this.annotationXml()]),this.embellished&&t.push(["embellished",this.embellished]),this.fencePointer&&t.push(["fencepointer",this.fencePointer]),t.push(["id",this.id.toString()]),t}annotationXml(){const t=[];for(const[e,n]of Object.entries(this.annotation))n.forEach((n=>t.push(e+":"+n)));return t.join(";")}attributesXml(){const t=[];for(const[e,n]of Object.entries(this.attributes))t.push(e+":"+n);return t.join(";")}toJson(){const t={};t.type=this.type;const e=this.allAttributes();for(let n,r=0;n=e[r];r++)t[n[0]]=n[1].toString();return this.textContent&&(t.$t=this.textContent),this.childNodes.length&&(t.children=this.childNodes.map((function(t){return t.toJson()}))),this.contentNodes.length&&(t.content=this.contentNodes.map((function(t){return t.toJson()}))),t}updateContent(t,e){const n=e?t.replace(/^[ \f\n\r\t\v\u200b]*/,"").replace(/[ \f\n\r\t\v\u200b]*$/,""):t.trim();if(t=t&&!n?t:n,this.textContent===t)return;const r=Ze.Meaning.get(t);this.textContent=t,this.role=r.role,this.type=r.type,this.font=r.font}addMathmlNodes(t){for(let e,n=0;e=t[n];n++)-1===this.mathml.indexOf(e)&&this.mathml.push(e)}appendChild(t){this.childNodes.push(t),this.addMathmlNodes(t.mathml),t.parent=this}replaceChild(t,e){const n=this.childNodes.indexOf(t);if(-1===n)return;t.parent=null,e.parent=this,this.childNodes[n]=e;const r=t.mathml.filter((function(t){return-1===e.mathml.indexOf(t)})),s=e.mathml.filter((function(e){return-1===t.mathml.indexOf(e)}));this.removeMathmlNodes(r),this.addMathmlNodes(s)}appendContentNode(t){t&&(this.contentNodes.push(t),this.addMathmlNodes(t.mathml),t.parent=this)}removeContentNode(t){if(t){const e=this.contentNodes.indexOf(t);-1!==e&&this.contentNodes.slice(e,1)}}equals(t){if(!t)return!1;if(this.type!==t.type||this.role!==t.role||this.textContent!==t.textContent||this.childNodes.length!==t.childNodes.length||this.contentNodes.length!==t.contentNodes.length)return!1;for(let e,n,r=0;e=this.childNodes[r],n=t.childNodes[r];r++)if(!e.equals(n))return!1;for(let e,n,r=0;e=this.contentNodes[r],n=t.contentNodes[r];r++)if(!e.equals(n))return!1;return!0}displayTree(){console.info(this.displayTree_(0))}addAnnotation(t,e){e&&this.addAnnotation_(t,e)}getAnnotation(t){const e=this.annotation[t];return e||[]}hasAnnotation(t,e){const n=this.annotation[t];return!!n&&-1!==n.indexOf(e)}parseAnnotation(t){const e=t.split(";");for(let t=0,n=e.length;t<n;t++){const n=e[t].split(":");this.addAnnotation(n[0],n[1])}}meaning(){return{type:this.type,role:this.role,font:this.font}}xmlAttributes(t){const e=this.allAttributes();for(let n,r=0;n=e[r];r++)t.setAttribute(n[0],n[1]);this.addExternalAttributes(t)}addExternalAttributes(t){for(const[e,n]of Object.entries(this.attributes))t.setAttribute(e,n)}parseAttributes(t){if(!t)return;const e=t.split(";");for(let t=0,n=e.length;t<n;t++){const[n,r]=e[t].split(":");n&&(this.attributes[n]=r)}}removeMathmlNodes(t){const e=this.mathml;for(let n,r=0;n=t[r];r++){const t=e.indexOf(n);-1!==t&&e.splice(t,1)}this.mathml=e}displayTree_(t){t++;const e=Array(t).join("  ");let n="";n+="\n"+e+this.toString(),n+="\n"+e+"MathmlTree:",n+="\n"+e+this.mathmlTreeString(),n+="\n"+e+"MathML:";for(let t,r=0;t=this.mathml[r];r++)n+="\n"+e+t.toString();return n+="\n"+e+"Begin Content",this.contentNodes.forEach((function(e){n+=e.displayTree_(t)})),n+="\n"+e+"End Content",n+="\n"+e+"Begin Children",this.childNodes.forEach((function(e){n+=e.displayTree_(t)})),n+="\n"+e+"End Children",n}mathmlTreeString(){return this.mathmlTree?this.mathmlTree.toString():"EMPTY"}addAnnotation_(t,e){const n=this.annotation[t];n?n.push(e):this.annotation[t]=[e]}}class wr{constructor(){this.leafMap=new Nr,this.defaultMap=new mr,this.idCounter_=-1}makeNode(t){return this.createNode_(t)}makeUnprocessed(t){const e=this.createNode_();return e.mathml=[t],e.mathmlTree=t,e}makeEmptyNode(){const t=this.createNode_();return t.type="empty",t}makeContentNode(t){const e=this.createNode_();return e.updateContent(t),e}makeMultipleContentNodes(t,e){const n=[];for(let r=0;r<t;r++)n.push(this.makeContentNode(e));return n}makeLeafNode(t,e){if(!t)return this.makeEmptyNode();const n=this.makeContentNode(t);n.font=e||n.font;const r=this.defaultMap.getNode(n);return r&&(n.type=r.type,n.role=r.role,n.font=r.font),this.leafMap.addNode(n),n}makeBranchNode(t,e,n,r){const s=this.createNode_();return r&&s.updateContent(r),s.type=t,s.childNodes=e,s.contentNodes=n,e.concat(n).forEach((function(t){t.parent=s,s.addMathmlNodes(t.mathml)})),s}createNode_(t){return void 0!==t?this.idCounter_=Math.max(this.idCounter_,t):t=++this.idCounter_,new Fr(t)}}function Dr(t,e){return t.type===e}function Pr(t,e){return t.embellished===e}function kr(t,e){return t.role===e}function Ur(t){return Dr(t,"fence")||Dr(t,"punctuation")||Dr(t,"operator")||Dr(t,"relation")}function Br(t){return Yr(t)&&!kr(t,"division")||Dr(t,"appl")||Vr(t)}function jr(t){return Yr(t)||Vr(t)}function $r(t,e){return!!e&&Dr(e,"identifier")&&Ze.Secondary.has(t.textContent,Ke.D)}function Gr(t){if(Dr(t,"identifier")){const e=t.textContent[0];return e&&t.textContent[1]&&Ze.Secondary.has(e,Ke.D)}return!1}function Vr(t){return qr(t)||Wr(t)}function Hr(t){return t.embellished?t.embellished:"operator"===(e=t.type)||"relation"===e||"fence"===e||"punctuation"===e?t.type:null;var e}function Yr(t){return Dr(t,"operator")||Pr(t,"operator")}function qr(t){return Dr(t,"relation")||Pr(t,"relation")}function Wr(t){return Dr(t,"punctuation")||Pr(t,"punctuation")}function Xr(t){return Dr(t,"fence")||Pr(t,"fence")}function Kr(t){return!(!t||!Xr(t))&&(!t.embellished||zr(t))}function zr(t){return!t.embellished||!function(t){return Dr(t,"tensor")&&(!Dr(t.childNodes[1],"empty")||!Dr(t.childNodes[2],"empty"))&&(!Dr(t.childNodes[3],"empty")||!Dr(t.childNodes[4],"empty"))}(t)&&((!kr(t,"close")||!Dr(t,"tensor"))&&((!kr(t,"open")||!Dr(t,"subscript")&&!Dr(t,"superscript"))&&zr(t.childNodes[0])))}function Zr(t){return!!t&&(Dr(t,"table")||Dr(t,"multiline"))}function Jr(t){return!!t&&Qr(t)&&Zr(t.childNodes[0])}function Qr(t){return!!t&&Dr(t,"fenced")&&(kr(t,"leftright")||ps(t))&&1===t.childNodes.length}function ts(t,e){return e.length>0&&kr(e[e.length-1],"openfence")}function es(t){return t.childNodes.every((function(t){return t.childNodes.length<=1}))}function ns(t){return Dr(t,"largeop")||Dr(t,"limboth")||Dr(t,"limlower")||Dr(t,"limupper")||Dr(t,"function")&&kr(t,"limit function")||(Dr(t,"overscore")||Dr(t,"underscore"))&&ns(t.childNodes[0])}function rs(t,e,n){return 1===e.length&&("punctuation"===t[n].type||"punctuation"===t[n].embellished)&&t[n]===e[0]}function ss(t){return Dr(t,"identifier")&&kr(t,"simple function")}const os=["punctuation","punctuated","relseq","multirel","table","multiline","cases","inference"],is=["limupper","limlower","limboth","subscript","superscript","underscore","overscore","tensor"];function cs(t){const e=t.type;return-1===os.indexOf(e)&&("infixop"!==e||"implicit"===t.role)&&("fenced"===e?"leftright"!==t.role||cs(t.childNodes[0]):-1===is.indexOf(e)||cs(t.childNodes[0]))}function as(t){return function(t){return"number"===t.type&&("integer"===t.role||"float"===t.role)}(t)||"vulgar"===t.role||"mixed"===t.role}function ls(t){const e=t.childNodes;return"unit"===t.role&&(!e.length||"unit"===e[0].role)}function us(t){const e=t.childNodes;return"infixop"===t.type&&("multiplication"===t.role||"implicit"===t.role)&&e.length&&(ls(e[0])||as(e[0]))&&t.childNodes.slice(1).every(ls)}function hs(t){return"infixop"===t.type&&("implicit"===t.role||"unit"===t.role&&!!t.contentNodes.length&&t.contentNodes[0].textContent===ze.invisibleTimes)}function ds(t){return"infixop"===t.type&&"implicit"===t.role}function ps(t){return"neutral"===t.role||"metric"===t.role}function fs(t,e){return ps(t)&&ps(e)&&Mr(t).textContent===Mr(e).textContent}function ms(t){return!!ps(t)&&(!t.embellished||"superscript"!==t.type&&"subscript"!==t.type&&("tensor"!==t.type||"empty"===t.childNodes[3].type&&"empty"===t.childNodes[4].type))}function gs(t){return!!ps(t)&&(!t.embellished||("tensor"!==t.type||"empty"===t.childNodes[1].type&&"empty"===t.childNodes[2].type))}class Ns{static getInstance(){return Ns.instance=Ns.instance||new Ns,Ns.instance}static tableToMultiline(t){if(!es(t))return ur("rewrite_subcases",t,Ns.classifyTable);t.type="multiline";for(let e,n=0;e=t.childNodes[n];n++)Ns.rowToLine_(e,"multiline");var e;return 1!==t.childNodes.length||Dr(e=t.childNodes[0],"line")&&e.contentNodes.length&&kr(e.contentNodes[0],"label")||!Qr(t.childNodes[0].childNodes[0])||Ns.tableToMatrixOrVector_(Ns.rewriteFencedLine_(t)),Ns.binomialForm_(t),Ns.classifyMultiline(t),t}static number(t){"unknown"!==t.type&&"identifier"!==t.type||(t.type="number"),Ns.numberRole_(t),Ns.exprFont_(t)}static classifyMultiline(t){let e=0;const n=t.childNodes.length;let r;for(;e<n&&(!(r=t.childNodes[e])||!r.childNodes.length);)e++;if(e>=n)return;const s=r.childNodes[0].role;"unknown"!==s&&t.childNodes.every((function(t){const e=t.childNodes[0];return!e||e.role===s&&(Dr(e,"relation")||Dr(e,"relseq"))}))&&(t.role=s)}static classifyTable(t){const e=Ns.computeColumns_(t);return Ns.classifyByColumns_(t,e,"equality")||Ns.classifyByColumns_(t,e,"inequality",["equality"])||Ns.classifyByColumns_(t,e,"arrow")||Ns.detectCaleyTable(t),t}static detectCaleyTable(t){if(!t.mathmlTree)return!1;const e=t.mathmlTree,n=e.getAttribute("columnlines"),r=e.getAttribute("rowlines");return!(!n||!r)&&(!(!Ns.cayleySpacing(n)||!Ns.cayleySpacing(r))&&(t.role="cayley",!0))}static cayleySpacing(t){const e=t.split(" ");return("solid"===e[0]||"dashed"===e[0])&&e.slice(1).every((t=>"none"===t))}static proof(t,e,n){const r=Ns.separateSemantics(e);return Ns.getInstance().proof(t,r,n)}static findSemantics(t,e,n){const r=null==n?null:n,s=Ns.getSemantics(t);return!!s&&(!!s[e]&&(null==r||s[e]===r))}static getSemantics(t){const e=t.getAttribute("semantics");return e?Ns.separateSemantics(e):null}static removePrefix(t){const[,...e]=t.split("_");return e.join("_")}static separateSemantics(t){const e={};return t.split(";").forEach((function(t){const[n,r]=t.split(":");e[Ns.removePrefix(n)]=r})),e}static matchSpaces_(t,e){for(let n,r=0;n=e[r];r++){const e=t[r].mathmlTree,s=t[r+1].mathmlTree;if(!e||!s)continue;const o=e.nextSibling;if(!o||o===s)continue;const i=Ns.getSpacer_(o);i&&(n.mathml.push(i),n.mathmlTree=i,n.role="space")}}static getSpacer_(t){if("MSPACE"===k(t))return t;for(;Cr(t)&&1===t.childNodes.length;)if("MSPACE"===k(t=t.childNodes[0]))return t;return null}static fenceToPunct_(t){const e=Ns.FENCE_TO_PUNCT_[t.role];if(e){for(;t.embellished;)t.embellished="punctuation",kr(t,"subsup")||kr(t,"underover")||(t.role=e),t=t.childNodes[0];t.type="punctuation",t.role=e}}static classifyFunction_(t,e){if("appl"===t.type||"bigop"===t.type||"integral"===t.type)return"";if(e[0]&&e[0].textContent===ze.functionApplication){Ns.getInstance().funcAppls[t.id]=e.shift();let n="simple function";return ur("simple2prefix",t),"prefix function"!==t.role&&"limit function"!==t.role||(n=t.role),Ns.propagateFunctionRole_(t,n),"prefix"}const n=Ns.CLASSIFY_FUNCTION_[t.role];return n||("identifier"===(r=t).type||"latinletter"===r.role||"greekletter"===r.role||"otherletter"===r.role?"simple":"");var r}static propagateFunctionRole_(t,e){if(t){if("infixop"===t.type)return;kr(t,"subsup")||kr(t,"underover")||(t.role=e),Ns.propagateFunctionRole_(t.childNodes[0],e)}}static getFunctionOp_(t,e){if(e(t))return t;for(let n,r=0;n=t.childNodes[r];r++){const t=Ns.getFunctionOp_(n,e);if(t)return t}return null}static tableToMatrixOrVector_(t){const e=t.childNodes[0];Dr(e,"multiline")?Ns.tableToVector_(t):Ns.tableToMatrix_(t),t.contentNodes.forEach(e.appendContentNode.bind(e));for(let t,n=0;t=e.childNodes[n];n++)Ns.assignRoleToRow_(t,Ns.getComponentRoles_(e));return e.parent=null,e}static tableToVector_(t){const e=t.childNodes[0];e.type="vector",1!==e.childNodes.length?Ns.binomialForm_(e):Ns.tableToSquare_(t)}static binomialForm_(t){2===t.childNodes.length&&(t.role="binomial",t.childNodes[0].role="binomial",t.childNodes[1].role="binomial")}static tableToMatrix_(t){const e=t.childNodes[0];e.type="matrix",e.childNodes&&e.childNodes.length>0&&e.childNodes[0].childNodes&&e.childNodes.length===e.childNodes[0].childNodes.length?Ns.tableToSquare_(t):e.childNodes&&1===e.childNodes.length&&(e.role="rowvector")}static tableToSquare_(t){const e=t.childNodes[0];ps(t)?e.role="determinant":e.role="squarematrix"}static getComponentRoles_(t){const e=t.role;return e&&"unknown"!==e?e:t.type.toLowerCase()||"unknown"}static tableToCases_(t,e){for(let e,n=0;e=t.childNodes[n];n++)Ns.assignRoleToRow_(e,"cases");return t.type="cases",t.appendContentNode(e),es(t)&&Ns.binomialForm_(t),t}static rewriteFencedLine_(t){const e=t.childNodes[0],n=t.childNodes[0].childNodes[0],r=t.childNodes[0].childNodes[0].childNodes[0];return n.parent=t.parent,t.parent=n,r.parent=e,n.childNodes=[t],e.childNodes=[r],n}static rowToLine_(t,e){const n=e||"unknown";Dr(t,"row")&&(t.type="line",t.role=n,1===t.childNodes.length&&Dr(t.childNodes[0],"cell")&&(t.childNodes=t.childNodes[0].childNodes,t.childNodes.forEach((function(e){e.parent=t}))))}static assignRoleToRow_(t,e){Dr(t,"line")?t.role=e:Dr(t,"row")&&(t.role=e,t.childNodes.forEach((function(t){Dr(t,"cell")&&(t.role=e)})))}static nextSeparatorFunction_(t){let e;if(t){if(t.match(/^\s+$/))return null;e=t.replace(/\s/g,"").split("").filter((function(t){return t}))}else e=[","];return function(){return e.length>1?e.shift():e[0]}}static numberRole_(t){if("unknown"!==t.role)return;const e=[...t.textContent].filter((t=>t.match(/[^\s]/))),n=e.map((t=>Ze.Meaning.get(t)));if(n.every((function(t){return"number"===t.type&&"integer"===t.role||"punctuation"===t.type&&"comma"===t.role})))return t.role="integer",void("0"===e[0]&&t.addAnnotation("general","basenumber"));n.every((function(t){return"number"===t.type&&"integer"===t.role||"punctuation"===t.type}))?t.role="float":t.role="othernumber"}static exprFont_(t){if(t.font!==We.UNKNOWN)return;const e=[...t.textContent].map((t=>Ze.Meaning.get(t))).reduce((function(t,e){return t&&e.font&&e.font!==We.UNKNOWN&&e.font!==t?t===We.UNKNOWN?e.font:null:t}),We.UNKNOWN);e&&(t.font=e)}static purgeFences_(t){const e=t.rel,n=t.comp,r=[],s=[];for(;e.length>0;){const t=e.shift();let o=n.shift();Kr(t)?(r.push(t),s.push(o)):(Ns.fenceToPunct_(t),o.push(t),o=o.concat(n.shift()),n.unshift(o))}return s.push(n.shift()),{rel:r,comp:s}}static rewriteFencedNode_(t){const e=t.contentNodes[0],n=t.contentNodes[1];let r=Ns.rewriteFence_(t,e);return t.contentNodes[0]=r.fence,r=Ns.rewriteFence_(r.node,n),t.contentNodes[1]=r.fence,t.contentNodes[0].parent=t,t.contentNodes[1].parent=t,r.node.parent=null,r.node}static rewriteFence_(t,e){if(!e.embellished)return{node:t,fence:e};const n=e.childNodes[0],r=Ns.rewriteFence_(t,n);return Dr(e,"superscript")||Dr(e,"subscript")||Dr(e,"tensor")?(kr(e,"subsup")||(e.role=t.role),n!==r.node&&(e.replaceChild(n,r.node),n.parent=t),Ns.propagateFencePointer_(e,n),{node:e,fence:r.fence}):(e.replaceChild(n,r.fence),e.mathmlTree&&-1===e.mathml.indexOf(e.mathmlTree)&&e.mathml.push(e.mathmlTree),{node:r.node,fence:e})}static propagateFencePointer_(t,e){t.fencePointer=e.fencePointer||e.id.toString(),t.embellished=null}static classifyByColumns_(t,e,n,r){return!!(3===e.length&&Ns.testColumns_(e,1,(t=>Ns.isPureRelation_(t,n)))||2===e.length&&(Ns.testColumns_(e,1,(t=>Ns.isEndRelation_(t,n)||Ns.isPureRelation_(t,n)))||Ns.testColumns_(e,0,(t=>Ns.isEndRelation_(t,n,!0)||Ns.isPureRelation_(t,n)))))&&(t.role=n,!0)}static isEndRelation_(t,e,n){const r=n?t.childNodes.length-1:0;return Dr(t,"relseq")&&kr(t,e)&&Dr(t.childNodes[r],"empty")}static isPureRelation_(t,e){return Dr(t,"relation")&&kr(t,e)}static computeColumns_(t){const e=[];for(let n,r=0;n=t.childNodes[r];r++)for(let t,r=0;t=n.childNodes[r];r++){e[r]?e[r].push(t):e[r]=[t]}return e}static testColumns_(t,e,n){const r=t[e];return!!r&&(r.some((function(t){return t.childNodes.length&&n(t.childNodes[0])}))&&r.every((function(t){return!t.childNodes.length||n(t.childNodes[0])})))}setNodeFactory(t){Ns.getInstance().factory_=t,or(Ns.getInstance().factory_)}getNodeFactory(){return Ns.getInstance().factory_}identifierNode(t,e,n){if("MathML-Unit"===n)t.type="identifier",t.role="unit";else if(!e&&1===t.textContent.length&&("integer"===t.role||"latinletter"===t.role||"greekletter"===t.role)&&t.font===We.NORMAL)return t.font=We.ITALIC,ur("simpleNamedFunction",t);return"unknown"===t.type&&(t.type="identifier"),Ns.exprFont_(t),ur("simpleNamedFunction",t)}implicitNode(t){if(t=Ns.getInstance().getMixedNumbers_(t),1===(t=Ns.getInstance().combineUnits_(t)).length)return t[0];return ur("combine_juxtaposition",Ns.getInstance().implicitNode_(t))}text(t,e){return Ns.exprFont_(t),t.type="text","MS"===e?(t.role="string",t):"MSPACE"===e||t.textContent.match(/^\s*$/)?(t.role="space",t):t}row(t){return 0===(t=t.filter((function(t){return!Dr(t,"empty")}))).length?Ns.getInstance().factory_.makeEmptyNode():(t=Ns.getInstance().getFencesInRow_(t),t=Ns.getInstance().tablesInRow(t),t=Ns.getInstance().getPunctuationInRow_(t),t=Ns.getInstance().getTextInRow_(t),t=Ns.getInstance().getFunctionsInRow_(t),Ns.getInstance().relationsInRow_(t))}limitNode(t,e){if(!e.length)return Ns.getInstance().factory_.makeEmptyNode();let n,r=e[0],s="unknown";if(!e[1])return r;if(ns(r)){n=Ns.MML_TO_LIMIT_[t];const o=n.length;if(s=n.type,e=e.slice(0,n.length+1),1===o&&Ur(e[1])||2===o&&Ur(e[1])&&Ur(e[2]))return n=Ns.MML_TO_BOUNDS_[t],Ns.getInstance().accentNode_(r,e,n.type,n.length,n.accent);if(2===o){if(Ur(e[1]))return r=Ns.getInstance().accentNode_(r,[r,e[1]],{MSUBSUP:"subscript",MUNDEROVER:"underscore"}[t],1,!0),e[2]?Ns.getInstance().makeLimitNode_(r,[r,e[2]],null,"limupper"):r;if(e[2]&&Ur(e[2]))return r=Ns.getInstance().accentNode_(r,[r,e[2]],{MSUBSUP:"superscript",MUNDEROVER:"overscore"}[t],1,!0),Ns.getInstance().makeLimitNode_(r,[r,e[1]],null,"limlower");e[o]||(s="limlower")}return Ns.getInstance().makeLimitNode_(r,e,null,s)}return n=Ns.MML_TO_BOUNDS_[t],Ns.getInstance().accentNode_(r,e,n.type,n.length,n.accent)}tablesInRow(t){let e=vr(t,Jr),n=[];for(let t,r=0;t=e.rel[r];r++)n=n.concat(e.comp.shift()),n.push(Ns.tableToMatrixOrVector_(t));n=n.concat(e.comp.shift()),e=vr(n,Zr),n=[];for(let t,r=0;t=e.rel[r];r++){const r=e.comp.shift();ts(0,r)&&Ns.tableToCases_(t,r.pop()),n=n.concat(r),n.push(t)}return n.concat(e.comp.shift())}mfenced(t,e,n,r){if(n&&r.length>0){const t=Ns.nextSeparatorFunction_(n),e=[r.shift()];r.forEach((n=>{e.push(Ns.getInstance().factory_.makeContentNode(t())),e.push(n)})),r=e}return t&&e?Ns.getInstance().horizontalFencedNode_(Ns.getInstance().factory_.makeContentNode(t),Ns.getInstance().factory_.makeContentNode(e),r):(t&&r.unshift(Ns.getInstance().factory_.makeContentNode(t)),e&&r.push(Ns.getInstance().factory_.makeContentNode(e)),Ns.getInstance().row(r))}fractionLikeNode(t,e,n,r){let s;if(!r&&function(t){if(!t)return!1;if(-1!==["negativeveryverythinmathspace","negativeverythinmathspace","negativethinmathspace","negativemediummathspace","negativethickmathspace","negativeverythickmathspace","negativeveryverythickmathspace"].indexOf(t))return!0;const e=t.match(/[0-9.]+/);return!!e&&0===parseFloat(e[0])}(n)){const n=Ns.getInstance().factory_.makeBranchNode("line",[t],[]),r=Ns.getInstance().factory_.makeBranchNode("line",[e],[]);return s=Ns.getInstance().factory_.makeBranchNode("multiline",[n,r],[]),Ns.binomialForm_(s),Ns.classifyMultiline(s),s}return s=Ns.getInstance().fractionNode_(t,e),r&&s.addAnnotation("general","bevelled"),s}tensor(t,e,n,r,s){const o=Ns.getInstance().factory_.makeBranchNode("tensor",[t,Ns.getInstance().scriptNode_(e,"leftsub"),Ns.getInstance().scriptNode_(n,"leftsuper"),Ns.getInstance().scriptNode_(r,"rightsub"),Ns.getInstance().scriptNode_(s,"rightsuper")],[]);return o.role=t.role,o.embellished=Hr(t),o}pseudoTensor(t,e,n){const r=t=>!Dr(t,"empty"),s=e.filter(r).length,o=n.filter(r).length;if(!s&&!o)return t;const i=s?o?"MSUBSUP":"MSUB":"MSUP",c=[t];return s&&c.push(Ns.getInstance().scriptNode_(e,"rightsub",!0)),o&&c.push(Ns.getInstance().scriptNode_(n,"rightsuper",!0)),Ns.getInstance().limitNode(i,c)}font(t){const e=Ns.MATHJAX_FONTS[t];return e||t}proof(t,e,n){if(e.inference||e.axiom||console.log("Noise"),e.axiom){const e=Ns.getInstance().cleanInference(t.childNodes),r=e.length?Ns.getInstance().factory_.makeBranchNode("inference",n(e),[]):Ns.getInstance().factory_.makeEmptyNode();return r.role="axiom",r.mathmlTree=t,r}const r=Ns.getInstance().inference(t,e,n);return e.proof&&(r.role="proof",r.childNodes[0].role="final"),r}inference(t,e,n){if(e.inferenceRule){const e=Ns.getInstance().getFormulas(t,[],n);return Ns.getInstance().factory_.makeBranchNode("inference",[e.conclusion,e.premises],[])}const r=e.labelledRule,s=O(t.childNodes),o=[];"left"!==r&&"both"!==r||o.push(Ns.getInstance().getLabel(t,s,n,"left")),"right"!==r&&"both"!==r||o.push(Ns.getInstance().getLabel(t,s,n,"right"));const i=Ns.getInstance().getFormulas(t,s,n),c=Ns.getInstance().factory_.makeBranchNode("inference",[i.conclusion,i.premises],o);return c.mathmlTree=t,c}getLabel(t,e,n,r){const s=Ns.getInstance().findNestedRow(e,"prooflabel",r),o=Ns.getInstance().factory_.makeBranchNode("rulelabel",n(O(s.childNodes)),[]);return o.role=r,o.mathmlTree=s,o}getFormulas(t,e,n){const r=e.length?Ns.getInstance().findNestedRow(e,"inferenceRule"):t,s="up"===Ns.getSemantics(r).inferenceRule,o=s?r.childNodes[1]:r.childNodes[0],i=s?r.childNodes[0]:r.childNodes[1],c=o.childNodes[0].childNodes[0],a=O(c.childNodes[0].childNodes),l=[];let u=1;for(const t of a)u%2&&l.push(t.childNodes[0]),u++;const h=n(l),d=n(O(i.childNodes[0].childNodes))[0],p=Ns.getInstance().factory_.makeBranchNode("premises",h,[]);p.mathmlTree=c;const f=Ns.getInstance().factory_.makeBranchNode("conclusion",[d],[]);return f.mathmlTree=i.childNodes[0].childNodes[0],{conclusion:f,premises:p}}findNestedRow(t,e,n){return Ns.getInstance().findNestedRow_(t,e,0,n)}cleanInference(t){return O(t).filter((function(t){return"MSPACE"!==k(t)}))}operatorNode(t){return"unknown"===t.type&&(t.type="operator"),ur("multioperator",t)}constructor(){this.funcAppls={},this.splitRoles=new Map([["subtraction","negative"],["addition","positive"]]),this.splitOps=["\u2212","-","\u2010","\u2011","+"],this.factory_=new wr,or(this.factory_)}implicitNode_(t){const e=Ns.getInstance().factory_.makeMultipleContentNodes(t.length-1,ze.invisibleTimes);Ns.matchSpaces_(t,e);const n=Ns.getInstance().infixNode_(t,e[0]);return n.role="implicit",e.forEach((function(t){t.parent=n})),n.contentNodes=e,n}infixNode_(t,e){const n=Ns.getInstance().factory_.makeBranchNode("infixop",t,[e],Mr(e).textContent);return n.role=e.role,ur("propagateSimpleFunction",n)}explicitMixed_(t){const e=vr(t,(function(t){return t.textContent===ze.invisiblePlus}));if(!e.rel.length)return t;let n=[];for(let t,r=0;t=e.rel[r];r++){const s=e.comp[r],o=e.comp[r+1],i=s.length-1;if(s[i]&&o[0]&&Dr(s[i],"number")&&!kr(s[i],"mixed")&&Dr(o[0],"fraction")){const t=Ns.getInstance().factory_.makeBranchNode("number",[s[i],o[0]],[]);t.role="mixed",n=n.concat(s.slice(0,i)),n.push(t),o.shift()}else n=n.concat(s),n.push(t)}return n.concat(e.comp[e.comp.length-1])}concatNode_(t,e,n){if(0===e.length)return t;const r=e.map((function(t){return Mr(t).textContent})).join(" "),s=Ns.getInstance().factory_.makeBranchNode(n,[t],e,r);return e.length>1&&(s.role="multiop"),s}prefixNode_(t,e){const n=this.splitSingles(e);let r=t;for(;n.length>0;){const t=n.pop();r=Ns.getInstance().concatNode_(r,t,"prefixop"),1===t.length&&-1!==this.splitOps.indexOf(t[0].textContent)&&(r.role=this.splitRoles.get(t[0].role))}return r}splitSingles(t){let e=0;const n=[];let r=0;for(;r<t.length;){const s=t[r];!this.splitRoles.has(s.role)||t[r-1]&&t[r-1].role===s.role||t[r+1]&&t[r+1].role===s.role||-1===this.splitOps.indexOf(s.textContent)||(n.push(t.slice(e,r)),n.push(t.slice(r,r+1)),e=r+1),r++}return e<r&&n.push(t.slice(e,r)),n}postfixNode_(t,e){return e.length?Ns.getInstance().concatNode_(t,e,"postfixop"):t}combineUnits_(t){const e=vr(t,(function(t){return!kr(t,"unit")}));if(t.length===e.rel.length)return e.rel;const n=[];let r,s;do{const t=e.comp.shift();r=e.rel.shift();let o=null;s=n.pop(),s&&(t.length&&as(s)?t.unshift(s):n.push(s)),1===t.length&&(o=t.pop()),t.length>1&&(o=Ns.getInstance().implicitNode_(t),o.role="unit"),o&&n.push(o),r&&n.push(r)}while(r);return n}getMixedNumbers_(t){const e=vr(t,(function(t){return Dr(t,"fraction")&&kr(t,"vulgar")}));if(!e.rel.length)return t;let n=[];for(let t,r=0;t=e.rel[r];r++){const s=e.comp[r],o=s.length-1;if(s[o]&&Dr(s[o],"number")&&(kr(s[o],"integer")||kr(s[o],"float"))){const e=Ns.getInstance().factory_.makeBranchNode("number",[s[o],t],[]);e.role="mixed",n=n.concat(s.slice(0,o)),n.push(e)}else n=n.concat(s),n.push(t)}return n.concat(e.comp[e.comp.length-1])}getTextInRow_(t){if(t.length<=1)return t;const e=vr(t,(t=>Dr(t,"text")));if(0===e.rel.length)return t;const n=[];let r=e.comp[0];r.length>0&&n.push(Ns.getInstance().row(r));for(let t,s=0;t=e.rel[s];s++)n.push(t),r=e.comp[s+1],r.length>0&&n.push(Ns.getInstance().row(r));return[Ns.getInstance().dummyNode_(n)]}relationsInRow_(t){const e=vr(t,qr),n=e.rel[0];if(!n)return Ns.getInstance().operationsInRow_(t);if(1===t.length)return t[0];const r=e.comp.map(Ns.getInstance().operationsInRow_);let s;return e.rel.some((function(t){return!t.equals(n)}))?(s=Ns.getInstance().factory_.makeBranchNode("multirel",r,e.rel),e.rel.every((function(t){return t.role===n.role}))&&(s.role=n.role),s):(s=Ns.getInstance().factory_.makeBranchNode("relseq",r,e.rel,Mr(n).textContent),s.role=n.role,s)}operationsInRow_(t){if(0===t.length)return Ns.getInstance().factory_.makeEmptyNode();if(1===(t=Ns.getInstance().explicitMixed_(t)).length)return t[0];const e=[];for(;t.length>0&&Yr(t[0]);)e.push(t.shift());if(0===t.length)return Ns.getInstance().prefixNode_(e.pop(),e);if(1===t.length)return Ns.getInstance().prefixNode_(t[0],e);const n=Rr(t=ur("convert_juxtaposition",t),Yr),r=Ns.getInstance().prefixNode_(Ns.getInstance().implicitNode(n.head),e);return n.div?Ns.getInstance().operationsTree_(n.tail,r,n.div):(us(r)&&(r.role="unit"),r)}operationsTree_(t,e,n,r){const s=r||[];if(0===t.length){if(s.unshift(n),"infixop"===e.type){const t=Ns.getInstance().postfixNode_(e.childNodes.pop(),s);return e.appendChild(t),e}return Ns.getInstance().postfixNode_(e,s)}const o=Rr(t,Yr);if(0===o.head.length)return s.push(o.div),Ns.getInstance().operationsTree_(o.tail,e,n,s);const i=Ns.getInstance().prefixNode_(Ns.getInstance().implicitNode(o.head),s),c=Ns.getInstance().appendOperand_(e,n,i);return o.div?Ns.getInstance().operationsTree_(o.tail,c,o.div,[]):c}appendOperand_(t,e,n){if("infixop"!==t.type)return Ns.getInstance().infixNode_([t,n],e);const r=Ns.getInstance().appendDivisionOp_(t,e,n);return r||(Ns.getInstance().appendExistingOperator_(t,e,n)?t:"multiplication"===e.role?Ns.getInstance().appendMultiplicativeOp_(t,e,n):Ns.getInstance().appendAdditiveOp_(t,e,n))}appendDivisionOp_(t,e,n){return"division"===e.role?hs(t)?Ns.getInstance().infixNode_([t,n],e):Ns.getInstance().appendLastOperand_(t,e,n):"division"===t.role?Ns.getInstance().infixNode_([t,n],e):null}appendLastOperand_(t,e,n){let r=t,s=t.childNodes[t.childNodes.length-1];for(;s&&"infixop"===s.type&&!hs(s);)r=s,s=r.childNodes[t.childNodes.length-1];const o=Ns.getInstance().infixNode_([r.childNodes.pop(),n],e);return r.appendChild(o),t}appendMultiplicativeOp_(t,e,n){if(hs(t))return Ns.getInstance().infixNode_([t,n],e);let r=t,s=t.childNodes[t.childNodes.length-1];for(;s&&"infixop"===s.type&&!hs(s);)r=s,s=r.childNodes[t.childNodes.length-1];const o=Ns.getInstance().infixNode_([r.childNodes.pop(),n],e);return r.appendChild(o),t}appendAdditiveOp_(t,e,n){return Ns.getInstance().infixNode_([t,n],e)}appendExistingOperator_(t,e,n){return!(!t||"infixop"!==t.type||hs(t))&&(t.contentNodes[0].equals(e)?(t.appendContentNode(e),t.appendChild(n),!0):Ns.getInstance().appendExistingOperator_(t.childNodes[t.childNodes.length-1],e,n))}getFencesInRow_(t){let e=vr(t,Xr);e=Ns.purgeFences_(e);const n=e.comp.shift();return Ns.getInstance().fences_(e.rel,e.comp,[],[n])}fences_(t,e,n,r){if(0===t.length&&0===n.length)return r[0];const s=t=>kr(t,"open");if(0===t.length){const t=r.shift();for(;n.length>0;){if(s(n[0])){const e=n.shift();Ns.fenceToPunct_(e),t.push(e)}else{const e=Rr(n,s),o=e.head.length-1,i=Ns.getInstance().neutralFences_(e.head,r.slice(0,o));r=r.slice(o),t.push(...i),e.div&&e.tail.unshift(e.div),n=e.tail}t.push(...r.shift())}return t}const o=n[n.length-1],i=t[0].role;if("open"===i||ps(t[0])&&(!o||!fs(t[0],o))){n.push(t.shift());const s=e.shift();return s&&r.push(s),Ns.getInstance().fences_(t,e,n,r)}if(o&&"close"===i&&"open"===o.role){const s=Ns.getInstance().horizontalFencedNode_(n.pop(),t.shift(),r.pop());return r.push(r.pop().concat([s],e.shift())),Ns.getInstance().fences_(t,e,n,r)}if(o&&fs(t[0],o)){if(!ms(o)||!gs(t[0])){n.push(t.shift());const s=e.shift();return s&&r.push(s),Ns.getInstance().fences_(t,e,n,r)}const s=Ns.getInstance().horizontalFencedNode_(n.pop(),t.shift(),r.pop());return r.push(r.pop().concat([s],e.shift())),Ns.getInstance().fences_(t,e,n,r)}if(o&&"close"===i&&ps(o)&&n.some(s)){const o=Rr(n,s,!0),i=r.pop(),c=r.length-o.tail.length+1,a=Ns.getInstance().neutralFences_(o.tail,r.slice(c));r=r.slice(0,c);const l=Ns.getInstance().horizontalFencedNode_(o.div,t.shift(),r.pop().concat(a,i));return r.push(r.pop().concat([l],e.shift())),Ns.getInstance().fences_(t,e,o.head,r)}const c=t.shift();return Ns.fenceToPunct_(c),r.push(r.pop().concat([c],e.shift())),Ns.getInstance().fences_(t,e,n,r)}neutralFences_(t,e){if(0===t.length)return t;if(1===t.length)return Ns.fenceToPunct_(t[0]),t;const n=t.shift();if(!ms(n)){Ns.fenceToPunct_(n);const r=e.shift();return r.unshift(n),r.concat(Ns.getInstance().neutralFences_(t,e))}const r=Rr(t,(function(t){return fs(t,n)}));if(!r.div){Ns.fenceToPunct_(n);const r=e.shift();return r.unshift(n),r.concat(Ns.getInstance().neutralFences_(t,e))}if(!gs(r.div))return Ns.fenceToPunct_(r.div),t.unshift(n),Ns.getInstance().neutralFences_(t,e);const s=Ns.getInstance().combineFencedContent_(n,r.div,r.head,e);if(r.tail.length>0){const t=s.shift(),e=Ns.getInstance().neutralFences_(r.tail,s);return t.concat(e)}return s[0]}combineFencedContent_(t,e,n,r){if(0===n.length){const n=Ns.getInstance().horizontalFencedNode_(t,e,r.shift());return r.length>0?r[0].unshift(n):r=[[n]],r}const s=r.shift(),o=n.length-1,i=r.slice(0,o),c=(r=r.slice(o)).shift(),a=Ns.getInstance().neutralFences_(n,i);s.push(...a),s.push(...c);const l=Ns.getInstance().horizontalFencedNode_(t,e,s);return r.length>0?r[0].unshift(l):r=[[l]],r}horizontalFencedNode_(t,e,n){const r=Ns.getInstance().row(n);let s=Ns.getInstance().factory_.makeBranchNode("fenced",[r],[t,e]);return"open"===t.role?(Ns.getInstance().classifyHorizontalFence_(s),s=ur("propagateComposedFunction",s)):s.role=t.role,s=ur("detect_cycle",s),Ns.rewriteFencedNode_(s)}classifyHorizontalFence_(t){t.role="leftright";const e=t.childNodes;if(!function(t){return function(t){return!!t&&-1!==["{","\ufe5b","\uff5b"].indexOf(t.textContent)}(t.contentNodes[0])&&function(t){return!!t&&-1!==["}","\ufe5c","\uff5d"].indexOf(t.textContent)}(t.contentNodes[1])}(t)||e.length>1)return;if(0===e.length||"empty"===e[0].type)return void(t.role="set empty");const n=e[0].type;if(1===e.length&&cs(e[0]))return void(t.role="set singleton");const r=e[0].role;if("punctuated"===n&&"sequence"===r){if("comma"!==e[0].contentNodes[0].role)return 1!==e[0].contentNodes.length||"vbar"!==e[0].contentNodes[0].role&&"colon"!==e[0].contentNodes[0].role?void 0:(t.role="set extended",void Ns.getInstance().setExtension_(t));t.role="set collection"}}setExtension_(t){const e=t.childNodes[0].childNodes[0];var n;e&&"infixop"===e.type&&1===e.contentNodes.length&&(n=e.contentNodes[0],["element","nonelement","reelement","renonelement"].includes(n.role))&&(e.addAnnotation("set","intensional"),e.contentNodes[0].addAnnotation("set","intensional"))}getPunctuationInRow_(t){if(t.length<=1)return t;const e=t=>{const e=t.type;return"punctuation"===e||"text"===e||"operator"===e||"relation"===e},n=vr(t,(function(n){if(!Wr(n))return!1;if(Wr(n)&&!kr(n,"ellipsis"))return!0;const r=t.indexOf(n);if(0===r)return!t[1]||!e(t[1]);const s=t[r-1];if(r===t.length-1)return!e(s);const o=t[r+1];return!e(s)||!e(o)}));if(0===n.rel.length)return t;const r=[];let s=n.comp.shift();s.length>0&&r.push(Ns.getInstance().row(s));let o=0;for(;n.comp.length>0;)r.push(n.rel[o++]),s=n.comp.shift(),s.length>0&&r.push(Ns.getInstance().row(s));return[Ns.getInstance().punctuatedNode_(r,n.rel)]}punctuatedNode_(t,e){const n=Ns.getInstance().factory_.makeBranchNode("punctuated",t,e);if(e.length===t.length){const t=e[0].role;if("unknown"!==t&&e.every((function(e){return e.role===t})))return n.role=t,n}return rs(t,e,0)?n.role="startpunct":rs(t,e,t.length-1)?n.role="endpunct":e.every((t=>kr(t,"dummy")))?n.role="text":e.every((t=>kr(t,"space")))?n.role="space":n.role="sequence",n}dummyNode_(t){const e=Ns.getInstance().factory_.makeMultipleContentNodes(t.length-1,ze.invisibleComma);return e.forEach((function(t){t.role="dummy"})),Ns.getInstance().punctuatedNode_(t,e)}accentRole_(t,e){if(!Ur(t))return!1;const n=t.textContent,r=Ze.Secondary.get(n,Ke.BAR)||Ze.Secondary.get(n,Ke.TILDE)||t.role;return t.role="underscore"===e?"underaccent":"overaccent",t.addAnnotation("accent",r),!0}accentNode_(t,e,n,r,s){const o=(e=e.slice(0,r+1))[1],i=e[2];let c;if(!s&&i&&(c=Ns.getInstance().factory_.makeBranchNode("subscript",[t,o],[]),c.role="subsup",e=[c,i],n="superscript"),s){const r=Ns.getInstance().accentRole_(o,n);if(i){Ns.getInstance().accentRole_(i,"overscore")&&!r?(c=Ns.getInstance().factory_.makeBranchNode("overscore",[t,i],[]),e=[c,o],n="underscore"):(c=Ns.getInstance().factory_.makeBranchNode("underscore",[t,o],[]),e=[c,i],n="overscore"),c.role="underover"}}return Ns.getInstance().makeLimitNode_(t,e,c,n)}makeLimitNode_(t,e,n,r){if("limupper"===r&&"limlower"===t.type)return t.childNodes.push(e[1]),e[1].parent=t,t.type="limboth",t;if("limlower"===r&&"limupper"===t.type)return t.childNodes.splice(1,-1,e[1]),e[1].parent=t,t.type="limboth",t;const s=Ns.getInstance().factory_.makeBranchNode(r,e,[]),o=Hr(t);return n&&(n.embellished=o),s.embellished=o,s.role=t.role,s}getFunctionsInRow_(t,e){const n=e||[];if(0===t.length)return n;const r=t.shift(),s=Ns.classifyFunction_(r,t);if(!s)return n.push(r),Ns.getInstance().getFunctionsInRow_(t,n);const o=Ns.getInstance().getFunctionsInRow_(t,[]),i=Ns.getInstance().getFunctionArgs_(r,o,s);return n.concat(i)}getFunctionArgs_(t,e,n){let r,s,o;switch(n){case"integral":{const n=Ns.getInstance().getIntegralArgs_(e);if(!n.intvar&&!n.integrand.length)return n.rest.unshift(t),n.rest;const r=Ns.getInstance().row(n.integrand);return o=Ns.getInstance().integralNode_(t,r,n.intvar),ur("intvar_from_fraction",o),n.rest.unshift(o),n.rest}case"prefix":if(e[0]&&"fenced"===e[0].type){const n=e.shift();return ps(n)||(n.role="leftright"),o=Ns.getInstance().functionNode_(t,n),e.unshift(o),e}if(r=Rr(e,Br),r.head.length)s=Ns.getInstance().row(r.head),r.div&&r.tail.unshift(r.div);else{if(!r.div||!Dr(r.div,"appl"))return e.unshift(t),e;s=r.div}return o=Ns.getInstance().functionNode_(t,s),r.tail.unshift(o),r.tail;case"bigop":return r=Rr(e,jr),r.head.length?(s=Ns.getInstance().row(r.head),o=Ns.getInstance().bigOpNode_(t,s),r.div&&r.tail.unshift(r.div),r.tail.unshift(o),r.tail):(e.unshift(t),e);default:{if(0===e.length)return[t];const n=e[0];return"fenced"===n.type&&!ps(n)&&function(t){const e=t.childNodes;if(0===e.length)return!0;if(e.length>1)return!1;const n=e[0];if("infixop"===n.type){if("implicit"!==n.role)return!1;if(n.childNodes.some((t=>Dr(t,"infixop"))))return!1}return!0}(n)?(n.role="leftright",Ns.propagateFunctionRole_(t,"simple function"),o=Ns.getInstance().functionNode_(t,e.shift()),e.unshift(o),e):(e.unshift(t),e)}}}getIntegralArgs_(t,e=[]){if(0===t.length){const t=Rr(e,jr);return t.div&&t.tail.unshift(t.div),{integrand:t.head,intvar:null,rest:t.tail}}ur("intvar_from_implicit",t);const n=t[0];if(Vr(n))return{integrand:e,intvar:null,rest:t};if(Gr(n))return n.role="integral",{integrand:e,intvar:n,rest:t.slice(1)};if(t[1]&&$r(n,t[1])){const r=Ns.getInstance().prefixNode_(t[1],[n]);return r.role="integral",{integrand:e,intvar:r,rest:t.slice(2)}}return e.push(t.shift()),Ns.getInstance().getIntegralArgs_(t,e)}functionNode_(t,e){const n=Ns.getInstance().factory_.makeContentNode(ze.functionApplication),r=Ns.getInstance().funcAppls[t.id];r&&(n.mathmlTree=r.mathmlTree,n.mathml=r.mathml,n.annotation=r.annotation,n.attributes=r.attributes,delete Ns.getInstance().funcAppls[t.id]),n.type="punctuation",n.role="application";const s=Ns.getFunctionOp_(t,(function(t){return Dr(t,"function")||Dr(t,"identifier")&&kr(t,"simple function")}));return Ns.getInstance().functionalNode_("appl",[t,e],s,[n])}bigOpNode_(t,e){const n=Ns.getFunctionOp_(t,(t=>Dr(t,"largeop")));return Ns.getInstance().functionalNode_("bigop",[t,e],n,[])}integralNode_(t,e,n){e=e||Ns.getInstance().factory_.makeEmptyNode(),n=n||Ns.getInstance().factory_.makeEmptyNode();const r=Ns.getFunctionOp_(t,(t=>Dr(t,"largeop")));return Ns.getInstance().functionalNode_("integral",[t,e,n],r,[])}functionalNode_(t,e,n,r){const s=e[0];let o;n&&(o=n.parent,r.push(n));const i=Ns.getInstance().factory_.makeBranchNode(t,e,r);return i.role=s.role,o&&(n.parent=o),i}fractionNode_(t,e){const n=Ns.getInstance().factory_.makeBranchNode("fraction",[t,e],[]);return n.role=n.childNodes.every((function(t){return Dr(t,"number")&&kr(t,"integer")}))?"vulgar":n.childNodes.every(ls)?"unit":"division",ur("propagateSimpleFunction",n)}scriptNode_(t,e,n){let r;switch(t.length){case 0:r=Ns.getInstance().factory_.makeEmptyNode();break;case 1:if(r=t[0],n)return r;break;default:r=Ns.getInstance().dummyNode_(t)}return r.role=e,r}findNestedRow_(t,e,n,r){if(n>3)return null;for(let s,o=0;s=t[o];o++){const t=k(s);if("MSPACE"!==t){if("MROW"===t)return Ns.getInstance().findNestedRow_(O(s.childNodes),e,n+1,r);if(Ns.findSemantics(s,e,r))return s}}return null}}Ns.FENCE_TO_PUNCT_={metric:"metric",neutral:"vbar",open:"openfence",close:"closefence"},Ns.MML_TO_LIMIT_={MSUB:{type:"limlower",length:1},MUNDER:{type:"limlower",length:1},MSUP:{type:"limupper",length:1},MOVER:{type:"limupper",length:1},MSUBSUP:{type:"limboth",length:2},MUNDEROVER:{type:"limboth",length:2}},Ns.MML_TO_BOUNDS_={MSUB:{type:"subscript",length:1,accent:!1},MSUP:{type:"superscript",length:1,accent:!1},MSUBSUP:{type:"subscript",length:2,accent:!1},MUNDER:{type:"underscore",length:1,accent:!0},MOVER:{type:"overscore",length:1,accent:!0},MUNDEROVER:{type:"underscore",length:2,accent:!0}},Ns.CLASSIFY_FUNCTION_={integral:"integral",sum:"bigop","prefix function":"prefix","limit function":"prefix","simple function":"prefix","composed function":"prefix"},Ns.MATHJAX_FONTS={"-tex-caligraphic":We.CALIGRAPHIC,"-tex-caligraphic-bold":We.CALIGRAPHICBOLD,"-tex-calligraphic":We.CALIGRAPHIC,"-tex-calligraphic-bold":We.CALIGRAPHICBOLD,"-tex-oldstyle":We.OLDSTYLE,"-tex-oldstyle-bold":We.OLDSTYLEBOLD,"-tex-mathit":We.ITALIC};const Ss=Ns;let Es={};function bs(t){return Array.from(t.textContent).map(Tn.stringEmpty)}function As(t,e){const n=Array.from(t.textContent),r=[],s=Ss.getInstance(),o=t.ownerDocument;for(let t,i=0;t=n[i];i++){const n=s.getNodeFactory().makeLeafNode(t,We.UNKNOWN),i=s.identifierNode(n,We.UNKNOWN,"");e(i),r.push(i.xml(o))}return r}function ys(t){return As(t,(function(t){t.textContent.match(/\W/)||(t.type="number")}))}function Ts(t){return As(t,(function(t){t.font=We.UNKNOWN,t.type="identifier"}))}const _s=["cases","cell","integral","line","matrix","multiline","overscore","root","row","sqrt","subscript","superscript","table","underscore","vector"];function Is(t){return Es={},[t]}function Cs(t,e,n,r,s,o){r=r||_s,s=s||{},o=o||function(t){return!1};const i=B(e);if(Es[t]||(Es[t]={}),Es[t][i])return Es[t][i];if(o(e)||n.indexOf(e.tagName)<0)return 0;const c=Os(e,n,rr(r,n),s,o,0);return Es[t][i]=c,c}function Os(t,e,n,r,s,o){if(s(t)||n.indexOf(t.tagName)>-1||function(t,e){if(!t.attributes)return!1;const n=O(t.attributes);for(let t,r=0;t=n[r];r++)if(e[t.nodeName]===t.nodeValue)return!0;return!1}(t,r))return o;if(e.indexOf(t.tagName)>-1&&o++,!t.childNodes||0===t.childNodes.length)return o;const i=O(t.childNodes);return Math.max.apply(null,i.map((function(t){return Os(t,e,n,r,s,o)})))}function xs(t){return Cs("fraction",t,["fraction"],_s,{},W.FUNCTIONS.fracNestDepth)}function Ls(t,e,n){const r=xs(t),s=Array(r).fill(e);return n&&s.push(n),s.join(W.MESSAGES.regexp.JOINER_FRAC)}function Ms(t){return Tn.singleton(Ls(t,W.MESSAGES.MS.START,W.MESSAGES.MS.FRAC_V))}function Rs(t){return Tn.singleton(Ls(t,W.MESSAGES.MS.END,W.MESSAGES.MS.FRAC_V),{kind:"LAST"})}function vs(t){return Tn.singleton(Ls(t,W.MESSAGES.MS.FRAC_OVER),{})}function Fs(t){return Tn.singleton(Ls(t,W.MESSAGES.MS.START,W.MESSAGES.MS.FRAC_B))}function ws(t){return Tn.singleton(Ls(t,W.MESSAGES.MS.END,W.MESSAGES.MS.FRAC_B),{kind:"LAST"})}function Ds(t){const e=xs(t);return Tn.singleton(1===e?W.MESSAGES.MS.FRAC_S:W.FUNCTIONS.combineNestedFraction(W.MESSAGES.MS.NEST_FRAC,W.FUNCTIONS.radicalNestDepth(e-1),W.MESSAGES.MS.FRAC_S))}function Ps(t){const e=xs(t);return Tn.singleton(1===e?W.MESSAGES.MS.ENDFRAC:W.FUNCTIONS.combineNestedFraction(W.MESSAGES.MS.NEST_FRAC,W.FUNCTIONS.radicalNestDepth(e-1),W.MESSAGES.MS.ENDFRAC),{kind:"LAST"})}function ks(t){const e=xs(t);return Tn.singleton(1===e?W.MESSAGES.MS.FRAC_OVER:W.FUNCTIONS.combineNestedFraction(W.MESSAGES.MS.NEST_FRAC,W.FUNCTIONS.radicalNestDepth(e-1),W.MESSAGES.MS.FRAC_OVER))}function Us(t){return W.FUNCTIONS.fracNestDepth(t)?[t]:[]}function Bs(t,e,n){for(;t.parentNode;){const r=t.parentNode,s=r.parentNode;if(!s)break;const o=t.getAttribute&&t.getAttribute("role");("subscript"===s.tagName&&t===r.childNodes[1]||"tensor"===s.tagName&&o&&("leftsub"===o||"rightsub"===o))&&(e=n.sub+W.MESSAGES.regexp.JOINER_SUBSUPER+e),("superscript"===s.tagName&&t===r.childNodes[1]||"tensor"===s.tagName&&o&&("leftsuper"===o||"rightsuper"===o))&&(e=n.sup+W.MESSAGES.regexp.JOINER_SUBSUPER+e),t=s}return e.trim()}function js(t){return Tn.singleton(Bs(t,W.MESSAGES.MS.SUBSCRIPT,{sup:W.MESSAGES.MS.SUPER,sub:W.MESSAGES.MS.SUB}))}function $s(t){return Tn.singleton(Bs(t,W.MESSAGES.MS.SUB,{sup:W.MESSAGES.MS.SUP,sub:W.MESSAGES.MS.SUB}))}function Gs(t){return Tn.singleton(Bs(t,W.MESSAGES.MS.SUPERSCRIPT,{sup:W.MESSAGES.MS.SUPER,sub:W.MESSAGES.MS.SUB}))}function Vs(t){return Tn.singleton(Bs(t,W.MESSAGES.MS.SUP,{sup:W.MESSAGES.MS.SUP,sub:W.MESSAGES.MS.SUB}))}function Hs(t){const e=Bs(t,"",{sup:W.MESSAGES.MS.SUPER,sub:W.MESSAGES.MS.SUB});return Tn.singleton(e?e.replace(new RegExp(W.MESSAGES.MS.SUB+"$"),W.MESSAGES.MS.SUBSCRIPT).replace(new RegExp(W.MESSAGES.MS.SUPER+"$"),W.MESSAGES.MS.SUPERSCRIPT):W.MESSAGES.MS.BASELINE)}function Ys(t){const e=Bs(t,"",{sup:W.MESSAGES.MS.SUP,sub:W.MESSAGES.MS.SUB});return Tn.singleton(e||W.MESSAGES.MS.BASE)}function qs(t,e,n){const r=function(t){return Cs("radical",t,["sqrt","root"],_s,{})}(t),s=function(t){const e="sqrt"===t.tagName?"2":I("children/*[1]",t)[0].textContent.trim();return W.MESSAGES.MSroots[e]||""}(t);return n=s?W.FUNCTIONS.combineRootIndex(n,s):n,1===r?n:W.FUNCTIONS.combineNestedRadical(e,W.FUNCTIONS.radicalNestDepth(r-1),n)}function Ws(t){return Tn.singleton(qs(t,W.MESSAGES.MS.NESTED,W.MESSAGES.MS.STARTROOT))}function Xs(t){return Tn.singleton(qs(t,W.MESSAGES.MS.NESTED,W.MESSAGES.MS.ENDROOT))}function Ks(t){return Tn.singleton(qs(t,W.MESSAGES.MS.NESTED,W.MESSAGES.MS.ROOTINDEX))}function zs(t){return Tn.singleton(qs(t,W.MESSAGES.MS.NEST_ROOT,W.MESSAGES.MS.STARTROOT))}function Zs(t){return Tn.singleton(qs(t,W.MESSAGES.MS.NEST_ROOT,W.MESSAGES.MS.ENDROOT))}function Js(t){return Tn.singleton(qs(t,W.MESSAGES.MS.NEST_ROOT,W.MESSAGES.MS.ROOTINDEX))}function Qs(t){return Tn.singleton(qs(t,W.MESSAGES.MS.NEST_ROOT,W.MESSAGES.MS.ROOT))}function to(t){return Tn.singleton(qs(t,W.MESSAGES.MS.NEST_ROOT,W.MESSAGES.MS.INDEX))}function eo(t){const e=function(t){return Cs("underscore",t,["underscore"],_s,{},(function(t){return t.tagName&&"underscore"===t.tagName&&"underaccent"===t.childNodes[0].childNodes[1].getAttribute("role")}))}(t);return Tn.singleton(Array(e).join(W.MESSAGES.MS.UNDER)+W.MESSAGES.MS.UNDERSCRIPT)}function no(t){return Tn.singleton(W.MESSAGES.MS.ENDSCRIPTS)}function ro(t){const e=function(t){return Cs("overscore",t,["overscore"],_s,{},(function(t){return t.tagName&&"overscore"===t.tagName&&"overaccent"===t.childNodes[0].childNodes[1].getAttribute("role")}))}(t);return Tn.singleton(Array(e).join(W.MESSAGES.MS.OVER)+W.MESSAGES.MS.OVERSCRIPT)}function so(t){if("matrix"!==t.tagName||"determinant"!==t.getAttribute("role"))return[];const e=I("children/row/children/cell/children/*",t);for(let t,n=0;t=e[n];n++)if("number"!==t.tagName){if("identifier"===t.tagName){const e=t.getAttribute("role");if("latinletter"===e||"greekletter"===e||"otherletter"===e)continue}return[]}return[t]}function oo(){const t=t=>t.map((t=>"ancestor::"+t)),e=t=>"not("+t+")",n=e(t(["subscript","superscript","tensor"]).join(" or ")),r=t(["relseq","multrel"]),s=t(["fraction","punctuation","fenced","sqrt","root"]);let o=[];for(let t,e=0;t=s[e];e++)o=o.concat(r.map((function(e){return t+"/"+e})));return[["ancestor::*/following-sibling::*",n,e(o.join(" | "))].join(" and ")]}function io(t){if(!t.childNodes.length||!t.childNodes[0].childNodes.length||!t.childNodes[0].childNodes[0].childNodes.length)return Tn.singleton("");const e=t.childNodes[0].childNodes[0].childNodes[0].textContent;return Tn.singleton(e.match(/^\(.+\)$/)?e.slice(1,-1):e)}const co=new Map([[3,"CSFleftsuperscript"],[4,"CSFleftsubscript"],[2,"CSFbaseline"],[1,"CSFrightsubscript"],[0,"CSFrightsuperscript"]]),ao=new Map([[4,2],[3,3],[2,1],[1,4],[0,5]]);function lo(t){const e=[];let n="",r="",s=parseInt(t,2);for(let t=0;t<5;t++){const o="children/*["+ao.get(t)+"]";if(1&s){const e=co.get(t%5);n="[t] "+e+"Verbose; [n] "+o+";"+n,r="[t] "+e+"Brief; [n] "+o+";"+r}else e.unshift("name("+o+')="empty"');s>>=1}return[e,n,r]}function uo(t,e=!0){const n=["11111","11110","11101","11100","10111","10110","10101","10100","01111","01110","01101","01100"];for(const r of n){let n="tensor"+r,[s,o,i]=lo(r);if(t.defineRule(n,"default",o,"self::tensor",...s),e&&(t.defineRule(n,"brief",i,"self::tensor",...s),t.defineRule(n,"sbrief",i,"self::tensor",...s)),!(3&parseInt(r,2)))continue;const c=co.get(2);o+="; [t]"+c+"Verbose",i+="; [t]"+c+"Brief",n+="-baseline";const a="((.//*[not(*)])[last()]/@id)!=(((.//ancestor::fraction|ancestor::root|ancestor::sqrt|ancestor::cell|ancestor::line|ancestor::stree)[1]//*[not(*)])[last()]/@id)";t.defineRule(n,"default",o,"self::tensor",a,...s),e&&(t.defineRule(n,"brief",i,"self::tensor",a,...s),t.defineRule(n,"sbrief",i,"self::tensor",a,...s))}}function ho(t){let e=Object.keys(W.MESSAGES.MSroots).length;if(!e)return[];if(e++,!t.childNodes||0===t.childNodes.length||!t.childNodes[0].childNodes)return[];const n=t.childNodes[0].childNodes[0].textContent;if(!/^\d+$/.test(n))return[];const r=parseInt(n,10);return r>1&&r<=e?[t]:[]}function po(t,e){let n=0;return function(){return W.NUMBERS.numericOrdinal(++n)+" "+e}}function fo(t,e){let n=0;return function(){return W.NUMBERS.numberToOrdinal(++n,!1)+" "+e}}function mo(t){const e=H(t,W.MESSAGES.MS.FRAC_OVER);return e.convertible&&e.enumerator&&e.denominator?[Tn.node(W.NUMBERS.numberToWords(e.enumerator),t.childNodes[0].childNodes[0],{separator:""}),Tn.stringAttr(W.NUMBERS.vulgarSep,{separator:""}),Tn.node(W.NUMBERS.numberToOrdinal(e.denominator,1!==e.enumerator),t.childNodes[0].childNodes[1])]:[Tn.node(e.content||"",t)]}function go(t){const e=O(t.parentNode.childNodes);return Tn.singleton(W.NUMBERS.numericOrdinal(e.indexOf(t)+1).toString())}function No(t){const e=Hs(t);return e[0].speech=e[0].speech.replace(/-$/,""),e}function So(t){const e=Ys(t);return e[0].speech=e[0].speech.replace(/-$/,""),e}function Eo(t){const e=Gs(t);return e[0].speech=e[0].speech.replace(/^exposant/,"exposant gauche"),e}function bo(t){const e=js(t);return e[0].speech=e[0].speech.replace(/^indice/,"indice gauche"),e}function Ao(t){const e=Vs(t);return e[0].speech=e[0].speech.replace(/^sup/,"sup gauche"),e}function yo(t){const e=$s(t);return e[0].speech=e[0].speech.replace(/^sub/,"sub gauche"),e}function To(t,e){const n=t;let r=0;return function(){const t=_n.create({text:Io(n[r])&&Co(n[r+1])?W.MESSAGES.unitTimes:""},{});return r++,[t]}}const _o=["superscript","subscript","overscore","underscore"];function Io(t){for(;t;){if("unit"===t.getAttribute("role"))return!0;const e=t.tagName,n=I("children/*",t);t=-1!==_o.indexOf(e)?n[0]:n[n.length-1]}return!1}function Co(t){for(;t;){if("unit"===t.getAttribute("role"))return!0;t=I("children/*",t)[0]}return!1}function Oo(t){for(;t;){if("number"===t.tagName&&"1"===t.textContent)return[t];if("infixop"!==t.tagName||"multiplication"!==t.getAttribute("role")&&"implicit"!==t.getAttribute("role"))return[];t=I("children/*",t)[0]}return[]}function xo(t){const e=xs(t);return Tn.singleton(new Array(e).join(W.MESSAGES.MS.FRACTION_REPEAT)+W.MESSAGES.MS.FRACTION_START)}function Lo(t){const e=xs(t);return Tn.singleton(new Array(e).join(W.MESSAGES.MS.FRACTION_REPEAT)+W.MESSAGES.MS.FRACTION_END)}function Mo(t){const e=xs(t);return Tn.singleton(new Array(e).join(W.MESSAGES.MS.FRACTION_REPEAT)+W.MESSAGES.MS.FRACTION_OVER)}function Ro(t){const e=xs(t);return Tn.singleton(new Array(e).join(W.MESSAGES.MS.FRACTION_REPEAT)+"\u2838"+W.MESSAGES.MS.FRACTION_OVER)}function vo(t){return W.MESSAGES.regexp.HYPER===xs(t).toString()?[t]:[]}function Fo(t,e){const n=wo(t);return Tn.singleton(1===n?e:new Array(n).join(W.MESSAGES.MS.NESTED)+e)}function wo(t,e){const n=e||0;return t.parentNode?wo(t.parentNode,"root"===t.tagName||"sqrt"===t.tagName?n+1:n):n}function Do(t){return Fo(t,W.MESSAGES.MS.STARTROOT)}function Po(t){return Fo(t,W.MESSAGES.MS.ENDROOT)}function ko(t){return Fo(t,W.MESSAGES.MS.ROOTINDEX)}tt.getInstance().setCorrection("enlargeFence",(function(t){const e="\u2820";if(1===t.length)return e+t;const n=t.split("");return n.every((function(t){return"\u2833"===t}))?e+n.join(e):t.slice(0,-1)+e+t.slice(-1)}));const Uo=["multirel","relseq","appl","row","line"],Bo=["subscript","superscript","overscore","underscore"];function jo(t,e){const n=t.parent;if(!n)return!1;const r=n.type;return-1!==Uo.indexOf(r)||"prefixop"===r&&"negative"===n.role&&!e.script||"prefixop"===r&&"geometry"===n.role||!("punctuated"!==r||e.enclosed&&"text"!==n.role)}function $o(t,e){const n=t.slice(0);let r,s=!0;return r=t.length>0?I("../../content/*",t[0]):[],function(){const t=r.shift(),o=n.shift(),i=n[0],c=e?[_n.create({text:e},{translate:!0})]:[];if(!t)return c;const a=o?Bs(o,"",{sup:W.MESSAGES.MS.SUPER,sub:W.MESSAGES.MS.SUB}):"",l=o&&"EMPTY"!==k(o)||s&&t.parentNode.parentNode&&t.parentNode.parentNode.previousSibling?[_n.create({text:W.MESSAGES.regexp.SPACE+a},{})]:[],u=i&&"EMPTY"!==k(i)||!r.length&&t.parentNode.parentNode&&t.parentNode.parentNode.nextSibling?[_n.create({text:W.MESSAGES.regexp.SPACE},{})]:[],h=N.evaluateNode(t);return s=!1,c.concat(l,h,u)}}function Go(t,e){const n=t.slice(0);let r;return r=t.length>0?I("../../content/*",t[0]):[],function(){const t=n.shift(),s=n[0],o=r.shift(),i=e?[_n.create({text:e},{translate:!0})]:[];if(!o)return i;const c=t&&"NUMBER"===k(t),a=s&&"NUMBER"===k(s);return i.concat(c&&a&&"space"===o.getAttribute("role")?[_n.create({text:W.MESSAGES.regexp.SPACE},{})]:[])}}wn(new Rn("nemeth","number",(function(t,e){return t.childNodes.length?(-1!==Bo.indexOf(t.type)&&(e.script=!0),"fenced"===t.type?(e.number=!1,e.enclosed=!0,["",e]):(jo(t,e)&&(e.number=!0,e.enclosed=!1),["",e])):(jo(t,e)&&(e.number=!0,e.script=!1,e.enclosed=!1),[e.number?"number":"",{number:!1,enclosed:e.enclosed,script:e.script}])}),{number:!0}));let Vo=!1;function Ho(){Vo||(Cn(o.BASE_LOCALE+".speech.mathspeak","",{CQFspaceoutNumber:ys,CQFspaceoutIdentifier:Ts,CSFspaceoutText:bs,CSFopenFracVerbose:Ms,CSFcloseFracVerbose:Rs,CSFoverFracVerbose:vs,CSFopenFracBrief:Fs,CSFcloseFracBrief:ws,CSFopenFracSbrief:Ds,CSFcloseFracSbrief:Ps,CSFoverFracSbrief:ks,CSFvulgarFraction:mo,CQFvulgarFractionSmall:Us,CSFopenRadicalVerbose:Ws,CSFcloseRadicalVerbose:Xs,CSFindexRadicalVerbose:Ks,CSFopenRadicalBrief:zs,CSFcloseRadicalBrief:Zs,CSFindexRadicalBrief:Js,CSFopenRadicalSbrief:Qs,CSFindexRadicalSbrief:to,CQFisSmallRoot:ho,CSFsuperscriptVerbose:Gs,CSFsuperscriptBrief:Vs,CSFsubscriptVerbose:js,CSFsubscriptBrief:$s,CSFbaselineVerbose:Hs,CSFbaselineBrief:Ys,CSFleftsuperscriptVerbose:Gs,CSFleftsubscriptVerbose:js,CSFrightsuperscriptVerbose:Gs,CSFrightsubscriptVerbose:js,CSFleftsuperscriptBrief:Vs,CSFleftsubscriptBrief:$s,CSFrightsuperscriptBrief:Vs,CSFrightsubscriptBrief:$s,CSFunderscript:eo,CSFoverscript:ro,CSFendscripts:no,CTFordinalCounter:po,CTFwordCounter:fo,CTFcontentIterator:Ln,CQFdetIsSimple:so,CSFRemoveParens:io,CQFresetNesting:Is,CGFbaselineConstraint:oo,CGFtensorRules:uo}),Cn("es.speech.mathspeak",o.BASE_LOCALE+".speech.mathspeak",{CTFunitMultipliers:To,CQFoneLeft:Oo}),Cn("fr.speech.mathspeak",o.BASE_LOCALE+".speech.mathspeak",{CSFbaselineVerbose:No,CSFbaselineBrief:So,CSFleftsuperscriptVerbose:Eo,CSFleftsubscriptVerbose:bo,CSFleftsuperscriptBrief:Ao,CSFleftsubscriptBrief:yo}),Cn(o.BASE_LOCALE+".speech.clearspeak","",{CTFpauseSeparator:xn,CTFnodeCounter:Pn,CTFcontentIterator:Ln,CSFvulgarFraction:mo,CQFvulgarFractionSmall:qn,CQFcellsSimple:Yn,CSFordinalExponent:Wn,CSFwordOrdinal:er,CQFmatchingFences:zn,CSFnestingDepth:Kn,CQFfencedArguments:Zn,CQFsimpleArguments:Jn,CQFspaceoutNumber:ys}),Cn("en.prefix.default","",{CSFordinalPosition:go}),Cn("en.speech.chromevox","",{CTFnodeCounter:On,CTFcontentIterator:Ln}),Cn("en.speech.emacspeak","en.speech.chromevox",{CQFvulgarFractionSmall:Us,CSFvulgarFraction:mo}),Cn("nemeth.braille.default",o.BASE_LOCALE+".speech.mathspeak",{CSFopenFraction:xo,CSFcloseFraction:Lo,CSFoverFraction:Mo,CSFoverBevFraction:Ro,CQFhyperFraction:vo,CSFopenRadical:Do,CSFcloseRadical:Po,CSFindexRadical:ko,CSFsubscript:js,CSFsuperscript:Gs,CSFbaseline:Hs,CGFtensorRules:t=>uo(t,!1),CTFrelationIterator:$o,CTFimplicitIterator:Go}),Vo=!0)}class Yo{constructor(t,e,n,r){this.name=t,this.dynamicCstr=e,this.precondition=n,this.action=r,this.context=null}toString(){return this.name+" | "+this.dynamicCstr.toString()+" | "+this.precondition.toString()+" ==> "+this.action.toString()}}var qo,Wo;function Xo(t){switch(t){case"[n]":return qo.NODE;case"[m]":return qo.MULTI;case"[t]":return qo.TEXT;case"[p]":return qo.PERSONALITY;default:throw"Parse error: "+t}}!function(t){t.NODE="NODE",t.MULTI="MULTI",t.TEXT="TEXT",t.PERSONALITY="PERSONALITY"}(qo||(qo={}));class Ko{static grammarFromString(t){return tt.parseInput(t)}static fromString(t){const e={type:Xo(t.substring(0,3))};let n=t.slice(3).trim();if(!n)throw new Jo("Missing content.");switch(e.type){case qo.TEXT:if('"'===n[0]){const t=Qo(n,"\\(")[0].trim();if('"'!==t.slice(-1))throw new Jo("Invalid string syntax.");e.content=t,n=n.slice(t.length).trim(),-1===n.indexOf("(")&&(n="");break}case qo.NODE:case qo.MULTI:{const t=n.indexOf(" (");if(-1===t){e.content=n.trim(),n="";break}e.content=n.substring(0,t).trim(),n=n.slice(t).trim()}}if(n){const t=Ko.attributesFromString(n);t.grammar&&(e.grammar=t.grammar,delete t.grammar),Object.keys(t).length&&(e.attributes=t)}return new Ko(e)}static attributesFromString(t){if("("!==t[0]||")"!==t.slice(-1))throw new Jo("Invalid attribute expression: "+t);const e={},n=Qo(t.slice(1,-1),",");for(const t of n){const n=t.indexOf(":");if(-1===n)e[t.trim()]="true";else{const r=t.substring(0,n).trim(),s=t.slice(n+1).trim();e[r]=r===Q?Ko.grammarFromString(s):s}}return e}constructor({type:t,content:e,attributes:n,grammar:r}){this.type=t,this.content=e,this.attributes=n,this.grammar=r}toString(){let t="";t+=function(t){switch(t){case qo.NODE:return"[n]";case qo.MULTI:return"[m]";case qo.TEXT:return"[t]";case qo.PERSONALITY:return"[p]";default:throw"Unknown type error: "+t}}(this.type),t+=this.content?" "+this.content:"";const e=this.attributesToString();return t+=e?" "+e:"",t}grammarToString(){return this.getGrammar().join(":")}getGrammar(){if(!this.grammar)return[];const t=[];for(const[e,n]of Object.entries(this.grammar))t.push(!0===n?e:!1===n?`!${e}`:`${e}=${n}`);return t}attributesToString(){const t=this.getAttributes(),e=this.grammarToString();return e&&t.push("grammar:"+e),t.length>0?"("+t.join(", ")+")":""}getAttributes(){if(!this.attributes)return[];const t=[];for(const[e,n]of Object.entries(this.attributes))t.push("true"===n?e:`${e}:${n}`);return t}}class zo{static fromString(t){const e=Qo(t,";").filter((function(t){return t.match(/\S/)})).map((function(t){return t.trim()})),n=[];for(let t=0,r=e.length;t<r;t++){const r=Ko.fromString(e[t]);r&&n.push(r)}return zo.naiveSpan(n),new zo(n)}static naiveSpan(t){var e;let n=!1;for(let r,s=0;r=t[s];s++){if(n&&(r.type!==qo.TEXT||'"'!==r.content[0]&&!r.content.match(/^CSF/)))continue;if(!n&&r.type===qo.PERSONALITY)continue;if(!n){n=!0;continue}if(null===(e=r.attributes)||void 0===e?void 0:e.span)continue;const o=t[s+1];o&&o.type!==qo.NODE||zo.addNaiveSpan(r,o?o.content:"LAST")}}static addNaiveSpan(t,e){t.attributes||(t.attributes={}),t.attributes.span=e}constructor(t){this.components=t}toString(){return this.components.map((function(t){return t.toString()})).join("; ")}}class Zo{static constraintValue(t,e){for(let n,r=0;n=e[r];r++)if(t.match(n))return++r;return 0}toString(){const t=this.constraints.join(", ");return`${this.query}, ${t} (${this.priority}, ${this.rank})`}constructor(t,...e){this.query=t,this.constraints=e;const[n,r]=this.presetPriority();this.priority=n?r:this.calculatePriority()}calculatePriority(){const t=Zo.constraintValue(this.query,Zo.queryPriorities);if(!t)return 0;const e=this.query.match(/^self::.+\[(.+)\]/);let n=0;if((null==e?void 0:e.length)&&e[1]){const t=e[1];n=Zo.constraintValue(t,Zo.attributePriorities)}return 100*t+10*n}presetPriority(){if(!this.constraints.length)return[!1,0];const t=this.constraints[this.constraints.length-1].match(/^priority=(.*$)/);if(!t)return[!1,0];this.constraints.pop();const e=parseFloat(t[1]);return[!0,isNaN(e)?0:e]}}Zo.queryPriorities=[/^self::\*$/,/^self::[\w-]+$/,/^self::\*\[.+\]$/,/^self::[\w-]+\[.+\]$/],Zo.attributePriorities=[/^@[\w-]+$/,/^@[\w-]+!=".+"$/,/^not\(contains\(@[\w-]+,\s*".+"\)\)$/,/^contains\(@[\w-]+,".+"\)$/,/^@[\w-]+=".+"$/];class Jo extends m{constructor(t){super(t),this.name="RuleError"}}function Qo(t,e){const n=[];let r="";for(;""!==t;){const s=t.search(e);if(-1===s){if((t.match(/"/g)||[]).length%2!=0)throw new Jo("Invalid string in expression: "+t);n.push(r+t),r="",t=""}else if((t.substring(0,s).match(/"/g)||[]).length%2==0)n.push(r+t.substring(0,s)),r="",t=t.substring(s+1);else{const e=t.substring(s).search('"');if(-1===e)throw new Jo("Invalid string in expression: "+t);r+=t.substring(0,s+e+1),t=t.substring(s+e+1)}}return r&&n.push(r),n}class ti{constructor(t,e){this.prefix=t,this.store=e}add(t,e){this.checkCustomFunctionSyntax_(t)&&(this.store[t]=e)}addStore(t){const e=Object.keys(t.store);for(let n,r=0;n=e[r];r++)this.add(n,t.store[n])}lookup(t){return this.store[t]}checkCustomFunctionSyntax_(t){const e=new RegExp("^"+this.prefix);return!!t.match(e)||(console.error("FunctionError: Invalid function name. Expected prefix "+this.prefix),!1)}}class ei extends ti{constructor(){super("CQF",{})}}class ni extends ti{constructor(){super("CSF",{})}}class ri extends ti{constructor(){super("CTF",{})}}class si extends ti{constructor(){super("CGF",{})}}class oi{constructor(){this.customQueries=new ei,this.customStrings=new ni,this.contextFunctions=new ri,this.customGenerators=new si}applyCustomQuery(t,e){const n=this.customQueries.lookup(e);return n?n(t):null}applySelector(t,e){return this.applyCustomQuery(t,e)||I(e,t)}applyQuery(t,e){const n=this.applySelector(t,e);return n.length>0?n[0]:null}applyConstraint(t,e){return!!this.applyQuery(t,e)||function(t,e){let n;try{n=_(t,e,b.result.BOOLEAN_TYPE)}catch(t){return!1}return n.booleanValue}(e,t)}constructString(t,e){const n=this.constructString_(t,e);return Array.isArray(n)?n.map((t=>t.speech)).join(""):n}constructSpan(t,e,n){const r=this.constructString_(t,e);if(Array.isArray(r)){const t=r[r.length-1];return t.attributes=Object.assign({},n,t.attributes),r}return[Tn.node(r,t,n)]}constructString_(t,e){if(!e)return"";if('"'===e.charAt(0))return e.slice(1,-1);const n=this.customStrings.lookup(e);return n?n(t):function(t,e){let n;try{n=_(t,e,b.result.STRING_TYPE)}catch(t){return""}return n.stringValue}(e,t)}parse(t){const e=Array.isArray(t)?t:Object.entries(t);for(const t of e){switch(t[0].slice(0,3)){case"CQF":this.customQueries.add(t[0],t[1]);break;case"CSF":this.customStrings.add(t[0],t[1]);break;case"CTF":this.contextFunctions.add(t[0],t[1]);break;case"CGF":this.customGenerators.add(t[0],t[1]);break;default:console.error("FunctionError: Invalid function name "+t[0])}}}}class ii{static compareStaticConstraints_(t,e){if(t.length!==e.length)return!1;for(let n,r=0;n=t[r];r++)if(-1===e.indexOf(n))return!1;return!0}static comparePreconditions_(t,e){const n=t.precondition,r=e.precondition;return n.query===r.query&&ii.compareStaticConstraints_(n.constraints,r.constraints)}constructor(){this.context=new oi,this.parseOrder=o.DEFAULT_ORDER,this.parser=new i(this.parseOrder),this.locale=o.DEFAULT_VALUES[t.LOCALE],this.modality=o.DEFAULT_VALUES[t.MODALITY],this.domain="",this.initialized=!1,this.inherits=null,this.kind="standard",this.customTranscriptions={},this.preconditions=new Map,this.speechRules_=[],this.rank=0,this.parseMethods={Rule:this.defineRule,Generator:this.generateRules,Action:this.defineAction,Precondition:this.definePrecondition,Ignore:this.ignoreRules}}defineRule(t,e,n,r,...s){const o=this.parseAction(n),i=this.parsePrecondition(r,s),c=this.parseCstr(e);if(!(o&&i&&c))return console.error(`Rule Error: ${r}, (${e}): ${n}`),null;const a=new Yo(t,c,i,o);return a.precondition.rank=this.rank++,this.addRule(a),a}addRule(t){t.context=this.context,this.speechRules_.unshift(t)}deleteRule(t){const e=this.speechRules_.indexOf(t);-1!==e&&this.speechRules_.splice(e,1)}findRule(t){for(let e,n=0;e=this.speechRules_[n];n++)if(t(e))return e;return null}findAllRules(t){return this.speechRules_.filter(t)}evaluateDefault(t){const e=t.textContent.slice(0);return e.match(/^\s+$/)?this.evaluateWhitespace(e):this.evaluateString(e)}evaluateWhitespace(t){return[]}evaluateCustom(t){const e=this.customTranscriptions[t];return void 0!==e?_n.create({text:e},{adjust:!0,translate:!1}):null}evaluateCharacter(t){return this.evaluateCustom(t)||_n.create({text:t},{adjust:!0,translate:!0})}removeDuplicates(t){for(let e,n=this.speechRules_.length-1;e=this.speechRules_[n];n--)e!==t&&t.dynamicCstr.equal(e.dynamicCstr)&&ii.comparePreconditions_(e,t)&&this.speechRules_.splice(n,1)}getSpeechRules(){return this.speechRules_}setSpeechRules(t){this.speechRules_=t}getPreconditions(){return this.preconditions}parseCstr(t){try{return this.parser.parse(this.locale+"."+this.modality+(this.domain?"."+this.domain:"")+"."+t)}catch(e){if("RuleError"===e.name)return console.error("Rule Error ",`Illegal Dynamic Constraint: ${t}.`,e.message),null;throw e}}parsePrecondition(t,e){try{const n=this.parsePrecondition_(t);t=n[0];let r=n.slice(1);for(const t of e)r=r.concat(this.parsePrecondition_(t));return new Zo(t,...r)}catch(n){if("RuleError"===n.name)return console.error("Rule Error ",`Illegal preconditions: ${t}, ${e}.`,n.message),null;throw n}}parseAction(t){try{return zo.fromString(t)}catch(e){if("RuleError"===e.name)return console.error("Rule Error ",`Illegal action: ${t}.`,e.message),null;throw e}}parse(t){this.modality=t.modality||this.modality,this.locale=t.locale||this.locale,this.domain=t.domain||this.domain,this.context.parse(t.functions||[]),"actions"!==t.kind&&(this.kind=t.kind||this.kind,this.inheritRules()),this.parseRules(t.rules||[])}parseRules(t){for(let e,n=0;e=t[n];n++){const t=e[0],n=this.parseMethods[t];t&&n&&n.apply(this,e.slice(1))}}generateRules(t){const e=this.context.customGenerators.lookup(t);e&&e(this)}defineAction(t,e){let n;try{n=zo.fromString(e)}catch(t){if("RuleError"===t.name)return void console.error("Action Error ",e,t.message);throw t}const r=this.getFullPreconditions(t);if(!r)return void console.error(`Action Error: No precondition for action ${t}`);this.ignoreRules(t);const s=new RegExp("^\\w+\\.\\w+\\."+(this.domain?"\\w+\\.":""));r.conditions.forEach((([e,r])=>{const o=this.parseCstr(e.toString().replace(s,""));this.addRule(new Yo(t,o,r,n))}))}getFullPreconditions(t){const e=this.preconditions.get(t);return e||!this.inherits?e:this.inherits.getFullPreconditions(t)}definePrecondition(t,e,n,...r){const s=this.parsePrecondition(n,r),o=this.parseCstr(e);s&&o?(s.rank=this.rank++,this.preconditions.set(t,new ci(o,s))):console.error(`Precondition Error: ${n}, (${e})`)}inheritRules(){if(!this.inherits||!this.inherits.getSpeechRules().length)return;const t=new RegExp("^\\w+\\.\\w+\\."+(this.domain?"\\w+\\.":""));this.inherits.getSpeechRules().forEach((e=>{const n=this.parseCstr(e.dynamicCstr.toString().replace(t,""));this.addRule(new Yo(e.name,n,e.precondition,e.action))}))}ignoreRules(t,...e){let n=this.findAllRules((e=>e.name===t));if(!e.length)return void n.forEach(this.deleteRule.bind(this));let r=[];for(const t of e){const e=this.parseCstr(t);for(const t of n)e.equal(t.dynamicCstr)?this.deleteRule(t):r.push(t);n=r,r=[]}}parsePrecondition_(t){const e=this.context.customGenerators.lookup(t);return e?e():[t]}}class ci{constructor(t,e){this.base=t,this._conditions=[],this.constraints=[],this.allCstr={},this.constraints.push(t),this.addCondition(t,e)}get conditions(){return this._conditions}addConstraint(t){if(this.constraints.filter((e=>e.equal(t))).length)return;this.constraints.push(t);const e=[];for(const[n,r]of this.conditions)this.base.equal(n)&&e.push([t,r]);this._conditions=this._conditions.concat(e)}addBaseCondition(t){this.addCondition(this.base,t)}addFullCondition(t){this.constraints.forEach((e=>this.addCondition(e,t)))}addCondition(t,e){const n=t.toString()+" "+e.toString();this.allCstr.condStr||(this.allCstr[n]=!0,this._conditions.push([t,e]))}}class ai extends ii{constructor(){super(),this.annotators=[],this.parseMethods.Alias=this.defineAlias,this.parseMethods.SpecializedRule=this.defineSpecializedRule,this.parseMethods.Specialized=this.defineSpecialized}initialize(){this.initialized||(this.annotations(),this.initialized=!0)}annotations(){for(let t,e=0;t=this.annotators[e];e++)Dn(this.domain,t)}defineAlias(t,e,...n){const r=this.parsePrecondition(e,n);if(!r)return void console.error(`Precondition Error: ${e} ${n}`);const s=this.preconditions.get(t);s?s.addFullCondition(r):console.error(`Alias Error: No precondition by the name of ${t}`)}defineRulesAlias(t,e,...n){const r=this.findAllRules((function(e){return e.name===t}));if(0===r.length)throw new Jo("Rule with name "+t+" does not exist.");const s=[];r.forEach((t=>{(t=>{const e=t.dynamicCstr.toString(),n=t.action.toString();for(let t,r=0;t=s[r];r++)if(t.action===n&&t.cstr===e)return!1;return s.push({cstr:e,action:n}),!0})(t)&&this.addAlias_(t,e,n)}))}defineSpecializedRule(t,e,n,r){const s=this.parseCstr(e),o=this.findRule((e=>e.name===t&&s.equal(e.dynamicCstr))),i=this.parseCstr(n);if(!o&&r)throw new Jo("Rule named "+t+" with style "+e+" does not exist.");const c=r?zo.fromString(r):o.action,a=new Yo(o.name,i,o.precondition,c);this.addRule(a)}defineSpecialized(t,e,n){const r=this.parseCstr(n);if(!r)return void console.error(`Dynamic Constraint Error: ${n}`);const s=this.preconditions.get(t);s?s.addConstraint(r):console.error(`Alias Error: No precondition by the name of ${t}`)}evaluateString(t){const e=[];if(t.match(/^\s+$/))return e;let n=this.matchNumber_(t);if(n&&n.length===t.length)return e.push(this.evaluateCharacter(n.number)),e;const r=t.replace(/\s/g," ").split(" ").filter((t=>t));for(let t,s=0;t=r[s];s++)if(1===t.length)e.push(this.evaluateCharacter(t));else if(t.match(new RegExp("^["+W.MESSAGES.regexp.TEXT+"]+$")))e.push(this.evaluateCharacter(t));else{let r=t;for(;r;){n=this.matchNumber_(r);const t=r.match(new RegExp("^["+W.MESSAGES.regexp.TEXT+"]+"));if(n)e.push(this.evaluateCharacter(n.number)),r=r.substring(n.length);else if(t)e.push(this.evaluateCharacter(t[0])),r=r.substring(t[0].length);else{const t=Array.from(r),n=t[0];e.push(this.evaluateCharacter(n)),r=t.slice(1).join("")}}}return e}parse(t){super.parse(t),this.annotators=t.annotators||[]}addAlias_(t,e,n){const r=this.parsePrecondition(e,n),s=new Yo(t.name,t.dynamicCstr,r,t.action);s.name=t.name,this.addRule(s)}matchNumber_(t){const e=t.match(new RegExp("^"+W.MESSAGES.regexp.NUMBER)),n=t.match(new RegExp("^"+ai.regexp.NUMBER));if(!e&&!n)return null;const r=n&&n[0]===t;if(e&&e[0]===t||!r)return e?{number:e[0],length:e[0].length}:null;return{number:n[0].replace(new RegExp(ai.regexp.DIGIT_GROUP,"g"),"X").replace(new RegExp(ai.regexp.DECIMAL_MARK,"g"),W.MESSAGES.regexp.DECIMAL_MARK).replace(/X/g,W.MESSAGES.regexp.DIGIT_GROUP.replace(/\\/g,"")),length:n[0].length}}}ai.regexp={NUMBER:"((\\d{1,3})(?=(,| ))((,| )\\d{3})*(\\.\\d+)?)|^\\d*\\.\\d+|^\\d+",DECIMAL_MARK:"\\.",DIGIT_GROUP:","};class li extends ai{constructor(){super(...arguments),this.modality="braille",this.customTranscriptions={"\u22ca":"\u2808\u2821\u2833"}}evaluateString(t){const e=[],n=Array.from(t);for(let t=0;t<n.length;t++)e.push(this.evaluateCharacter(n[t]));return e}annotations(){for(let t,e=0;t=this.annotators[e];e++)Dn(this.locale,t)}}class ui extends li{constructor(){super(...arguments),this.locale="euro",this.customTranscriptions={},this.customCommands={"\\cdot":"*"}}evaluateString(t){const e=t.split(/(\\[a-z]+)/i);return console.log(e),super.evaluateString(this.cleanup(e).join(""))}cleanup(t){let e=[];for(const n of t){if(n.match(/^\\/)){const t=this.customCommands[n];e.push(t||n);continue}const t=n.split("").map((t=>{const e=Ze.Meaning.get(t);return"operator"===e.type||"relation"===e.type?" "+t:t}));e=e.concat(t)}return e}}!function(t){t.ROOT="root",t.DYNAMIC="dynamic",t.QUERY="query",t.BOOLEAN="boolean",t.STATIC="static"}(Wo||(Wo={}));class hi{constructor(t,e){this.constraint=t,this.test=e,this.children_={},this.kind=Wo.ROOT}getConstraint(){return this.constraint}getKind(){return this.kind}applyTest(t){return this.test(t)}addChild(t){const e=t.getConstraint(),n=this.children_[e];return this.children_[e]=t,n}getChild(t){return this.children_[t]}getChildren(){const t=[];for(const e of Object.values(this.children_))t.push(e);return t}findChildren(t){const e=[];for(const n of Object.values(this.children_))n.applyTest(t)&&e.push(n);return e}removeChild(t){delete this.children_[t]}toString(){return this.constraint}}class di extends hi{constructor(t,e){super(t,e),this.rule_=null,this.kind=Wo.STATIC}getRule(){return this.rule_}setRule(t){this.rule_&&p.getInstance().output("Replacing rule "+this.rule_+" with "+t),this.rule_=t}toString(){return this.getRule()?this.constraint+"\n==> "+this.getRule().action:this.constraint}}function pi(t,e,n){switch(t){case Wo.ROOT:return new fi;case Wo.DYNAMIC:return new mi(e);case Wo.QUERY:return new Si(e,n);case Wo.BOOLEAN:return new Ei(e,n);default:return null}}class fi extends hi{constructor(){super("",(()=>!0)),this.kind=Wo.ROOT}}class mi extends hi{constructor(t){super(t,(e=>e===t)),this.kind=Wo.DYNAMIC}}const gi={"=":(t,e)=>t===e,"!=":(t,e)=>t!==e,"<":(t,e)=>t<e,">":(t,e)=>t>e,"<=":(t,e)=>t<=e,">=":(t,e)=>t>=e};function Ni(t){if(t.match(/^self::\*$/))return t=>!0;if(t.match(/^self::\w+$/)){const e=t.slice(6).toUpperCase();return t=>t.tagName&&k(t)===e}if(t.match(/^self::\w+:\w+$/)){const e=t.split(":"),n=y(e[2]);if(!n)return null;const r=e[3].toUpperCase();return t=>t.localName&&t.localName.toUpperCase()===r&&t.namespaceURI===n}if(t.match(/^@\w+$/)){const e=t.slice(1);return t=>t.hasAttribute&&t.hasAttribute(e)}if(t.match(/^@\w+="[\w\d ]+"$/)){const e=t.split("="),n=e[0].slice(1),r=e[1].slice(1,-1);return t=>t.hasAttribute&&t.hasAttribute(n)&&t.getAttribute(n)===r}if(t.match(/^@\w+!="[\w\d ]+"$/)){const e=t.split("!="),n=e[0].slice(1),r=e[1].slice(1,-1);return t=>!t.hasAttribute||!t.hasAttribute(n)||t.getAttribute(n)!==r}if(t.match(/^contains\(\s*@grammar\s*,\s*"[\w\d ]+"\s*\)$/)){const e=t.split('"')[1];return t=>!!tt.getInstance().getParameter(e)}if(t.match(/^not\(\s*contains\(\s*@grammar\s*,\s*"[\w\d ]+"\s*\)\s*\)$/)){const e=t.split('"')[1];return t=>!tt.getInstance().getParameter(e)}if(t.match(/^name\(\.\.\/\.\.\)="\w+"$/)){const e=t.split('"')[1].toUpperCase();return t=>{var n,r;return(null===(r=null===(n=t.parentNode)||void 0===n?void 0:n.parentNode)||void 0===r?void 0:r.tagName)&&k(t.parentNode.parentNode)===e}}if(t.match(/^count\(preceding-sibling::\*\)=\d+$/)){const e=t.split("="),n=parseInt(e[1],10);return t=>{var e;return(null===(e=t.parentNode)||void 0===e?void 0:e.childNodes[n])===t}}if(t.match(/^.+\[@category!?=".+"\]$/)){let[,e,n,r]=t.match(/^(.+)\[@category(!?=)"(.+)"\]$/);const s=r.match(/^unit:(.+)$/);let o="";return s&&(r=s[1],o=":unit"),t=>{const s=I(e,t)[0];if(s){const t=function(t){const e=dn.get(t);return(null==e?void 0:e.base)?e.base.category:""}(s.textContent+o);return"="===n?t===r:t!==r}return!1}}if(t.match(/^string-length\(.+\)\W+\d+/)){const[,e,n,r]=t.match(/^string-length\((.+)\)(\W+)(\d+)/),s=gi[n]||gi["="],o=parseInt(r,10);return t=>{const n=I(e,t)[0];return!!n&&s(Array.from(n.textContent).length,o)}}return null}class Si extends di{constructor(t,e){super(t,Ni(t)),this.context=e,this.kind=Wo.QUERY}applyTest(t){return this.test?this.test(t):this.context.applyQuery(t,this.constraint)===t}}class Ei extends di{constructor(t,e){super(t,Ni(t)),this.context=e,this.kind=Wo.BOOLEAN}applyTest(t){return this.test?this.test(t):this.context.applyConstraint(t,this.constraint)}}class bi{static collectRules_(t){const e=[];let n=[t];for(;n.length;){const t=n.shift();if(t.getKind()===Wo.QUERY||t.getKind()===Wo.BOOLEAN){const n=t.getRule();n&&e.unshift(n)}n=n.concat(t.getChildren())}return e}static printWithDepth_(t,e,n){n+=new Array(e+2).join(e.toString())+": "+t.toString()+"\n";const r=t.getChildren();for(let t,s=0;t=r[s];s++)n=bi.printWithDepth_(t,e+1,n);return n}static order_(t){const e=t.getChildren();if(!e.length)return 0;const n=Math.max.apply(null,e.map(bi.order_));return Math.max(e.length,n)}constructor(){this.root=pi(Wo.ROOT,"",null)}addRule(t){let e=this.root;const n=t.context,r=t.dynamicCstr.getValues();for(let t=0,s=r.length;t<s;t++)e=this.addNode_(e,r[t],Wo.DYNAMIC,n);e=this.addNode_(e,t.precondition.query,Wo.QUERY,n);const s=t.precondition.constraints;for(let t=0,r=s.length;t<r;t++)e=this.addNode_(e,s[t],Wo.BOOLEAN,n);e.setRule(t)}lookupRules(t,e){let n=[this.root];const r=[];for(;e.length;){const t=e.shift(),r=[];for(;n.length;){n.shift().getChildren().forEach((e=>{e.getKind()===Wo.DYNAMIC&&-1===t.indexOf(e.getConstraint())||r.push(e)}))}n=r.slice()}for(;n.length;){const e=n.shift();if(e.getRule){const t=e.getRule();t&&r.push(t)}const s=e.findChildren(t);n=n.concat(s)}return r}hasSubtrie(t){let e=this.root;for(let n=0,r=t.length;n<r;n++){const r=t[n];if(e=e.getChild(r),!e)return!1}return!0}toString(){return bi.printWithDepth_(this.root,0,"")}collectRules(t=this.root){return bi.collectRules_(t)}order(){return bi.order_(this.root)}enumerate(t){return this.enumerate_(this.root,t)}byConstraint(t){let e=this.root;for(;t.length&&e;){const n=t.shift();e=e.getChild(n)}return e||null}enumerate_(t,e){e=e||{};const n=t.getChildren();for(let t,r=0;t=n[r];r++)t.kind===Wo.DYNAMIC&&(e[t.getConstraint()]=this.enumerate_(t,e[t.getConstraint()]));return e}addNode_(t,e,n,r){let s=t.getChild(e);return s||(s=pi(n,e,r),t.addChild(s)),s}}class Ai{static getInstance(){return Ai.instance=Ai.instance||new Ai,Ai.instance}static debugSpeechRule(t,e){const n=t.precondition,r=t.context.applyQuery(e,n.query);p.getInstance().output(n.query,r?r.toString():r),n.constraints.forEach((n=>p.getInstance().output(n,t.context.applyConstraint(e,n))))}static debugNamedSpeechRule(t,e){const n=Ai.getInstance().trie.collectRules().filter((e=>e.name==t));for(let r,s=0;r=n[s];s++)p.getInstance().output("Rule",t,"DynamicCstr:",r.dynamicCstr.toString(),"number",s),Ai.debugSpeechRule(r,e)}evaluateNode(t){C(t);const e=(new Date).getTime();let n=[];try{n=this.evaluateNode_(t)}catch(t){console.error("Something went wrong computing speech."),p.getInstance().output(t)}const r=(new Date).getTime();return p.getInstance().output("Time:",r-e),n}toString(){return this.trie.collectRules().map((t=>t.toString())).join("\n")}runInSetting(t,e){const n=N.getInstance(),r={};for(const[e,s]of Object.entries(t))r[e]=n[e],n[e]=s;n.setDynamicCstr();const s=e();for(const[t,e]of Object.entries(r))n[t]=e;return n.setDynamicCstr(),s}static addStore(e){const n=function(e){const n=`${e.locale}.${e.modality}.${e.domain}`;if("actions"===e.kind){const t=yi.get(n);return t.parse(e),t}Ho(),e&&!e.functions&&(e.functions=function(e,n,r){return In.get([e,n,r].join("."))||In.get([o.DEFAULT_VALUES[t.LOCALE],n,r].join("."))||In.get([o.BASE_LOCALE,n,r].join("."))||{}}(e.locale,e.modality,e.domain));const r=function(t,e){if("braille"===e&&"euro"===t)return new ui;if("braille"===e)return new li;return new ai}(e.locale,e.modality);yi.set(n,r),e.inherits&&(r.inherits=yi.get(`${e.inherits}.${e.modality}.${e.domain}`));return r.parse(e),r.initialize(),r}(e);"abstract"!==n.kind&&n.getSpeechRules().forEach((t=>Ai.getInstance().trie.addRule(t))),Ai.getInstance().addEvaluator(n)}processGrammar(t,e,n){const r={};for(const[s,o]of Object.entries(n))r[s]="string"==typeof o?t.constructString(e,o):o;tt.getInstance().pushState(r)}addEvaluator(t){const e=t.evaluateDefault.bind(t),n=this.evaluators_[t.locale];if(n)return void(n[t.modality]=e);const r={};r[t.modality]=e,this.evaluators_[t.locale]=r}getEvaluator(e,n){const r=this.evaluators_[e]||this.evaluators_[o.DEFAULT_VALUES[t.LOCALE]];return r[n]||r[o.DEFAULT_VALUES[t.MODALITY]]}enumerate(t){return this.trie.enumerate(t)}constructor(){this.trie=null,this.evaluators_={},this.trie=new bi}evaluateNode_(t){return t?(this.updateConstraint_(),this.evaluateTree_(t)):[]}evaluateTree_(t){const n=N.getInstance();let r;p.getInstance().output(n.mode!==e.HTTP?t.toString():t),tt.getInstance().setAttribute(t);const s=this.lookupRule(t,n.dynamicCstr);if(!s)return n.strict?[]:(r=this.getEvaluator(n.locale,n.modality)(t),t.attributes&&this.addPersonality_(r,{},!1,t),r);p.getInstance().generateOutput((()=>["Apply Rule:",s.name,s.dynamicCstr.toString(),(n.mode,e.HTTP,t).toString()])),tt.getInstance().processSingles();const o=s.context,i=s.action.components;r=[];for(let e,n=0;e=i[n];n++){let n=[];const s=e.content||"",i=e.attributes||{};let c=!1;e.grammar&&this.processGrammar(o,t,e.grammar);let a=null;if(i.engine){a=N.getInstance().dynamicCstr.getComponents();const t=tt.parseInput(i.engine);N.getInstance().setDynamicCstr(t)}switch(e.type){case qo.NODE:{const e=o.applyQuery(t,s);e&&(n=this.evaluateTree_(e))}break;case qo.MULTI:{c=!0;const e=o.applySelector(t,s);e.length>0&&(n=this.evaluateNodeList_(o,e,i.sepFunc,o.constructString(t,i.separator),i.ctxtFunc,o.constructString(t,i.context)))}break;case qo.TEXT:{const e=i.span;let r={};if(e){const n=I(e,t);r=n.length?Tn.getAttributes(n[0]):{kind:e}}n=o.constructSpan(t,s,r).map((function(t){return _n.create({text:t.speech,attributes:t.attributes},{adjust:!0})}))}break;case qo.PERSONALITY:default:n=[_n.create({text:s})]}n[0]&&!c&&(i.context&&(n[0].context=o.constructString(t,i.context)+(n[0].context||"")),i.annotation&&(n[0].annotation=i.annotation)),this.addLayout(n,i,c),e.grammar&&tt.getInstance().popState(),r=r.concat(this.addPersonality_(n,i,c,t)),a&&N.getInstance().setDynamicCstr(a)}return tt.getInstance().popState(),r}evaluateNodeList_(t,e,n,r,s,o){if(!e.length)return[];const i=r||"",c=o||"",a=t.contextFunctions.lookup(s),l=a?a(e,c):function(){return c},u=t.contextFunctions.lookup(n),h=u?u(e,i):function(){return[_n.create({text:i},{translate:!0})]};let d=[];for(let t,n=0;t=e[n];n++){const r=this.evaluateTree_(t);if(r.length>0&&(r[0].context=l()+(r[0].context||""),d=d.concat(r),n<e.length-1)){const t=h();d=d.concat(t)}}return d}addLayout(t,e,n){const r=e.layout;r&&(r.match(/^begin/)?t.unshift(new _n({text:"",layout:r})):r.match(/^end/)?t.push(new _n({text:"",layout:r})):(t.unshift(new _n({text:"",layout:`begin${r}`})),t.push(new _n({text:"",layout:`end${r}`}))))}addPersonality_(t,e,r,s){const o={};let i=null;for(const t of a){const r=e[t];if(void 0===r)continue;const s=parseFloat(r),c=isNaN(s)?'"'===r.charAt(0)?r.slice(1,-1):r:s;t===n.PAUSE?i=c:o[t]=c}for(let e,n=0;e=t[n];n++)this.addRelativePersonality_(e,o),this.addExternalAttributes_(e,s);if(r&&t.length&&delete t[t.length-1].personality[n.JOIN],i&&t.length){const e=t[t.length-1];e.text||Object.keys(e.personality).length?t.push(_n.create({text:"",personality:{pause:i}})):e.personality[n.PAUSE]=i}return t}addExternalAttributes_(t,e){if(void 0===t.attributes.id&&(t.attributes.id=e.getAttribute("id")),e.hasAttributes()){const n=e.attributes;for(let e=n.length-1;e>=0;e--){const r=n[e].name;!t.attributes[r]&&r.match(/^ext/)&&(t.attributes[r]=n[e].value)}}}addRelativePersonality_(t,e){if(!t.personality)return t.personality=e,t;const n=t.personality;for(const[t,r]of Object.entries(e))n[t]&&"number"==typeof n[t]&&"number"==typeof r?n[t]=n[t]+r:n[t]||(n[t]=r);return t}updateConstraint_(){const e=N.getInstance().dynamicCstr,n=N.getInstance().strict,r=this.trie,s={};let i=e.getValue(t.LOCALE),c=e.getValue(t.MODALITY),a=e.getValue(t.DOMAIN);r.hasSubtrie([i,c,a])||(a=o.DEFAULT_VALUES[t.DOMAIN],r.hasSubtrie([i,c,a])||(c=o.DEFAULT_VALUES[t.MODALITY],r.hasSubtrie([i,c,a])||(i=o.DEFAULT_VALUES[t.LOCALE]))),s[t.LOCALE]=[i],s[t.MODALITY]=["summary"!==c?c:o.DEFAULT_VALUES[t.MODALITY]],s[t.DOMAIN]=["speech"!==c?o.DEFAULT_VALUES[t.DOMAIN]:a];const l=e.getOrder();for(let t,r=0;t=l[r];r++)if(!s[t]){const r=e.getValue(t),i=this.makeSet_(r,e.preference),c=o.DEFAULT_VALUES[t];n||r===c||i.push(c),s[t]=i}e.updateProperties(s)}makeSet_(t,e){return e&&Object.keys(e).length?t.split(":"):[t]}lookupRule(t,e){if(!t||t.nodeType!==L.ELEMENT_NODE&&t.nodeType!==L.TEXT_NODE)return null;const n=this.lookupRules(t,e);return n.length>0?this.pickMostConstraint_(e,n):null}lookupRules(t,e){return this.trie.lookupRules(t,e.allProperties())}pickMostConstraint_(t,e){const n=N.getInstance().comparator;return e.sort((function(t,e){return n.compare(t.dynamicCstr,e.dynamicCstr)||e.precondition.priority-t.precondition.priority||e.precondition.constraints.length-t.precondition.constraints.length||e.precondition.rank-t.precondition.rank})),p.getInstance().generateOutput((()=>e.map((t=>t.name+"("+t.dynamicCstr.toString()+")"))).bind(this)),e[0]}}const yi=new Map;N.nodeEvaluator=Ai.getInstance().evaluateNode.bind(Ai.getInstance());const Ti={small:["default"],capital:["default"],digit:["default"]};function _i(t){const e=N.getInstance().locale;N.getInstance().locale=t,Le(),ln({locale:t}),function(){const t=W.ALPHABETS,e=(t,e)=>{const n={};return Object.keys(t).forEach((t=>n[t]=!0)),Object.keys(e).forEach((t=>n[t]=!0)),Object.keys(n)};Ti.small=e(t.smallPrefix,t.letterTrans),Ti.capital=e(t.capPrefix,t.letterTrans),Ti.digit=e(t.digitPrefix,t.digitTrans)}();for(const t of He.values()){const e=t.unicode;if("offset"in t)Oi(e,t.font,t.offset||0);else{Ci(e,W.ALPHABETS[t.base],t.font,!!t.capital)}}N.getInstance().locale=e,Le()}function Ii(t){return function(t){return"string"==typeof t?{font:t,combiner:W.ALPHABETS.combiner}:{font:t[0],combiner:W.COMBINERS[t[1]]||V[t[1]]||W.ALPHABETS.combiner}}("normal"===t||"fullwidth"===t?"":W.MESSAGES.font[t]||W.MESSAGES.embellish[t]||"")}function Ci(t,e,n,r){const s=Ii(n);for(let n,o,i=0;n=t[i],o=e[i];i++){const t=r?W.ALPHABETS.capPrefix:W.ALPHABETS.smallPrefix,e=r?Ti.capital:Ti.small;xi(s.combiner,n,o,s.font,t,W.ALPHABETS.letterTrans,e)}}function Oi(t,e,n){const r=Ii(e);for(let e,s=0;e=t[s];s++){const t=W.ALPHABETS.digitPrefix,o=s+n;xi(r.combiner,e,o,r.font,t,W.ALPHABETS.digitTrans,Ti.digit)}}function xi(t,e,n,r,s,o,i){for(let c,a=0;c=i[a];a++){const i=c in o?o[c]:o.default,a=c in s?s[c]:s.default;Nn(c,"default",e,t(i(n),r,a))}}var Li=function(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{a(r.next(t))}catch(t){o(t)}}function c(t){try{a(r.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,c)}a((r=r.apply(t,e||[])).next())}))};const Mi={functions:function(t){for(const n of t)ln(n)||(e=n.key,en(n.names||[],Ze.Meaning.get(e)||{type:"function",role:"prefix function"}),"base"!==cn?(mn(n),En(n)):pn.set(n.key,n));var e},symbols:function(t){for(const e of t){if(ln(e))continue;const t=on.parseUnicode(e.key);"base"!==cn?gn(t,t,e.mappings):pn.set(t,e)}},units:function(t){for(const e of t)ln(e)||(e.key+=":unit","base"!==cn?(mn(e),e.names&&(e.names=e.names.map((function(t){return t+":unit"}))),e.si&&bn(e),En(e)):pn.set(e.key,e))},si:t=>t.forEach(hn),messages:function(t){const e=xe[t.locale];if(!e)return void console.error("Locale "+t.locale+" does not exist!");const n=t.kind.toUpperCase(),r=t.messages;if(!r)return;const s=e();for(const[t,e]of Object.entries(r))s[n][t]=e},rules:Ai.addStore,characters:t=>t.forEach(Sn)};let Ri=!1;function vi(t=N.getInstance().locale){return Li(this,void 0,void 0,(function*(){return Ri||(!function(){for(const t of He.values()){const e=t.unicode;for(const n of e)pn.set(n,{key:n,category:t.category})}}(),Fi(o.BASE_LOCALE),Ri=!0),S.promises[o.BASE_LOCALE].then((()=>Li(this,void 0,void 0,(function*(){const e=N.getInstance().defaultLocale;return e?(Fi(e),S.promises[e].then((()=>Li(this,void 0,void 0,(function*(){return Fi(t),S.promises[t]}))))):(Fi(t),S.promises[t])}))))}))}function Fi(n=N.getInstance().locale){S.loaded[n]||(S.loaded[n]=[!1,!1],cn=o.DEFAULT_VALUES[t.LOCALE],an=o.DEFAULT_VALUES[t.MODALITY],function(t){if(N.getInstance().isIE&&N.getInstance().mode===e.HTTP)return void Pi(t);!function(t){const e=function(){if(N.getInstance().customLoader)return N.getInstance().customLoader;return wi()}(),n=new Promise((n=>{e(t).then((e=>{var r;r=e,Di(JSON.parse(r)),S.loaded[t]=[!0,!0],n(t)}),(e=>{S.loaded[t]=[!0,!1],console.error(`Unable to load locale: ${t}`),N.getInstance().locale=N.getInstance().defaultLocale,n(t)}))}));S.promises[t]=n}(t)}(n))}function wi(){switch(N.getInstance().mode){case e.ASYNC:return ki;case e.HTTP:return Bi;case e.SYNC:default:return Ui}}function Di(t,e){let n=!0;for(let r,s=0;r=Object.keys(t)[s];s++){const s=r.split("/");e&&e!==s[0]||(n&&"symbols"===s[1]&&"base"!==s[0]&&(_i(s[0]),n=!1),Mi[s[1]](t[r]))}}function Pi(t,e){let n=e||1;Re?Di(Re,t):n<=5&&setTimeout((()=>Pi(t,n++)).bind(this),300)}function ki(t){const e=Pe(t);return new Promise(((t,n)=>{d.Z.fs.readFile(e,"utf8",((e,r)=>{if(e)return n(e);t(r)}))}))}function Ui(t){const e=Pe(t);return new Promise(((t,n)=>{let r="{}";try{r=d.Z.fs.readFileSync(e,"utf8")}catch(t){return n(t)}t(r)}))}function Bi(t){const e=Pe(t),n=new XMLHttpRequest;return new Promise(((t,r)=>{n.onreadystatechange=function(){if(4===n.readyState){const e=n.status;0===e||e>=200&&e<400?t(n.responseText):r(e)}},n.open("GET",e,!0),n.send()}))}var ji,$i=function(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{a(r.next(t))}catch(t){o(t)}}function c(t){try{a(r.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,c)}a((r=r.apply(t,e||[])).next())}))};function Gi(t){return $i(this,void 0,void 0,(function*(){const e=N.getInstance();"default"!==t.domain||"speech"!==t.modality&&t.modality&&"speech"!==e.modality||(t.domain="mathspeak");const n=n=>{void 0!==t[n]&&(e[n]=t[n])};return n("mode"),e.configurate(t),N.BINARY_FEATURES.forEach((n=>{void 0!==t[n]&&(e[n]=!!t[n])})),N.STRING_FEATURES.forEach(n),t.debug&&p.getInstance().init(),t.json&&(d.Z.jsonPath=De(t.json)),t.xpath&&(d.Z.WGXpath=t.xpath),e.setCustomLoader(t.custom),function(t){t.isIE=Me(),t.isEdge="undefined"!=typeof window&&"MSGestureEvent"in window&&null===(null===(e=window.chrome)||void 0===e?void 0:e.loadTimes)&&(document.evaluate=null,ve(!0),!0);var e}(e),Le(),e.setDynamicCstr(),e.init?(S.promises.init=new Promise(((t,e)=>{setTimeout((()=>{t("init")}),10)})),e.init=!1,S.get()):e.delay?(e.delay=!1,S.get()):vi()}))}!function(t){t[t.ENTER=13]="ENTER",t[t.ESC=27]="ESC",t[t.SPACE=32]="SPACE",t[t.PAGE_UP=33]="PAGE_UP",t[t.PAGE_DOWN=34]="PAGE_DOWN",t[t.END=35]="END",t[t.HOME=36]="HOME",t[t.LEFT=37]="LEFT",t[t.UP=38]="UP",t[t.RIGHT=39]="RIGHT",t[t.DOWN=40]="DOWN",t[t.TAB=9]="TAB",t[t.LESS=188]="LESS",t[t.GREATER=190]="GREATER",t[t.DASH=189]="DASH",t[t.ZERO=48]="ZERO",t[t.ONE=49]="ONE",t[t.TWO=50]="TWO",t[t.THREE=51]="THREE",t[t.FOUR=52]="FOUR",t[t.FIVE=53]="FIVE",t[t.SIX=54]="SIX",t[t.SEVEN=55]="SEVEN",t[t.EIGHT=56]="EIGHT",t[t.NINE=57]="NINE",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=90]="Z"}(ji||(ji={}));const Vi=new Map([[13,"ENTER"],[27,"ESC"],[32,"SPACE"],[33,"PAGE_UP"],[34,"PAGE_DOWN"],[35,"END"],[36,"HOME"],[37,"LEFT"],[38,"UP"],[39,"RIGHT"],[40,"DOWN"],[9,"TAB"],[188,"LESS"],[190,"GREATER"],[189,"DASH"],[48,"ZERO"],[49,"ONE"],[50,"TWO"],[51,"THREE"],[52,"FOUR"],[53,"FIVE"],[54,"SIX"],[55,"SEVEN"],[56,"EIGHT"],[57,"NINE"],[65,"A"],[66,"B"],[67,"C"],[68,"D"],[69,"E"],[70,"F"],[71,"G"],[72,"H"],[73,"I"],[74,"J"],[75,"K"],[76,"L"],[77,"M"],[78,"N"],[79,"O"],[80,"P"],[81,"Q"],[82,"R"],[83,"S"],[84,"T"],[85,"U"],[86,"V"],[87,"W"],[88,"X"],[89,"Y"],[90,"Z"]]);var Hi;!function(t){t.CLICK="click",t.DBLCLICK="dblclick",t.MOUSEDOWN="mousedown",t.MOUSEUP="mouseup",t.MOUSEOVER="mouseover",t.MOUSEOUT="mouseout",t.MOUSEMOVE="mousemove",t.SELECTSTART="selectstart",t.KEYPRESS="keypress",t.KEYDOWN="keydown",t.KEYUP="keyup",t.TOUCHSTART="touchstart",t.TOUCHMOVE="touchmove",t.TOUCHEND="touchend",t.TOUCHCANCEL="touchcancel"}(Hi||(Hi={}));function Yi(t,e,n){return(n||function(n,r){return"number"==typeof n&&"number"==typeof r?n+r:"number"==typeof n?r:"number"==typeof r?n:[t,e].sort()[0]}).call(null,t,e)}function qi(t,e){delete t.open,e.close.forEach((e=>delete t[e])),e.open.forEach((n=>t[n]=e[n]));const n=Object.keys(t);t.open=n}function Wi(t,e){if(t.length<=1)return t;const n=[];for(let r,s=0;r=e[s],t.length;s++)r.close&&r.close.length&&r.close.forEach((function(e){const r=t.indexOf(e);-1!==r&&(n.unshift(e),t.splice(r,1))}));return n}let Xi={},Ki=[];function zi(t){Xi={},Ki=[];let e=[];const r={};for(let s,o=0;s=t[o];o++){let t=null;const o=s.descriptionSpan(),i=s.personality,c=i[n.JOIN];delete i[n.JOIN],void 0!==i[n.PAUSE]&&(t={[n.PAUSE]:i[n.PAUSE]},delete i[n.PAUSE]);nc(e,o,rc(i,r),c,t,!0)}return e=e.concat(function(){const t=[];for(let e=Ki.length-1;e>=0;e--){const n=Ki[e];if(n.length){const e={open:[],close:[]};for(let t=0;t<n.length;t++){const r=n[t];e.close.push(r),e[r]=0}t.push(e)}}return t}()),e=function(t){const e={},n=[];for(let r,s=0;r=t[s];s++){if(!Qi(r)){Zi(n,r);continue}if(!r.close||1!==r.close.length||r.open.length){Ji(r,e),n.push(r);continue}let o=t[s+1];if(!o||ec(o)){Ji(r,e),n.push(r);continue}const i=tc(o)?o:null;i&&(o=t[s+2]),o&&Qi(o)&&o.open[0]===r.close[0]&&!o.close.length&&o[o.open[0]]===e[o.open[0]]?i?(Zi(n,i),s+=2):s+=1:(Ji(r,e),n.push(r))}return n}(e),e=N.getInstance().cleanpause?function(t){for(;tc(t[0]);)t.shift();for(;tc(t[t.length-1]);)t.pop();return t}(e):e,e}function Zi(t,e){const n=t[t.length-1];if(n){if(ec(e)&&ec(n)){if(void 0===n.join)return void(n.span=n.span.concat(e.span));const t=n.span.pop(),r=e.span.shift();return n.span.push(t+n.join+r),n.span=n.span.concat(e.span),void(n.join=e.join)}tc(e)&&tc(n)?n.pause=Yi(n.pause,e.pause):t.push(e)}else t.push(e)}function Ji(t,e){t.rate&&(e.rate=t.rate),t.pitch&&(e.pitch=t.pitch),t.volume&&(e.volume=t.volume)}function Qi(t){return"object"==typeof t&&t.open}function tc(t){return"object"==typeof t&&1===Object.keys(t).length&&Object.keys(t)[0]===n.PAUSE}function ec(t){const e=Object.keys(t);return"object"==typeof t&&(1===e.length&&"span"===e[0]||2===e.length&&("span"===e[0]&&"join"===e[1]||"span"===e[1]&&"join"===e[0]))}function nc(t,e,r,s,o,i=!1){if(i){const i=t[t.length-1];let c;if(i&&(c=i[n.JOIN]),i&&!e.speech&&o&&tc(i)){const t=n.PAUSE;i[t]=Yi(i[t],o[t]),o=null}if(i&&e.speech&&0===Object.keys(r).length&&ec(i)){if(void 0!==c){const t=i.span.pop();e=Tn.stringAttr(t.speech+c+e.speech,t.attributes)}i.span.push(e),e=Tn.empty(),i[n.JOIN]=s}}0!==Object.keys(r).length&&t.push(r),e.speech&&t.push({span:[e],join:s}),o&&t.push(o)}function rc(t,e){if(!e)return t;const n={};for(const r of a){const s=t[r],o=e[r];if(!s&&!o||s&&o&&s===o)continue;const i=s||0;Qi(n)||(n.open=[],n.close=[]),s||n.close.push(r),o||n.open.push(r),o&&s&&(n.close.push(r),n.open.push(r)),e[r]=i,n[r]=i,Xi[r]?Xi[r].push(i):Xi[r]=[i]}if(Qi(n)){let t=n.close.slice();for(;t.length>0;){let r=Ki.pop();const s=rr(r,t);if(t=rr(t,r),r=s,0!==t.length){if(0!==r.length){n.close=n.close.concat(r),n.open=n.open.concat(r);for(let t,s=0;t=r[s];s++)n[t]=e[t]}}else 0!==r.length&&Ki.push(r)}Ki.push(n.open)}return n}class sc{constructor(){this.separator_=" "}set separator(t){this.separator_=t}get separator(){return"braille"===N.getInstance().modality?"":this.separator_}error(t){return null}merge(t){let e="";const n=t.length-1;for(let r,s=0;r=t[s];s++)if(e+=r.speech,s<n){const t=r.attributes.separator;e+=void 0!==t?t:this.separator}return e}finalize(t){return t}pauseValue(t){let e;switch(t){case"long":e=750;break;case"medium":e=500;break;case"short":e=250;break;default:e=parseInt(t,10)}return Math.floor(e*N.getInstance().getRate()/100)}}class oc extends sc{constructor(){super(...arguments),this.ignoreElements=[n.LAYOUT],this.scaleFunction=null}setScaleFunction(t,e,n,r,s=0){this.scaleFunction=o=>{const i=(o-t)/(e-t),c=n*(1-i)+r*i;return+(Math.round(c+"e+"+s)+"e-"+s)}}applyScaleFunction(t){return this.scaleFunction?this.scaleFunction(t):t}ignoreElement(t){return-1!==this.ignoreElements.indexOf(t)}}class ic extends oc{markup(t){this.setScaleFunction(-2,2,-100,100,2);const e=zi(t),n=[],r=[];for(let t,s=0;t=e[s];s++)if(t.span)n.push(this.merge(t.span));else if(tc(t))n.push(this.pause(t));else{if(t.close.length)for(let e=0;e<t.close.length;e++){const e=r.pop();if(-1===t.close.indexOf(e))throw new m("Unknown closing markup element: "+e);n.push(this.closeTag(e))}if(t.open.length){Wi(t.open.slice(),e.slice(s+1)).forEach((e=>{n.push(this.prosodyElement(e,t[e])),r.push(e)}))}}return n.join(" ")}}let cc="";const ac={TABLE:function(t){let e=mc(t);e.forEach((t=>{t.cells=t.cells.slice(1).slice(0,-1),t.width=t.width.slice(1).slice(0,-1)}));const[n,r]=gc(e);return e=Nc(e,r),Sc(e,n)},CASES:function(t){let e=mc(t);e.forEach((t=>{t.cells=t.cells.slice(0,-1),t.width=t.width.slice(0,-1)}));const[n,r]=gc(e);return e=Nc(e,r),Sc(e,n)},CAYLEY:function(t){let e=mc(t);e.forEach((t=>{t.cells=t.cells.slice(1).slice(0,-1),t.width=t.width.slice(1).slice(0,-1),t.sep=t.sep+t.sep}));const[n,r]=gc(e),s={lfence:"",rfence:"",cells:r.map((t=>"\u2810"+new Array(t).join("\u2812"))),width:r,height:1,sep:e[0].sep};return e.splice(1,0,s),e=Nc(e,r),Sc(e,n)},MATRIX:function(t){let e=mc(t);const[n,r]=gc(e);return e=Nc(e,r),Sc(e,n)},CELL:hc,FENCE:hc,ROW:hc,FRACTION:function(t){const[e,n,,r,s]=Array.from(t.childNodes),o=lc(n),i=lc(r),c=pc(o),a=pc(i);let l=Math.max(c,a);const u=e+new Array(l+1).join("\u2812")+s;return l=u.length,`${yc(o,l)}\n${u}\n${yc(i,l)}`},NUMERATOR:Tc,DENOMINATOR:Tc};function lc(t){const e=k(t),n=ac[e];return n?n(t):t.textContent}function uc(t,e){if(!t||!e)return t+e;const n=dc(t),r=dc(e),s=n-r;t=s<0?fc(t,r,pc(t)):t,e=s>0?fc(e,n,pc(e)):e;const o=t.split(/\r\n|\r|\n/),i=e.split(/\r\n|\r|\n/),c=[];for(let t=0;t<o.length;t++)c.push(o[t]+i[t]);return c.join("\n")}function hc(t){let e="";for(const n of Array.from(t.childNodes))e=n.nodeType!==L.TEXT_NODE?uc(e,lc(n)):uc(e,n.textContent);return e}function dc(t){return t.split(/\r\n|\r|\n/).length}function pc(t){return t.split(/\r\n|\r|\n/).reduce(((t,e)=>Math.max(e.length,t)),0)}function fc(t,e,n){return t=function(t,e){const n=e-dc(t);return t+(n>0?new Array(n+1).join("\n"):"")}(t,e),function(t,e){const n=t.split(/\r\n|\r|\n/),r=[];for(const t of n){const n=e-t.length;r.push(t+(n>0?new Array(n+1).join("\u2800"):""))}return r.join("\n")}(t,n)}function mc(t){const e=Array.from(t.childNodes),n=[];for(const t of e)t.nodeType===L.ELEMENT_NODE&&n.push(Ac(t));return n}function gc(t){const e=t.reduce(((t,e)=>Math.max(e.height,t)),0),n=[];for(let e=0;e<t[0].width.length;e++)n.push(t.map((t=>t.width[e])).reduce(((t,e)=>Math.max(t,e)),0));return[e,n]}function Nc(t,e){const n=[];for(const r of t){if(0===r.height)continue;const t=[];for(let n=0;n<r.cells.length;n++)t.push(fc(r.cells[n],r.height,e[n]));r.cells=t,n.push(r)}return n}function Sc(t,e){if(1===e)return t.map((t=>t.lfence+t.cells.join(t.sep)+t.rfence)).join("\n");const n=[];for(const e of t){const t=Ec(e.sep,e.height);let r=e.cells.shift();for(;e.cells.length;)r=uc(r,t),r=uc(r,e.cells.shift());r=uc(Ec(e.lfence,e.height),r),r=uc(r,Ec(e.rfence,e.height)),n.push(r),n.push(e.lfence+new Array(pc(r)-3).join(e.sep)+e.rfence)}return n.slice(0,-1).join("\n")}function Ec(t,e){let n="";for(;e;)n+=t+"\n",e--;return n.slice(0,-1)}function bc(t){return t.nodeType===L.ELEMENT_NODE&&"FENCE"===k(t)?lc(t):""}function Ac(t){const e=Array.from(t.childNodes),n=bc(e[0]),r=bc(e[e.length-1]);n&&e.shift(),r&&e.pop();let s="";const o=[];for(const t of e){if(t.nodeType===L.TEXT_NODE){s=t.textContent;continue}const e=lc(t);o.push(e)}return{lfence:n,rfence:r,sep:s,cells:o,height:o.reduce(((t,e)=>Math.max(dc(e),t)),0),width:o.map(pc)}}function yc(t,e){const n=(e-pc(t))/2,[r,s]=Math.floor(n)===n?[n,n]:[Math.floor(n),Math.ceil(n)],o=t.split(/\r\n|\r|\n/),i=[],[c,a]=[new Array(r+1).join("\u2800"),new Array(s+1).join("\u2800")];for(const t of o)i.push(c+t+a);return i.join("\n")}function Tc(t){const e=t.firstChild,n=hc(t);if(e&&e.nodeType===L.ELEMENT_NODE){if("ENGLISH"===k(e))return"\u2830"+n;if("NUMBER"===k(e))return"\u283c"+n}return n}class _c extends sc{markup(t){const e=zi(t);let r="",s=null,o=!1;for(let t,i=0;t=e[i];i++)Qi(t)||(tc(t)?s=t:(s&&(r+=this.pause(s[n.PAUSE]),s=null),r+=(o?this.separator:"")+this.merge(t.span),o=!0));return r}pause(t){let e;return e="number"==typeof t?t<=250?"short":t<=500?"medium":"long":t,_c.PAUSE_PUNCTUATION.get(e)||""}}_c.PAUSE_PUNCTUATION=new Map([["short",","],["medium",";"],["long","."]]);class Ic extends ic{finalize(t){return`<?xml version="1.0"?><speak version="1.1" xmlns="http://www.w3.org/2001/10/synthesis" xml:lang="${N.getInstance().locale}"><prosody rate="`+N.getInstance().getRate()+'%">'+this.separator+t+this.separator+"</prosody></speak>"}pause(t){return'<break time="'+this.pauseValue(t[n.PAUSE])+'ms"/>'}prosodyElement(t,e){const r=(e=Math.floor(this.applyScaleFunction(e)))<0?e.toString():"+"+e.toString();return"<prosody "+t.toLowerCase()+'="'+r+(t===n.VOLUME?">":'%">')}closeTag(t){return"</prosody>"}markup(t){return Ic.MARKS={},super.markup(t)}merge(t){const e=[];let n="";for(let r=0;r<t.length;r++){const s=t[r];if(this.isEmptySpan(s))continue;const o=Ic.MARK_KIND?s.attributes.kind:"",i=N.getInstance().automark?s.attributes.id:N.getInstance().mark?s.attributes.extid:"";!i||i===n||Ic.MARK_ONCE&&Ic.MARKS[i]||(e.push(o?`<mark name="${i}" kind="${o}"/>`:`<mark name="${i}"/>`),n=i,Ic.MARKS[i]=!0),N.getInstance().character&&1===s.speech.length&&s.speech.match(/[a-zA-Z]/)?e.push('<say-as interpret-as="'+Ic.CHARACTER_ATTR+'">'+s.speech+"</say-as>"):e.push(s.speech)}return e.join(this.separator)}isEmptySpan(t){const e=t.attributes.separator;return t.speech.match(/^\s*$/)&&(!e||e.match(/^\s*$/))}}Ic.MARK_ONCE=!1,Ic.MARK_KIND=!0,Ic.CHARACTER_ATTR="character",Ic.MARKS={};const Cc=new Ic,Oc=new Map([[u.NONE,new class extends sc{markup(t){let e="";const n=zi(t).filter((t=>t.span));if(!n.length)return e;const r=n.length-1;for(let t,s=0;t=n[s];s++){if(t.span&&(e+=this.merge(t.span)),s>=r)continue;const n=t.join;e+=void 0===n?this.separator:n}return e}}],[u.PUNCTUATION,new _c],[u.LAYOUT,new class extends ic{finalize(t){return function(t){cc="";const e=x(`<all>${t}</all>`);return p.getInstance().output(F(e.toString())),cc=hc(e),cc}(t)}pause(t){return""}prosodyElement(t,e){return t===n.LAYOUT?`<${e}>`:""}closeTag(t){return`</${t}>`}markup(t){const e=[];let n=[];for(const r of t){if(!r.layout){n.push(r);continue}e.push(this.processContent(n)),n=[];const t=r.layout;t.match(/^begin/)?e.push("<"+t.replace(/^begin/,"")+">"):t.match(/^end/)?e.push("</"+t.replace(/^end/,"")+">"):console.warn("Something went wrong with layout markup: "+t)}return e.push(this.processContent(n)),e.join("")}processContent(t){const e=[],n=zi(t);for(let t,r=0;t=n[r];r++)t.span?e.push(this.merge(t.span)):tc(t);return e.join("")}}],[u.ACSS,new class extends oc{markup(t){this.setScaleFunction(-2,2,0,10,0);const e=zi(t),n=[],r={open:[]};let s=null,o=!1;for(let t,l=0;t=e[l];l++){if(Qi(t)){qi(r,t);continue}if(tc(t)){o&&(i=s,c=t,a=Math.max,s=i?{pause:Yi(i.pause,c.pause,a)}:c);continue}const e='"'+this.merge(t.span)+'"';o=!0,s&&(n.push(this.pause(s)),s=null);const l=this.prosody_(r);n.push(l?"(text ("+l+") "+e+")":e)}var i,c,a;return"(exp "+n.join(" ")+")"}error(t){return'(error "'+Vi.get(t)+'")'}prosodyElement(t,e){switch(e=this.applyScaleFunction(e),t){case n.RATE:return"(richness . "+e+")";case n.PITCH:return"(average-pitch . "+e+")";case n.VOLUME:return"(stress . "+e+")"}return"(value . "+e+")"}pause(t){return"(pause . "+this.pauseValue(t[n.PAUSE])+")"}prosody_(t){const e=t.open,n=[];for(let r,s=0;r=e[s];s++)n.push(this.prosodyElement(r,t[r]));return n.join(" ")}}],[u.SABLE,new class extends ic{finalize(t){return'<?xml version="1.0"?><!DOCTYPE SABLE PUBLIC "-//SABLE//DTD SABLE speech mark up//EN" "Sable.v0_2.dtd" []><SABLE>'+this.separator+t+this.separator+"</SABLE>"}pause(t){return'<BREAK MSEC="'+this.pauseValue(t[n.PAUSE])+'"/>'}prosodyElement(t,e){switch(e=this.applyScaleFunction(e),t){case n.PITCH:return'<PITCH RANGE="'+e+'%">';case n.RATE:return'<RATE SPEED="'+e+'%">';case n.VOLUME:return'<VOLUME LEVEL="'+e+'%">';default:return"<"+t.toUpperCase()+' VALUE="'+e+'">'}}closeTag(t){return"</"+t.toUpperCase()+">"}}],[u.VOICEXML,Cc],[u.SSML,Cc]]);function xc(t){const e=Oc.get(N.getInstance().markup);return e?e.markup(t):""}function Lc(t){const e=Oc.get(N.getInstance().markup);return e?e.finalize(t):t}class Mc{constructor(t){this.type=t,this.factory_=new wr}getFactory(){return this.factory_}setFactory(t){this.factory_=t}getType(){return this.type}parseList(t){const e=[];for(let n,r=0;n=t[r];r++)e.push(this.parse(n));return e}}class Rc extends Mc{static getAttribute_(t,e,n){if(!t.hasAttribute(e))return n;const r=t.getAttribute(e);return r.match(/^\s*$/)?null:r}constructor(){super("MathML"),this.parseMap_={SEMANTICS:this.semantics_.bind(this),MATH:this.rows_.bind(this),MROW:this.rows_.bind(this),MPADDED:this.rows_.bind(this),MSTYLE:this.rows_.bind(this),MFRAC:this.fraction_.bind(this),MSUB:this.limits_.bind(this),MSUP:this.limits_.bind(this),MSUBSUP:this.limits_.bind(this),MOVER:this.limits_.bind(this),MUNDER:this.limits_.bind(this),MUNDEROVER:this.limits_.bind(this),MROOT:this.root_.bind(this),MSQRT:this.sqrt_.bind(this),MTABLE:this.table_.bind(this),MLABELEDTR:this.tableLabeledRow_.bind(this),MTR:this.tableRow_.bind(this),MTD:this.tableCell_.bind(this),MS:this.text_.bind(this),MTEXT:this.text_.bind(this),MSPACE:this.space_.bind(this),"ANNOTATION-XML":this.text_.bind(this),MI:this.identifier_.bind(this),MN:this.number_.bind(this),MO:this.operator_.bind(this),MFENCED:this.fenced_.bind(this),MENCLOSE:this.enclosed_.bind(this),MMULTISCRIPTS:this.multiscripts_.bind(this),ANNOTATION:this.empty_.bind(this),NONE:this.empty_.bind(this),MACTION:this.action_.bind(this)};const t={type:"identifier",role:"numbersetletter",font:We.DOUBLESTRUCK};["C","H","N","P","Q","R","Z","\u2102","\u210d","\u2115","\u2119","\u211a","\u211d","\u2124"].forEach((e=>this.getFactory().defaultMap.set(e,t)).bind(this))}parse(t){Ss.getInstance().setNodeFactory(this.getFactory());const e=O(t.childNodes),n=k(t),r=this.parseMap_[n],s=(r||this.dummy_.bind(this))(t,e);return Lr(s,t),-1!==["MATH","MROW","MPADDED","MSTYLE","SEMANTICS","MACTION"].indexOf(n)||(s.mathml.unshift(t),s.mathmlTree=t),s}semantics_(t,e){return e.length?this.parse(e[0]):this.getFactory().makeEmptyNode()}rows_(t,e){const n=t.getAttribute("semantics");if(n&&n.match("bspr_"))return Ss.proof(t,n,this.parseList.bind(this));let r;return 1===(e=xr(e)).length?(r=this.parse(e[0]),"empty"!==r.type||r.mathmlTree||(r.mathmlTree=t)):r=Ss.getInstance().row(this.parseList(e)),r.mathml.unshift(t),r}fraction_(t,e){if(!e.length)return this.getFactory().makeEmptyNode();const n=this.parse(e[0]),r=e[1]?this.parse(e[1]):this.getFactory().makeEmptyNode();return Ss.getInstance().fractionLikeNode(n,r,t.getAttribute("linethickness"),"true"===t.getAttribute("bevelled"))}limits_(t,e){return Ss.getInstance().limitNode(k(t),this.parseList(e))}root_(t,e){return e[1]?this.getFactory().makeBranchNode("root",[this.parse(e[1]),this.parse(e[0])],[]):this.sqrt_(t,e)}sqrt_(t,e){const n=this.parseList(xr(e));return this.getFactory().makeBranchNode("sqrt",[Ss.getInstance().row(n)],[])}table_(t,e){const n=t.getAttribute("semantics");if(n&&n.match("bspr_"))return Ss.proof(t,n,this.parseList.bind(this));const r=this.getFactory().makeBranchNode("table",this.parseList(e),[]);return r.mathmlTree=t,Ss.tableToMultiline(r)}tableRow_(t,e){const n=this.getFactory().makeBranchNode("row",this.parseList(e),[]);return n.role="table",n}tableLabeledRow_(t,e){if(!e.length)return this.tableRow_(t,e);const n=this.parse(e[0]);n.role="label";const r=this.getFactory().makeBranchNode("row",this.parseList(e.slice(1)),[n]);return r.role="table",r}tableCell_(t,e){const n=this.parseList(xr(e));let r;r=n.length?1===n.length&&Dr(n[0],"empty")?n:[Ss.getInstance().row(n)]:[];const s=this.getFactory().makeBranchNode("cell",r,[]);return s.role="table",s}space_(t,e){const n=t.getAttribute("width"),r=n&&n.match(/[a-z]*$/);if(!r)return this.empty_(t,e);const s=r[0],o=parseFloat(n.slice(0,r.index)),i={cm:.4,pc:.5,em:.5,ex:1,in:.15,pt:5,mm:5}[s];if(!i||isNaN(o)||o<i)return this.empty_(t,e);const c=this.getFactory().makeUnprocessed(t);return Ss.getInstance().text(c,k(t))}text_(t,e){const n=this.leaf_(t,e);return t.textContent?(n.updateContent(t.textContent,!0),Ss.getInstance().text(n,k(t))):n}identifier_(t,e){const n=this.leaf_(t,e);return Ss.getInstance().identifierNode(n,Ss.getInstance().font(t.getAttribute("mathvariant")),t.getAttribute("class"))}number_(t,e){const n=this.leaf_(t,e);return Ss.number(n),n}operator_(t,e){const n=this.leaf_(t,e);return Ss.getInstance().operatorNode(n),n}fenced_(t,e){const n=this.parseList(xr(e)),r=Rc.getAttribute_(t,"separators",","),s=Rc.getAttribute_(t,"open","("),o=Rc.getAttribute_(t,"close",")"),i=Ss.getInstance().mfenced(s,o,r,n);return Ss.getInstance().tablesInRow([i])[0]}enclosed_(t,e){const n=this.parseList(xr(e)),r=this.getFactory().makeBranchNode("enclose",[Ss.getInstance().row(n)],[]);return r.role=t.getAttribute("notation")||"unknown",r}multiscripts_(t,e){if(!e.length)return this.getFactory().makeEmptyNode();const n=this.parse(e.shift());if(!e.length)return n;const r=[],s=[],o=[],i=[];let c=!1,a=0;for(let t,n=0;t=e[n];n++)"MPRESCRIPTS"!==k(t)?(c?1&a?r.push(t):s.push(t):1&a?o.push(t):i.push(t),a++):(c=!0,a=0);return xr(r).length||xr(s).length?Ss.getInstance().tensor(n,this.parseList(s),this.parseList(r),this.parseList(i),this.parseList(o)):Ss.getInstance().pseudoTensor(n,this.parseList(i),this.parseList(o))}empty_(t,e){return this.getFactory().makeEmptyNode()}action_(t,e){const n=e[t.hasAttribute("selection")?parseInt(t.getAttribute("selection"),10)-1:0],r=this.parse(n);return r.mathmlTree=n,r}dummy_(t,e){const n=this.getFactory().makeUnprocessed(t);return n.role=t.tagName,n.textContent=t.textContent,n}leaf_(t,e){if(1===e.length&&e[0].nodeType!==L.TEXT_NODE){const n=this.getFactory().makeUnprocessed(t);return n.role=e[0].tagName,Lr(n,e[0]),n}return this.getFactory().makeLeafNode(t.textContent,Ss.getInstance().font(t.getAttribute("mathvariant")))}}class vc{constructor(t,e,n=(t=>!1)){this.name=t,this.apply=e,this.applicable=n}}class Fc extends vc{}class wc extends vc{}const Dc="data-semantic-";var Pc;!function(t){t.ADDED="data-semantic-added",t.ALTERNATIVE="data-semantic-alternative",t.CHILDREN="data-semantic-children",t.COLLAPSED="data-semantic-collapsed",t.CONTENT="data-semantic-content",t.EMBELLISHED="data-semantic-embellished",t.FENCEPOINTER="data-semantic-fencepointer",t.FONT="data-semantic-font",t.ID="data-semantic-id",t.ANNOTATION="data-semantic-annotation",t.ATTRIBUTES="data-semantic-attributes",t.OPERATOR="data-semantic-operator",t.OWNS="data-semantic-owns",t.PARENT="data-semantic-parent",t.POSTFIX="data-semantic-postfix",t.PREFIX="data-semantic-prefix",t.ROLE="data-semantic-role",t.SPEECH="data-semantic-speech",t.STRUCTURE="data-semantic-structure",t.TYPE="data-semantic-type"}(Pc||(Pc={}));const kc=[Pc.ADDED,Pc.ALTERNATIVE,Pc.CHILDREN,Pc.COLLAPSED,Pc.CONTENT,Pc.EMBELLISHED,Pc.FENCEPOINTER,Pc.FONT,Pc.ID,Pc.ANNOTATION,Pc.ATTRIBUTES,Pc.OPERATOR,Pc.OWNS,Pc.PARENT,Pc.POSTFIX,Pc.PREFIX,Pc.ROLE,Pc.SPEECH,Pc.STRUCTURE,Pc.TYPE];function Uc(t){return t.map((function(t){return t.id})).join(",")}function Bc(t,e){t.setAttribute(Pc.TYPE,e.type);const n=e.allAttributes();for(let e,r=0;e=n[r];r++)t.setAttribute(Dc+e[0].toLowerCase(),e[1]);e.childNodes.length&&t.setAttribute(Pc.CHILDREN,Uc(e.childNodes)),e.contentNodes.length&&t.setAttribute(Pc.CONTENT,Uc(e.contentNodes)),e.parent&&t.setAttribute(Pc.PARENT,e.parent.id.toString());const r=e.attributesXml();r&&t.setAttribute(Pc.ATTRIBUTES,r),function(t,e){const n=[];"mglyph"===e.role&&n.push("image");e.attributes.href&&n.push("link");n.length&&t.setAttribute(Pc.POSTFIX,n.join(" "))}(t,e)}function jc(t){return Dc+t}class $c{static fromTree(t){return $c.fromNode(t.root)}static fromNode(t){return new $c($c.fromNode_(t))}static fromString(t){return new $c($c.fromString_(t))}static simpleCollapseStructure(t){return"number"==typeof t}static contentCollapseStructure(t){return!!t&&!$c.simpleCollapseStructure(t)&&"c"===t[0]}static interleaveIds(t,e){return nr($c.collapsedLeafs(t),$c.collapsedLeafs(e))}static collapsedLeafs(...t){return t.reduce(((t,e)=>{return t.concat((n=e,$c.simpleCollapseStructure(n)?[n]:$c.contentCollapseStructure(n[1])?n.slice(2):n.slice(1)));var n}),[])}static fromStructure(t,e){return new $c($c.tree_(t,e.root))}static combineContentChildren(t,e,n){switch(t.type){case"relseq":case"infixop":case"multirel":return nr(n,e);case"prefixop":return e.concat(n);case"postfixop":return n.concat(e);case"fenced":return n.unshift(e[0]),n.push(e[1]),n;case"appl":return[n[0],e[0],n[1]];case"root":return[n[1],n[0]];case"row":case"line":return e.length&&n.unshift(e[0]),n;default:return n}}static makeSexp_(t){return $c.simpleCollapseStructure(t)?t.toString():$c.contentCollapseStructure(t)?"(c "+t.slice(1).map($c.makeSexp_).join(" ")+")":"("+t.map($c.makeSexp_).join(" ")+")"}static fromString_(t){let e=t.replace(/\(/g,"[");return e=e.replace(/\)/g,"]"),e=e.replace(/ /g,","),e=e.replace(/c/g,'"c"'),JSON.parse(e)}static fromNode_(t){if(!t)return[];const e=t.contentNodes;let n;e.length&&(n=e.map($c.fromNode_),n.unshift("c"));const r=t.childNodes;if(!r.length)return e.length?[t.id,n]:t.id;const s=r.map($c.fromNode_);return e.length&&s.unshift(n),s.unshift(t.id),s}static tree_(t,e,n=0,r=1,s=1){if(!e)return[];const o=e.id,i=[o],c=I(`.//self::*[@${Pc.ID}=${o}]`,t)[0];if(N.getInstance().aria&&c&&$c.addAria(c,n,r,s),!e.childNodes.length)return e.id;const a=$c.combineContentChildren(e,e.contentNodes.map((function(t){return t})),e.childNodes.map((function(t){return t})));c&&$c.addOwns_(c,a);for(let e,r=0,s=a.length;e=a[r];r++)i.push($c.tree_(t,e,n+1,r+1,s));return i}static addAria(t,e,n,r){e?(t.setAttribute("aria-level",e.toString()),t.setAttribute("aria-posinset",n.toString()),t.setAttribute("aria-setsize",r.toString()),t.setAttribute("role","treeitem")):t.setAttribute("role","tree")}static addOwns_(t,e){const n=t.getAttribute(Pc.COLLAPSED),r=n?$c.realLeafs_($c.fromString(n).array):e.map((t=>t.id));t.setAttribute(Pc.OWNS,r.join(" "))}static realLeafs_(t){if($c.simpleCollapseStructure(t))return[t];if($c.contentCollapseStructure(t))return[];let e=[];for(let n=1;n<t.length;n++)e=e.concat($c.realLeafs_(t[n]));return e}constructor(t){this.parents=null,this.levelsMap=null,t=0===t?t:t||[],this.array=t}populate(){this.parents&&this.levelsMap||(this.parents={},this.levelsMap={},this.populate_(this.array,this.array,[]))}toString(){return $c.makeSexp_(this.array)}populate_(t,e,n){if($c.simpleCollapseStructure(t))return this.levelsMap[t]=e,void(this.parents[t]=t===n[0]?n.slice(1):n);const r=$c.contentCollapseStructure(t)?t.slice(1):t,s=[r[0]].concat(n);for(let e=0,n=r.length;e<n;e++){const n=r[e];this.populate_(n,t,s)}}isRoot(t){return t===this.levelsMap[t][0]}directChildren(t){if(!this.isRoot(t))return[];return this.levelsMap[t].slice(1).map((t=>$c.simpleCollapseStructure(t)?t:$c.contentCollapseStructure(t)?t[1]:t[0]))}subtreeNodes(t){if(!this.isRoot(t))return[];const e=(t,n)=>{$c.simpleCollapseStructure(t)?n.push(t):($c.contentCollapseStructure(t)&&(t=t.slice(1)),t.forEach((t=>e(t,n))))},n=this.levelsMap[t],r=[];return e(n.slice(1),r),r}}function Gc(t,e,n){let r=null;if(!t.length)return r;const s=n[n.length-1],o=s&&s.length,i=e&&e.length,c=Ss.getInstance();if(o&&i){if("infixop"===e[0].type&&"implicit"===e[0].role)return r=t.pop(),s.push(c.postfixNode_(s.pop(),t)),r;r=t.shift();const n=c.prefixNode_(e.shift(),t);return e.unshift(n),r}return o?(s.push(c.postfixNode_(s.pop(),t)),r):(i&&e.unshift(c.prefixNode_(e.shift(),t)),r)}function Vc(t,e,n){if(!e.length)return t;const r=t.pop(),s=e.shift(),o=n.shift();if(ds(s)){p.getInstance().output("Juxta Heuristic Case 2");const i=(r?[r,s]:[s]).concat(o);return Vc(t.concat(i),e,n)}if(!r)return p.getInstance().output("Juxta Heuristic Case 3"),Vc([s].concat(o),e,n);const i=o.shift();if(!i){p.getInstance().output("Juxta Heuristic Case 9");const o=sr.makeBranchNode("infixop",[r,e.shift()],[s],s.textContent);return o.role="implicit",ur("combine_juxtaposition",o),e.unshift(o),Vc(t,e,n)}if(Yr(r)||Yr(i))return p.getInstance().output("Juxta Heuristic Case 4"),Vc(t.concat([r,s,i]).concat(o),e,n);let c=null;return ds(r)&&ds(i)?(p.getInstance().output("Juxta Heuristic Case 5"),r.contentNodes.push(s),r.contentNodes=r.contentNodes.concat(i.contentNodes),r.childNodes.push(i),r.childNodes=r.childNodes.concat(i.childNodes),i.childNodes.forEach((t=>t.parent=r)),s.parent=r,r.addMathmlNodes(s.mathml),r.addMathmlNodes(i.mathml),c=r):ds(r)?(p.getInstance().output("Juxta Heuristic Case 6"),r.contentNodes.push(s),r.childNodes.push(i),i.parent=r,s.parent=r,r.addMathmlNodes(s.mathml),r.addMathmlNodes(i.mathml),c=r):ds(i)?(p.getInstance().output("Juxta Heuristic Case 7"),i.contentNodes.unshift(s),i.childNodes.unshift(r),r.parent=i,s.parent=i,i.addMathmlNodes(s.mathml),i.addMathmlNodes(r.mathml),c=i):(p.getInstance().output("Juxta Heuristic Case 8"),c=sr.makeBranchNode("infixop",[r,i],[s],s.textContent),c.role="implicit"),t.push(c),Vc(t.concat(o),e,n)}function Hc(t){return t.childNodes[0]&&t.childNodes[0].childNodes[0]&&"MPADDED"===k(t.childNodes[0])&&"MPADDED"===k(t.childNodes[0].childNodes[0])&&"MPHANTOM"===k(t.childNodes[0].childNodes[t.childNodes[0].childNodes.length-1])}lr(new Fc("combine_juxtaposition",(function(t){for(let e,n=t.childNodes.length-1;e=t.childNodes[n];n--)ds(e)&&!e.nobreaking&&(t.childNodes.splice(n,1,...e.childNodes),t.contentNodes.splice(n,0,...e.contentNodes),e.childNodes.concat(e.contentNodes).forEach((function(e){e.parent=t})),t.addMathmlNodes(e.mathml));return t}))),lr(new Fc("propagateSimpleFunction",(t=>("infixop"!==t.type&&"fraction"!==t.type||!t.childNodes.every(ss)||(t.role="composed function"),t)),(t=>"clearspeak"===N.getInstance().domain))),lr(new Fc("simpleNamedFunction",(t=>("unit"!==t.role&&-1!==["f","g","h","F","G","H"].indexOf(t.textContent)&&(t.role="simple function"),t)),(t=>"clearspeak"===N.getInstance().domain))),lr(new Fc("propagateComposedFunction",(t=>("fenced"===t.type&&"composed function"===t.childNodes[0].role&&(t.role="composed function"),t)),(t=>"clearspeak"===N.getInstance().domain))),lr(new Fc("multioperator",(t=>{if("unknown"!==t.role||t.textContent.length<=1)return;const e=[...t.textContent].map((t=>Ze.Meaning.get(t))).reduce((function(t,e){return t&&e.role&&"unknown"!==e.role&&e.role!==t?"unknown"===t?e.role:null:t}),"unknown");e&&(t.role=e)}))),lr(new wc("convert_juxtaposition",(t=>{let e=vr(t,(function(t){return t.textContent===ze.invisibleTimes&&"operator"===t.type}));e=e.rel.length?function(t){const e=[],n=[];let r=t.comp.shift(),s=null,o=[];for(;t.comp.length;)if(o=[],r.length)s&&e.push(s),n.push(r),s=t.rel.shift(),r=t.comp.shift();else{for(s&&o.push(s);!r.length&&t.comp.length;)r=t.comp.shift(),o.push(t.rel.shift());s=Gc(o,r,n)}o.length||r.length?(e.push(s),n.push(r)):(o.push(s),Gc(o,r,n));return{rel:e,comp:n}}(e):e,t=e.comp[0];for(let n,r,s=1;n=e.comp[s],r=e.rel[s-1];s++)t.push(r),t=t.concat(n);return e=vr(t,(function(t){return t.textContent===ze.invisibleTimes&&("operator"===t.type||"infixop"===t.type)})),e.rel.length?Vc(e.comp.shift(),e.rel,e.comp):t}))),lr(new Fc("simple2prefix",(t=>(t.textContent.length>1&&!t.textContent[0].match(/[A-Z]/)&&(t.role="prefix function"),t)),(t=>"braille"===N.getInstance().modality&&"identifier"===t.type))),lr(new Fc("detect_cycle",(t=>{t.type="matrix",t.role="cycle";const e=t.childNodes[0];return e.type="row",e.role="cycle",e.textContent="",e.contentNodes=[],t}),(t=>"fenced"===t.type&&"infixop"===t.childNodes[0].type&&"implicit"===t.childNodes[0].role&&t.childNodes[0].childNodes.every((function(t){return"number"===t.type}))&&t.childNodes[0].contentNodes.every((function(t){return"space"===t.role}))))),lr(new wc("intvar_from_implicit",(function(t){const e=t[0].childNodes;t.splice(0,1,...e)}),(t=>t[0]&&hs(t[0])))),lr(new Fc("intvar_from_fraction",(function(t){const e=t.childNodes[1],n=e.childNodes[0];if(Gr(n))return void(n.role="integral");if(!hs(n))return;const r=n.childNodes.length,s=n.childNodes[r-2],o=n.childNodes[r-1];if(Gr(o))return void(o.role="integral");if($r(s,o)){const t=Ss.getInstance().prefixNode_(o,[s]);t.role="integral",2===r?e.childNodes[0]=t:(n.childNodes.pop(),n.contentNodes.pop(),n.childNodes[r-2]=t,t.parent=n)}}),(t=>{if("integral"!==t.type)return!1;const[,e,n]=t.childNodes;return"empty"===n.type&&"fraction"===e.type}))),lr(new Fc("rewrite_subcases",(function(t){t.addAnnotation("Emph","top");let e=[];if(t.hasAnnotation("Emph","left")){const n=qc(t.childNodes[0].childNodes[0].childNodes[0],!0);n.forEach((t=>t.addAnnotation("Emph","left"))),e=e.concat(n);for(let e,n=0;e=t.childNodes[n];n++)e.childNodes.shift()}if(e.push(t),t.hasAnnotation("Emph","right")){const n=qc(t.childNodes[0].childNodes[t.childNodes[0].childNodes.length-1].childNodes[0]);n.forEach((t=>t.addAnnotation("Emph","left"))),e=e.concat(n),t.childNodes[0].childNodes.pop()}Ss.tableToMultiline(t);const n=Ss.getInstance().row(e),r=t.annotation.Emph;return t.annotation.Emph=["table"],r.forEach((t=>n.addAnnotation("Emph",t))),n}),(t=>{let e=!0,n=!0;if(Hc(t.childNodes[0].childNodes[0].mathmlTree)){for(let n,r=1;n=t.childNodes[r];r++)if(n.childNodes[0].childNodes.length){e=!1;break}}else e=!1;e&&t.addAnnotation("Emph","left");if(Hc(t.childNodes[0].childNodes[t.childNodes[0].childNodes.length-1].mathmlTree)){const e=t.childNodes[0].childNodes.length;for(let r,s=1;r=t.childNodes[s];s++)if(r.childNodes.length>=e){n=!1;break}}else n=!1;return n&&t.addAnnotation("Emph","right"),e||n})));const Yc=["punctuated","relseq","multirel","infixop","prefixop","postfixop"];function qc(t,e){if(!t.childNodes.length)return Xc(t),[t];let n=null;if("punctuated"===t.type&&(e?"endpunct"===t.role:"startpunct"===t.role)){const r=t.childNodes;Xc(r[e?r.length-1:0])&&(t=r[e?0:r.length-1],n=r[e?r.length-1:0])}if(-1!==Yc.indexOf(t.type)){const r=t.childNodes;Xc(r[e?r.length-1:0]);const s=$c.combineContentChildren(t,t.contentNodes,t.childNodes);return n&&(e?s.push(n):s.unshift(n)),s}return n?e?[t,n]:[n,t]:[t]}const Wc={metric:"metric",vbar:"neutral",openfence:"open",closefence:"close"};function Xc(t){if("punctuation"!==t.type)return!1;const e=Wc[t.role];return!!e&&(t.role=e,t.type="fence",t.addAnnotation("Emph","fence"),!0)}class Kc{static empty(){const t=x("<math/>"),e=new Kc(t);return e.mathml=t,e}static fromNode(t,e){const n=Kc.empty();return n.root=t,e&&(n.mathml=e),n}static fromRoot(t,e){let n=t;for(;n.parent;)n=n.parent;const r=Kc.fromNode(n);return e&&(r.mathml=e),r}static fromXml(t){const e=Kc.empty();return t.childNodes[0]&&(e.root=Fr.fromXml(t.childNodes[0])),e}constructor(t){this.mathml=t,this.parser=new Rc,this.root=this.parser.parse(t),this.collator=this.parser.getFactory().leafMap.collateMeaning();const e=this.collator.newDefault();e&&(this.parser=new Rc,this.parser.getFactory().defaultMap=e,this.root=this.parser.parse(t)),zc.visit(this.root,{}),function(t){for(const e of vn.values())e.active&&e.annotate(t);for(const e of Fn.values())e.active&&e.visit(t,Object.assign({},e.def))}(this.root)}xml(t){const e=x("<stree></stree>"),n=this.root.xml(e.ownerDocument,t);return e.appendChild(n),e}toString(t){return B(this.xml(t))}formatXml(t){return F(this.toString(t))}displayTree(){this.root.displayTree()}replaceNode(t,e){const n=t.parent;n?n.replaceChild(t,e):this.root=e}toJson(){const t={};return t.stree=this.root.toJson(),t}}const zc=new Rn("general","unit",((t,e)=>(us(t)&&(t.role="unit"),!1)));function Zc(t){return Jc(t).xml()}function Jc(t){return new Kc(t)}const Qc=[],ta={collapsed:!0,implicit:!0,wiki:!0};function ea(t){const e=function(t){for(let e,n=0;e=Qc[n];n++)if(e.test(t))return e.constr(t);return null}(t);let n;if(e)return n=e.getMathml(),ha(n);if(1===t.mathml.length){if(p.getInstance().output("Walktree Case 0"),!t.childNodes.length)return p.getInstance().output("Walktree Case 0.1"),n=t.mathml[0],Bc(n,t),ha(n);const e=t.childNodes[0];if(1===t.childNodes.length&&"empty"===e.type)return p.getInstance().output("Walktree Case 0.2"),n=t.mathml[0],Bc(n,t),n.appendChild(ea(e)),ha(n);t.childNodes.forEach((t=>{t.mathml.length||(t.mathml=[Ea(t)])}))}const r=t.contentNodes.map(Na);ba(t,r);const s=t.childNodes.map(ea),o=$c.combineContentChildren(t,r,s);if(n=t.mathmlTree,null===n)p.getInstance().output("Walktree Case 1"),n=na(o,t);else{const t=aa(o);p.getInstance().output("Walktree Case 2"),t?(p.getInstance().output("Walktree Case 2.1"),n=ma(t)):(p.getInstance().output("Walktree Case 2.2"),n=Aa(n))}return n=Sa(n),function(t,e,n){if(!e.length)return;const r="implicit"===n.role&&cr.combine_juxtaposition?function(t,e,n){const r=[];let s=O(t.childNodes),o=!1;for(;s.length;){const t=s.shift();if(t.hasAttribute(Pc.TYPE)){r.push(t);continue}const n=ra(t,e);0!==n.length&&(1!==n.length?(o?t.setAttribute("AuxiliaryImplicit",!0):o=!0,s=n.concat(s)):r.push(t))}const i=[],c=n.childNodes.map((function(t){return t.mathmlTree}));for(;c.length;){const t=c.pop();if(t){if(-1!==r.indexOf(t))break;-1!==e.indexOf(t)&&i.unshift(t)}}return r.concat(i)}(t,e,n):O(t.childNodes);if(!r.length)return void e.forEach((function(e){t.appendChild(e)}));let s=0;for(;e.length;){const n=e[0];if(r[s]===n||ia(r[s],n)){e.shift(),s++;continue}if(r[s]&&-1===e.indexOf(r[s])){s++;continue}if(oa(n,t)){e.shift();continue}const o=r[s];if(o)sa(t,o,n),e.shift();else{if(n.parentNode){t=ma(n),e.shift();continue}const r=e[1];if(r&&r.parentNode){(t=ma(r)).insertBefore(n,r),e.shift(),e.shift();continue}t.insertBefore(n,null),e.shift()}}}(n,o,t),Bc(n,t),ha(n)}function na(t,e){const n=function(t){const e=aa(t);if(!e)return{type:ca.INVALID,node:null};const n=aa(t.slice().reverse());if(e===n)return{type:ca.VALID,node:e};const r=la(e),s=function(t,e){let n=0;for(;t[n]&&-1===e.indexOf(t[n]);)n++;return t.slice(0,n+1)}(r,t),o=la(n,(function(t){return-1!==s.indexOf(t)})),i=o[0],c=s.indexOf(i);if(-1===c)return{type:ca.INVALID,node:null};return{type:s.length!==r.length?ca.PRUNED:ua(s[c+1],o[1])?ca.VALID:ca.INVALID,node:i}}(t);let r=n.node;const s=n.type;if(s!==ca.VALID||!Cr(r))if(p.getInstance().output("Walktree Case 1.1"),r=R("mrow"),s===ca.PRUNED)p.getInstance().output("Walktree Case 1.1.0"),r=function(t,e,n){let r=da(e);if(_r(r)){p.getInstance().output("Walktree Case 1.1.0.0"),function(t,e){for(const n of kc)t.hasAttribute(n)&&(e.setAttribute(n,t.getAttribute(n)),t.removeAttribute(n))}(r,t),O(r.childNodes).forEach((function(e){t.appendChild(e)}));const e=t;t=r,r=e}const s=n.indexOf(e);return n[s]=r,M(r,t),t.appendChild(r),n.forEach((function(e){t.appendChild(e)})),t}(r,n.node,t);else if(t[0]){p.getInstance().output("Walktree Case 1.1.1");const e=aa(t),n=function(t,e){const n=O(t.childNodes);let r=1/0,s=-1/0;return e.forEach((function(t){const e=n.indexOf(t);-1!==e&&(r=Math.min(r,e),s=Math.max(s,e))})),n.slice(r,s+1)}(ma(e),t);M(e,r),n.forEach((function(t){r.appendChild(t)}))}return e.mathmlTree||(e.mathmlTree=r),r}function ra(t,e){const n=[];let r=O(t.childNodes);for(;r.length;){const t=r.shift();t.nodeType===L.ELEMENT_NODE&&(t.hasAttribute(Pc.TYPE)||-1!==e.indexOf(t)?n.push(t):r=O(t.childNodes).concat(r))}return n}function sa(t,e,n){let r=e,s=ma(r);for(;s&&s.firstChild===r&&!r.hasAttribute("AuxiliaryImplicit")&&s!==t;)r=s,s=ma(r);s&&(s.insertBefore(n,r),r.removeAttribute("AuxiliaryImplicit"))}function oa(t,e){if(!t)return!1;do{if((t=ma(t))===e)return!0}while(t);return!1}function ia(t,e){const n=ze.functionApplication;if(t&&e&&t.textContent&&e.textContent&&t.textContent===n&&e.textContent===n&&"true"===e.getAttribute(Pc.ADDED)){for(let n,r=0;n=t.attributes[r];r++)e.hasAttribute(n.nodeName)||e.setAttribute(n.nodeName,n.nodeValue);return M(t,e),!0}return!1}var ca;function aa(t){let e=0,n=null;for(;!n&&e<t.length;)t[e].parentNode&&(n=t[e]),e++;return n}function la(t,e){const n=e||(t=>!1),r=[t];for(;!n(t)&&!_r(t)&&t.parentNode;)t=ma(t),r.unshift(t);return r}function ua(t,e){return!(!t||!e||t.previousSibling||e.nextSibling)}function ha(t){for(;!_r(t)&&pa(t);)t=ma(t);return t}function da(t){const e=O(t.childNodes);if(!e)return t;const n=e.filter((function(t){return t.nodeType===L.ELEMENT_NODE&&!Ir(t)}));return 1===n.length&&Cr(n[0])&&!n[0].hasAttribute(Pc.TYPE)?da(n[0]):t}function pa(t){const e=ma(t);return!(!e||!Cr(e))&&O(e.childNodes).every((function(e){return e===t||fa(e)}))}function fa(t){if(t.nodeType!==L.ELEMENT_NODE)return!0;if(!t||Ir(t))return!0;const e=O(t.childNodes);return!(!Cr(t)&&e.length||function(t){return!!t&&-1!==yr.indexOf(k(t))}(t)||t.hasAttribute(Pc.TYPE)||Or(t))&&O(t.childNodes).every(fa)}function ma(t){return t.parentNode}function ga(t,e){const n=new $c(e);t.setAttribute(Pc.COLLAPSED,n.toString())}function Na(t){if(t.mathml.length)return ea(t);const e=ta.implicit?Ea(t):R("mrow");return t.mathml=[e],e}function Sa(t){if("MFENCED"!==k(t))return t;const e=R("mrow");for(let n,r=0;n=t.attributes[r];r++)-1===["open","close","separators"].indexOf(n.name)&&e.setAttribute(n.name,n.value);return O(t.childNodes).forEach((function(t){e.appendChild(t)})),M(t,e),e}function Ea(t){const e=R("mo"),n=(r=t.textContent,d.Z.document.createTextNode(r));var r;return e.appendChild(n),Bc(e,t),e.setAttribute(Pc.ADDED,"true"),e}function ba(t,e){const n=t.type+(t.textContent?","+t.textContent:"");e.forEach((function(t){Aa(t).setAttribute(Pc.OPERATOR,n)}))}function Aa(t){const e=O(t.childNodes);if(!e)return t;const n=e.filter((function(t){return!fa(t)})),r=[];for(let t,e=0;t=n[e];e++)if(Cr(t)){const e=Aa(t);e&&e!==t&&r.push(e)}else r.push(t);return 1===r.length?r[0]:t}function ya(t,e,n=!1){const r=F(t.toString()).toString().replace(new RegExp(Dc,"g"),"");return n?e+":\n```html\n"+r+"\n```\n":r}function Ta(t,e){const n=!!e,r=e||[],s=t.parent,o=t.contentNodes.map((function(t){return t.id}));o.unshift("c");const i=[t.id,o];for(let e,o=0;e=t.childNodes[o];o++){const t=ea(e);r.push(t);const o=Aa(t);s&&!n&&o.setAttribute(Pc.PARENT,s.id.toString()),i.push(e.id)}return i}!function(t){t.VALID="valid",t.INVALID="invalid",t.PRUNED="pruned"}(ca||(ca={}));class _a{constructor(t){this.semantic=t}}class Ia extends _a{static test(t){return!t.mathmlTree&&"line"===t.type&&"binomial"===t.role}constructor(t){super(t),this.mml=t.mathmlTree}getMathml(){if(!this.semantic.childNodes.length)return this.mml;const t=this.semantic.childNodes[0];if(this.mml=ea(t),this.mml.hasAttribute(Pc.TYPE)){const t=R("mrow");t.setAttribute(Pc.ADDED,"true"),M(this.mml,t),t.appendChild(this.mml),this.mml=t}return Bc(this.mml,this.semantic),this.mml}}class Ca extends _a{static test(t){if(!t.mathmlTree||!t.childNodes.length)return!1;const e=k(t.mathmlTree),n=t.childNodes[0].role;return"MSUBSUP"===e&&"subsup"===n||"MUNDEROVER"===e&&"underover"===n}constructor(t){super(t),this.mml=t.mathmlTree}getMathml(){const t=this.semantic.childNodes[0],e=t.childNodes[0],n=this.semantic.childNodes[1],r=t.childNodes[1],s=ea(n),o=ea(e),i=ea(r);return Bc(this.mml,this.semantic),this.mml.setAttribute(Pc.CHILDREN,Uc([e,r,n])),[o,i,s].forEach((t=>Aa(t).setAttribute(Pc.PARENT,this.mml.getAttribute(Pc.ID)))),this.mml.setAttribute(Pc.TYPE,t.role),ga(this.mml,[this.semantic.id,[t.id,e.id,r.id],n.id]),this.mml}}class Oa extends _a{static multiscriptIndex(t){return"punctuated"===t.type&&"dummy"===t.contentNodes[0].role?Ta(t):(ea(t),t.id)}static createNone_(t){const e=R("none");return t&&Bc(e,t),e.setAttribute(Pc.ADDED,"true"),e}constructor(t){super(t),this.mml=t.mathmlTree}completeMultiscript(t,e){const n=O(this.mml.childNodes).slice(1);let r=0;const s=t=>{for(let e,s=0;e=t[s];s++){const t=n[r];if(t&&e===parseInt(Aa(t).getAttribute(Pc.ID)))Aa(t).setAttribute(Pc.PARENT,this.semantic.id.toString()),r++;else{const n=this.semantic.querySelectorAll((t=>t.id===e));this.mml.insertBefore(Oa.createNone_(n[0]),t||null)}}};s(t),n[r]&&"MPRESCRIPTS"!==k(n[r])?this.mml.insertBefore(n[r],R("mprescripts")):r++,s(e)}}class xa extends Oa{static test(t){if(!t.mathmlTree)return!1;return"MMULTISCRIPTS"===k(t.mathmlTree)&&("superscript"===t.type||"subscript"===t.type)}constructor(t){super(t)}getMathml(){let t,e,n;if(Bc(this.mml,this.semantic),this.semantic.childNodes[0]&&"subsup"===this.semantic.childNodes[0].role){const r=this.semantic.childNodes[0];t=r.childNodes[0],e=Oa.multiscriptIndex(this.semantic.childNodes[1]),n=Oa.multiscriptIndex(r.childNodes[1]);const s=[this.semantic.id,[r.id,t.id,n],e];ga(this.mml,s),this.mml.setAttribute(Pc.TYPE,r.role),this.completeMultiscript($c.interleaveIds(n,e),[])}else{t=this.semantic.childNodes[0],e=Oa.multiscriptIndex(this.semantic.childNodes[1]);const n=[this.semantic.id,t.id,e];ga(this.mml,n)}const r=$c.collapsedLeafs(n||[],e);return Aa(ea(t)).setAttribute(Pc.PARENT,this.semantic.id.toString()),r.unshift(t.id),this.mml.setAttribute(Pc.CHILDREN,r.join(",")),this.mml}}class La extends Oa{static test(t){return!!t.mathmlTree&&"tensor"===t.type}constructor(t){super(t)}getMathml(){ea(this.semantic.childNodes[0]);const t=Oa.multiscriptIndex(this.semantic.childNodes[1]),e=Oa.multiscriptIndex(this.semantic.childNodes[2]),n=Oa.multiscriptIndex(this.semantic.childNodes[3]),r=Oa.multiscriptIndex(this.semantic.childNodes[4]);Bc(this.mml,this.semantic);const s=[this.semantic.id,this.semantic.childNodes[0].id,t,e,n,r];ga(this.mml,s);const o=$c.collapsedLeafs(t,e,n,r);return o.unshift(this.semantic.childNodes[0].id),this.mml.setAttribute(Pc.CHILDREN,o.join(",")),this.completeMultiscript($c.interleaveIds(n,r),$c.interleaveIds(t,e)),this.mml}}class Ma extends _a{static test(t){return!(!t.mathmlTree||!t.fencePointer||t.mathmlTree.getAttribute("data-semantic-type"))}static makeEmptyNode_(t){const e=R("mrow"),n=new Fr(t);return n.type="empty",n.mathmlTree=e,n}static fencedMap_(t,e){e[t.id]=t.mathmlTree,t.embellished&&Ma.fencedMap_(t.childNodes[0],e)}constructor(t){super(t),this.fenced=null,this.fencedMml=null,this.fencedMmlNodes=[],this.ofence=null,this.ofenceMml=null,this.ofenceMap={},this.cfence=null,this.cfenceMml=null,this.cfenceMap={},this.parentCleanup=[]}getMathml(){this.getFenced_(),this.fencedMml=ea(this.fenced),this.getFencesMml_(),"empty"!==this.fenced.type||this.fencedMml.parentNode||(this.fencedMml.setAttribute(Pc.ADDED,"true"),this.cfenceMml.parentNode.insertBefore(this.fencedMml,this.cfenceMml)),this.getFencedMml_();return this.rewrite_()}fencedElement(t){return"fenced"===t.type||"matrix"===t.type||"vector"===t.type}getFenced_(){let t=this.semantic;for(;!this.fencedElement(t);)t=t.childNodes[0];this.fenced=t.childNodes[0],this.ofence=t.contentNodes[0],this.cfence=t.contentNodes[1],Ma.fencedMap_(this.ofence,this.ofenceMap),Ma.fencedMap_(this.cfence,this.cfenceMap)}getFencedMml_(){let t=this.ofenceMml.nextSibling;for(t=t===this.fencedMml?t:this.fencedMml;t&&t!==this.cfenceMml;)this.fencedMmlNodes.push(t),t=t.nextSibling}getFencesMml_(){let t=this.semantic;const e=Object.keys(this.ofenceMap),n=Object.keys(this.cfenceMap);for(;!(this.ofenceMml&&this.cfenceMml||t===this.fenced);)-1===e.indexOf(t.fencePointer)||this.ofenceMml||(this.ofenceMml=t.mathmlTree),-1===n.indexOf(t.fencePointer)||this.cfenceMml||(this.cfenceMml=t.mathmlTree),t=t.childNodes[0];this.ofenceMml||(this.ofenceMml=this.ofence.mathmlTree),this.cfenceMml||(this.cfenceMml=this.cfence.mathmlTree),this.ofenceMml&&(this.ofenceMml=ha(this.ofenceMml)),this.cfenceMml&&(this.cfenceMml=ha(this.cfenceMml))}rewrite_(){let t=this.semantic,e=null;const n=this.introduceNewLayer_();for(Bc(n,this.fenced.parent);!this.fencedElement(t);){const r=t.mathmlTree,s=this.specialCase_(t,r);if(s)t=s;else{Bc(r,t);const e=[];for(let n,r=1;n=t.childNodes[r];r++)e.push(ea(n));t=t.childNodes[0]}const o=R("dummy"),i=r.childNodes[0];M(r,o),M(n,r),M(r.childNodes[0],n),M(o,i),e||(e=r)}return ea(this.ofence),ea(this.cfence),this.cleanupParents_(),e||n}specialCase_(t,e){const n=k(e);let r,s=null;if("MSUBSUP"===n?(s=t.childNodes[0],r=Ca):"MMULTISCRIPTS"===n&&("superscript"===t.type||"subscript"===t.type?r=xa:"tensor"===t.type&&(r=La),s=r&&t.childNodes[0]&&"subsup"===t.childNodes[0].role?t.childNodes[0]:t),!s)return null;const o=s.childNodes[0],i=Ma.makeEmptyNode_(o.id);return s.childNodes[0]=i,e=new r(t).getMathml(),s.childNodes[0]=o,this.parentCleanup.push(e),s.childNodes[0]}introduceNewLayer_(){const t=this.fullFence(this.ofenceMml),e=this.fullFence(this.cfenceMml);let n=R("mrow");if(M(this.fencedMml,n),this.fencedMmlNodes.forEach((t=>n.appendChild(t))),n.insertBefore(t,this.fencedMml),n.appendChild(e),!n.parentNode){const t=R("mrow");for(;n.childNodes.length>0;)t.appendChild(n.childNodes[0]);n.appendChild(t),n=t}return n}fullFence(t){const e=this.fencedMml.parentNode;let n=t;for(;n.parentNode&&n.parentNode!==e;)n=n.parentNode;return n}cleanupParents_(){this.parentCleanup.forEach((function(t){const e=t.childNodes[1].getAttribute(Pc.PARENT);t.childNodes[0].setAttribute(Pc.PARENT,e)}))}}class Ra extends _a{static test(t){return!!t.mathmlTree&&t.hasAnnotation("Emph","top")}constructor(t){super(t),this.mrows=[],this.mml=t.mathmlTree}getMathml(){if(this.recurseToTable(this.semantic),this.mrows.length){const t=R("mrow");this.mml.parentNode.insertBefore(t,this.mml);for(const e of this.mrows)t.appendChild(e);t.appendChild(this.mml)}return this.mml}recurseToTable(t){var e,n;if(t.hasAnnotation("Emph","top")||t.hasAnnotation("Emph","fence")||!t.hasAnnotation("Emph","left")&&!t.hasAnnotation("Emph","right")){if(!t.mathmlTree||"MTABLE"===k(t.mathmlTree)&&(null===(e=t.annotation.Emph)||void 0===e?void 0:e.length)&&"table"!==t.annotation.Emph[0]){const e=R("mrow");Bc(e,t),this.mrows.unshift(e)}else{if("MTABLE"===k(t.mathmlTree)&&(null===(n=t.annotation.Emph)||void 0===n?void 0:n.length)&&"table"===t.annotation.Emph[0])return void this.finalizeTable(t);Bc(t.mathmlTree,t)}if(t.childNodes.forEach(this.recurseToTable.bind(this)),t.textContent||"punctuated"===t.type){const e=t.contentNodes.map((t=>{const e=Na(t);return e.hasAttribute("data-semantic-added")?this.mrows.unshift(e):this.recurseToTable(t),e}));ba(t,e)}else t.contentNodes.forEach(this.recurseToTable.bind(this))}else ea(t)}finalizeTable(t){Bc(t.mathmlTree,t),t.contentNodes.forEach((t=>{ea(t)})),t.childNodes.forEach((t=>{ea(t)}))}}class va extends _a{static test(t){if(!t.mathmlTree||!t.childNodes.length)return!1;const e=k(t.mathmlTree),n=t.type;return("limupper"===n||"limlower"===n)&&("MSUBSUP"===e||"MUNDEROVER"===e)||"limboth"===n&&("MSUB"===e||"MUNDER"===e||"MSUP"===e||"MOVER"===e)}static walkTree_(t){t&&ea(t)}constructor(t){super(t),this.mml=t.mathmlTree}getMathml(){const t=this.semantic.childNodes;return"limboth"!==this.semantic.type&&this.mml.childNodes.length>=3&&(this.mml=na([this.mml],this.semantic)),Bc(this.mml,this.semantic),t[0].mathmlTree||(t[0].mathmlTree=this.semantic.mathmlTree),t.forEach(va.walkTree_),this.mml}}class Fa extends _a{static test(t){return!!t.mathmlTree&&"line"===t.type}constructor(t){super(t),this.mml=t.mathmlTree}getMathml(){return this.semantic.contentNodes.length&&ea(this.semantic.contentNodes[0]),this.semantic.childNodes.length&&ea(this.semantic.childNodes[0]),Bc(this.mml,this.semantic),this.mml}}class wa extends _a{static test(t){return!!t.mathmlTree&&("inference"===t.type||"premises"===t.type)}constructor(t){super(t),this.mml=t.mathmlTree}getMathml(){return this.semantic.childNodes.length?(this.semantic.contentNodes.forEach((function(t){ea(t),Bc(t.mathmlTree,t)})),this.semantic.childNodes.forEach((function(t){ea(t)})),Bc(this.mml,this.semantic),this.mml.getAttribute("data-semantic-id")===this.mml.getAttribute("data-semantic-parent")&&this.mml.removeAttribute("data-semantic-parent"),this.mml):this.mml}}class Da extends _a{static test(t){return"matrix"===t.type||"vector"===t.type||"cases"===t.type}constructor(t){super(t),this.inner=[],this.mml=t.mathmlTree}getMathml(){const t=Na(this.semantic.contentNodes[0]),e=this.semantic.contentNodes[1]?Na(this.semantic.contentNodes[1]):null;if(this.inner=this.semantic.childNodes.map(ea),this.mml)if("MFENCED"===k(this.mml)){const n=this.mml.childNodes;this.mml.insertBefore(t,n[0]||null),e&&this.mml.appendChild(e),this.mml=Sa(this.mml)}else{const n=[t,this.mml];e&&n.push(e),this.mml=na(n,this.semantic)}else this.mml=na([t].concat(this.inner,[e]),this.semantic);return Bc(this.mml,this.semantic),this.mml}}class Pa extends _a{static test(t){return"punctuated"===t.type&&("text"===t.role||t.contentNodes.every((t=>"dummy"===t.role)))}constructor(t){super(t),this.mml=t.mathmlTree}getMathml(){const t=[],e=Ta(this.semantic,t);return this.mml=na(t,this.semantic),Bc(this.mml,this.semantic),this.mml.removeAttribute(Pc.CONTENT),ga(this.mml,e),this.mml}}function ka(t){const e=U(t);return function(t,e){const n=U(t);return ea(e.root),N.getInstance().structure&&t.setAttribute(Pc.STRUCTURE,$c.fromStructure(t,e).toString()),p.getInstance().generateOutput((()=>[ya(n,"Original MathML",ta.wiki),ya(e,"Semantic Tree",ta.wiki),ya(t,"Semantically enriched MathML",ta.wiki)])),t}(e,Jc(e))}function Ua(t){return ka(x(t))}Qc.push({test:va.test,constr:t=>new va(t)},{test:Ma.test,constr:t=>new Ma(t)},{test:Ca.test,constr:t=>new Ca(t)},{test:La.test,constr:t=>new La(t)},{test:xa.test,constr:t=>new xa(t)},{test:Fa.test,constr:t=>new Fa(t)},{test:Ia.test,constr:t=>new Ia(t)},{test:wa.test,constr:t=>new wa(t)},{test:Ra.test,constr:t=>new Ra(t)},{test:Da.test,constr:t=>new Da(t)},{test:Pa.test,constr:t=>new Pa(t)});let Ba=0;class ja{constructor(){this.counter=Ba++,this.ATTR="sre-highlight-"+this.counter.toString(),this.color=null,this.mactionName="",this.currentHighlights=[]}highlight(t){this.currentHighlights.push(t.map((t=>{const e=this.highlightNode(t);return this.setHighlighted(t),e})))}highlightAll(t){const e=this.getMactionNodes(t);for(let t,n=0;t=e[n];n++)this.highlight([t])}unhighlight(){const t=this.currentHighlights.pop();t&&t.forEach((t=>{this.isHighlighted(t.node)&&(this.unhighlightNode(t),this.unsetHighlighted(t.node))}))}unhighlightAll(){for(;this.currentHighlights.length>0;)this.unhighlight()}setColor(t){this.color=t}colorString(){return this.color.rgba()}addEvents(t,e){const n=this.getMactionNodes(t);for(let t,r=0;t=n[r];r++)for(const[n,r]of Object.entries(e))t.addEventListener(n,r)}getMactionNodes(t){return Array.from(t.getElementsByClassName(this.mactionName))}isMactionNode(t){const e=t.className||t.getAttribute("class");return!!e&&!!e.match(new RegExp(this.mactionName))}isHighlighted(t){return t.hasAttribute(this.ATTR)}setHighlighted(t){t.setAttribute(this.ATTR,"true")}unsetHighlighted(t){t.removeAttribute(this.ATTR)}colorizeAll(t){C(t);I(`.//*[@${Pc.ID}]`,t).forEach((t=>this.colorize(t)))}uncolorizeAll(t){I(`.//*[@${Pc.ID}]`,t).forEach((t=>this.uncolorize(t)))}colorize(t){const e=jc("foreground");t.hasAttribute(e)&&(t.setAttribute(e+"-old",t.style.color),t.style.color=t.getAttribute(e))}uncolorize(t){const e=jc("foreground")+"-old";t.hasAttribute(e)&&(t.style.color=t.getAttribute(e))}}class $a extends ja{constructor(){super(),this.mactionName="mjx-maction"}highlightNode(t){const e={node:t,background:t.style.backgroundColor,foreground:t.style.color};if(!this.isHighlighted(t)){const e=this.colorString();t.style.backgroundColor=e.background,t.style.color=e.foreground}return e}unhighlightNode(t){t.node.style.backgroundColor=t.background,t.node.style.color=t.foreground}}const Ga={red:{red:255,green:0,blue:0},green:{red:0,green:255,blue:0},blue:{red:0,green:0,blue:255},yellow:{red:255,green:255,blue:0},cyan:{red:0,green:255,blue:255},magenta:{red:255,green:0,blue:255},white:{red:255,green:255,blue:255},black:{red:0,green:0,blue:0}};function Va(t,e){const n=t||{color:e};let r=Object.prototype.hasOwnProperty.call(n,"color")?Ga[n.color]:n;return r||(r=Ga[e]),r.alpha=Object.prototype.hasOwnProperty.call(n,"alpha")?n.alpha:1,function(t){const e=t=>(t=Math.max(t,0),t=Math.min(255,t),Math.round(t));return t.red=e(t.red),t.green=e(t.green),t.blue=e(t.blue),t.alpha=Math.max(t.alpha,0),t.alpha=Math.min(1,t.alpha),t}(r)}class Ha{static toHex(t){const e=t.toString(16);return 1===e.length?"0"+e:e}constructor(t,e){this.foreground=Va(e,Ha.DEFAULT_FOREGROUND_),this.background=Va(t,Ha.DEFAULT_BACKGROUND_)}rgba(){const t=function(t){return"rgba("+t.red+","+t.green+","+t.blue+","+t.alpha+")"};return{background:t(this.background),foreground:t(this.foreground)}}rgb(){const t=function(t){return"rgb("+t.red+","+t.green+","+t.blue+")"};return{background:t(this.background),alphaback:this.background.alpha.toString(),foreground:t(this.foreground),alphafore:this.foreground.alpha.toString()}}hex(){const t=function(t){return"#"+Ha.toHex(t.red)+Ha.toHex(t.green)+Ha.toHex(t.blue)};return{background:t(this.background),alphaback:this.background.alpha.toString(),foreground:t(this.foreground),alphafore:this.foreground.alpha.toString()}}}Ha.DEFAULT_BACKGROUND_="blue",Ha.DEFAULT_FOREGROUND_="black";class Ya{constructor(){this.hue=10,this.sat=100,this.light=50,this.incr=50}generate(){return e=function(t,e,n){e=e>1?e/100:e,n=n>1?n/100:n;const r=(1-Math.abs(2*n-1))*e,s=r*(1-Math.abs(t/60%2-1)),o=n-r/2;let i=0,c=0,a=0;return 0<=t&&t<60?[i,c,a]=[r,s,0]:60<=t&&t<120?[i,c,a]=[s,r,0]:120<=t&&t<180?[i,c,a]=[0,r,s]:180<=t&&t<240?[i,c,a]=[0,s,r]:240<=t&&t<300?[i,c,a]=[s,0,r]:300<=t&&t<360&&([i,c,a]=[r,0,s]),{red:i+o,green:c+o,blue:a+o}}(this.hue,this.sat,this.light),"rgb("+(t={red:Math.round(255*e.red),green:Math.round(255*e.green),blue:Math.round(255*e.blue)}).red+","+t.green+","+t.blue+")";var t,e}increment(){this.hue=(this.hue+this.incr)%360}}class qa extends ja{constructor(){super(),this.mactionName="mjx-svg-maction"}highlightNode(t){let e;if(this.isHighlighted(t))return e={node:t.previousSibling||t,background:t.style.backgroundColor,foreground:t.style.color},e;if("svg"===t.tagName){const e={node:t,background:t.style.backgroundColor,foreground:t.style.color};return t.style.backgroundColor=this.colorString().background,t.style.color=this.colorString().foreground,e}const n=v("http://www.w3.org/2000/svg","rect");let r;if("use"===t.nodeName){const e=v("http://www.w3.org/2000/svg","g");t.parentNode.insertBefore(e,t),e.appendChild(t),r=e.getBBox(),e.parentNode.replaceChild(t,e)}else r=t.getBBox();n.setAttribute("x",(r.x-40).toString()),n.setAttribute("y",(r.y-40).toString()),n.setAttribute("width",(r.width+80).toString()),n.setAttribute("height",(r.height+80).toString());const s=t.getAttribute("transform");return s&&n.setAttribute("transform",s),n.setAttribute("fill",this.colorString().background),n.setAttribute(this.ATTR,"true"),t.parentNode.insertBefore(n,t),e={node:n,foreground:t.getAttribute("fill")},t.setAttribute("fill",this.colorString().foreground),e}setHighlighted(t){"svg"===t.tagName&&super.setHighlighted(t)}unhighlightNode(t){if("background"in t)return t.node.style.backgroundColor=t.background,void(t.node.style.color=t.foreground);t.foreground?t.node.nextSibling.setAttribute("fill",t.foreground):t.node.nextSibling.removeAttribute("fill"),t.node.parentNode.removeChild(t.node)}isMactionNode(t){let e=t.className||t.getAttribute("class");return!!e&&(e=void 0!==e.baseVal?e.baseVal:e,!!e&&!!e.match(new RegExp(this.mactionName)))}}const Wa={SVG:qa,"SVG-V3":class extends qa{constructor(){super(),this.mactionName="maction"}highlightNode(t){let e;if(this.isHighlighted(t))return e={node:t,background:this.colorString().background,foreground:this.colorString().foreground},e;if("svg"===t.tagName||"MJX-CONTAINER"===t.tagName)return e={node:t,background:t.style.backgroundColor,foreground:t.style.color},t.style.backgroundColor=this.colorString().background,t.style.color=this.colorString().foreground,e;const n=v("http://www.w3.org/2000/svg","rect");n.setAttribute("sre-highlighter-added","true");const r=t.getBBox();n.setAttribute("x",(r.x-40).toString()),n.setAttribute("y",(r.y-40).toString()),n.setAttribute("width",(r.width+80).toString()),n.setAttribute("height",(r.height+80).toString());const s=t.getAttribute("transform");if(s&&n.setAttribute("transform",s),n.setAttribute("fill",this.colorString().background),t.setAttribute(this.ATTR,"true"),t.parentNode.insertBefore(n,t),e={node:t,foreground:t.getAttribute("fill")},"rect"===t.nodeName){const e=new Ha({alpha:0,color:"black"});t.setAttribute("fill",e.rgba().foreground)}else t.setAttribute("fill",this.colorString().foreground);return e}unhighlightNode(t){const e=t.node.previousSibling;if(e&&e.hasAttribute("sre-highlighter-added"))return t.foreground?t.node.setAttribute("fill",t.foreground):t.node.removeAttribute("fill"),void t.node.parentNode.removeChild(e);t.node.style.backgroundColor=t.background,t.node.style.color=t.foreground}isMactionNode(t){return t.getAttribute("data-mml-node")===this.mactionName}getMactionNodes(t){return Array.from(I(`.//*[@data-mml-node="${this.mactionName}"]`,t))}},NativeMML:class extends ja{constructor(){super(),this.mactionName="maction"}highlightNode(t){let e=t.getAttribute("style");return e+=";background-color: "+this.colorString().background,e+=";color: "+this.colorString().foreground,t.setAttribute("style",e),{node:t}}unhighlightNode(t){let e=t.node.getAttribute("style");e=e.replace(";background-color: "+this.colorString().background,""),e=e.replace(";color: "+this.colorString().foreground,""),t.node.setAttribute("style",e)}colorString(){return this.color.rgba()}getMactionNodes(t){return Array.from(t.getElementsByTagName(this.mactionName))}isMactionNode(t){return t.tagName===this.mactionName}},"HTML-CSS":class extends ja{constructor(){super(),this.mactionName="maction"}highlightNode(t){const e={node:t,foreground:t.style.color,position:t.style.position},n=this.color.rgb();t.style.color=n.foreground,t.style.position="relative";const r=t.bbox;if(r&&r.w){const s=.05,o=0,i=R("span"),c=parseFloat(t.style.paddingLeft||"0");i.style.backgroundColor=n.background,i.style.opacity=n.alphaback.toString(),i.style.display="inline-block",i.style.height=r.h+r.d+2*s+"em",i.style.verticalAlign=-r.d+"em",i.style.marginTop=i.style.marginBottom=-s+"em",i.style.width=r.w+2*o+"em",i.style.marginLeft=c-o+"em",i.style.marginRight=-r.w-o-c+"em",t.parentNode.insertBefore(i,t),e.box=i}return e}unhighlightNode(t){const e=t.node;e.style.color=t.foreground,e.style.position=t.position,t.box&&t.box.parentNode.removeChild(t.box)}},"MML-CSS":class extends $a{constructor(){super(),this.mactionName="maction"}getMactionNodes(t){return Array.from(t.getElementsByTagName(this.mactionName))}isMactionNode(t){return t.tagName===this.mactionName}},CommonHTML:$a,CHTML:class extends $a{constructor(){super()}isMactionNode(t){return t.tagName.toUpperCase()===this.mactionName.toUpperCase()}getMactionNodes(t){return Array.from(t.getElementsByTagName(this.mactionName))}}};function Xa(t){return t?t.split(/,/):[]}function Ka(t,e){return t.getAttribute(e)}function za(t){if(t.hasAttribute(Pc.TYPE)&&!t.hasAttribute(Pc.PARENT))return t;const e=function(t,e){return t.querySelectorAll?O(t.querySelectorAll(`[${e}]`)):I(`.//*[@${e}]`,t)}(t,Pc.TYPE);for(let t,n=0;t=e[n];n++)if(!t.hasAttribute(Pc.PARENT))return t;return t}function Za(t,e){return t.getAttribute(Pc.ID)===e?t:D(t,Pc.ID,e)[0]}function Ja(t,e){return t.getAttribute(Pc.ID)===e?[t]:D(t,Pc.ID,e)}class Qa{static textContent(t,e,n){if(!n&&e.textContent)return void(t.textContent=e.textContent);const r=Xa(Ka(e,Pc.OPERATOR));r.length>1&&(t.textContent=r[1])}static isPunctuated(t){return!$c.simpleCollapseStructure(t)&&t[1]&&$c.contentCollapseStructure(t[1])}constructor(t){this.mathml=t,this.factory=new wr,this.nodeDict={},this.mmlRoot=za(t),this.streeRoot=this.assembleTree(this.mmlRoot),this.stree=Kc.fromNode(this.streeRoot,this.mathml),this.xml=this.stree.xml(),Ss.getInstance().setNodeFactory(this.factory)}getTree(){return this.stree}assembleTree(t){const e=this.makeNode(t),n=Xa(Ka(t,Pc.CHILDREN)),r=Xa(Ka(t,Pc.CONTENT));if(0===r.length&&0===n.length)return Qa.textContent(e,t),e;if(r.length>0){const t=Za(this.mathml,r[0]);t&&Qa.textContent(e,t,!0)}e.contentNodes=r.map((t=>this.setParent(t,e))),e.childNodes=n.map((t=>this.setParent(t,e)));const s=Ka(t,Pc.COLLAPSED);return s?this.postProcess(e,s):e}makeNode(t){const e=Ka(t,Pc.TYPE),n=Ka(t,Pc.ROLE),r=Ka(t,Pc.FONT),s=Ka(t,Pc.ANNOTATION)||"",o=Ka(t,Pc.ATTRIBUTES)||"",i=Ka(t,Pc.ID),c=Ka(t,Pc.EMBELLISHED),a=Ka(t,Pc.FENCEPOINTER),l=this.createNode(parseInt(i,10));return l.type=e,l.role=n,l.font=r||We.UNKNOWN,l.parseAnnotation(s),l.parseAttributes(o),a&&(l.fencePointer=a),c&&(l.embellished=c),l}makePunctuation(t){const e=this.createNode(t);return e.updateContent(ze.invisibleComma),e.role="dummy",e}makePunctuated(t,e,n){const r=this.createNode(e[0]);r.type="punctuated",r.embellished=t.embellished,r.fencePointer=t.fencePointer,r.role=n;const s=e.splice(1,1)[0].slice(1);r.contentNodes=s.map(this.makePunctuation.bind(this)),this.collapsedChildren_(e)}makeEmpty(t,e,n){const r=this.createNode(e);r.type="empty",r.embellished=t.embellished,r.fencePointer=t.fencePointer,r.role=n}makeIndex(t,e,n){if(Qa.isPunctuated(e))return this.makePunctuated(t,e,n),void(e=e[0]);$c.simpleCollapseStructure(e)&&!this.nodeDict[e.toString()]&&this.makeEmpty(t,e,n)}postProcess(t,e){const n=$c.fromString(e).array;if("subsup"===t.type){const e=this.createNode(n[1][0]);return e.type="subscript",e.role="subsup",t.type="superscript",e.embellished=t.embellished,e.fencePointer=t.fencePointer,this.makeIndex(t,n[1][2],"rightsub"),this.makeIndex(t,n[2],"rightsuper"),this.collapsedChildren_(n),t}if("subscript"===t.type)return this.makeIndex(t,n[2],"rightsub"),this.collapsedChildren_(n),t;if("superscript"===t.type)return this.makeIndex(t,n[2],"rightsuper"),this.collapsedChildren_(n),t;if("tensor"===t.type)return this.makeIndex(t,n[2],"leftsub"),this.makeIndex(t,n[3],"leftsuper"),this.makeIndex(t,n[4],"rightsub"),this.makeIndex(t,n[5],"rightsuper"),this.collapsedChildren_(n),t;if("punctuated"===t.type){if(Qa.isPunctuated(n)){const e=n.splice(1,1)[0].slice(1);t.contentNodes=e.map(this.makePunctuation.bind(this))}return t}if("underover"===t.type){const e=this.createNode(n[1][0]);return"overaccent"===t.childNodes[1].role?(e.type="overscore",t.type="underscore"):(e.type="underscore",t.type="overscore"),e.role="underover",e.embellished=t.embellished,e.fencePointer=t.fencePointer,this.collapsedChildren_(n),t}return t}createNode(t){const e=this.factory.makeNode(t);return this.nodeDict[t.toString()]=e,e}collapsedChildren_(t){const e=t=>{const n=this.nodeDict[t[0]];n.childNodes=[];for(let r=1,s=t.length;r<s;r++){const s=t[r];n.childNodes.push($c.simpleCollapseStructure(s)?this.nodeDict[s]:e(s))}return n};e(t)}setParent(t,e){const n=Za(this.mathml,t),r=this.assembleTree(n);return r.parent=e,r}}function tl(t){return Ai.getInstance().evaluateNode(t)}function el(t){return xc(tl(t))}function nl(t){const e=function(t){return tl(Kc.fromNode(t).xml())}(t);return xc(e)}function rl(t,e,n){const r=D(n,"id",e.id.toString())[0],s=r?xc(tl(r)):nl(e);t.setAttribute(Pc.SPEECH,s)}function sl(t,e,n){const r=nl(e);t.setAttribute(n,r)}function ol(t,e){const n=il(e);n&&t.setAttribute(Pc.PREFIX,n)}function il(t){const e=function(t){const e=Kc.fromRoot(t),n=I('.//*[@id="'+t.id+'"]',e.xml());let r=n[0];n.length>1&&(r=function(t,e){const n=e[0];if(!t.parent)return n;const r=[];for(;t;)r.push(t.id),t=t.parent;const s=function(t,e){for(;e.length&&e.shift().toString()===t.getAttribute("id")&&t.parentNode&&t.parentNode.parentNode;)t=t.parentNode.parentNode;return!e.length};for(let t,n=0;t=e[n];n++)if(s(t,r.slice()))return t;return n}(t,n)||r);return r?Ai.getInstance().runInSetting({modality:"prefix",domain:"default",style:"default",strict:!0,speech:!0},(function(){return Ai.getInstance().evaluateNode(r)})):[]}(t);return xc(e)}function cl(t){const e=function(t){return t?Ai.getInstance().runInSetting({modality:"summary",strict:!1,speech:!0},(function(){return Ai.getInstance().evaluateNode(t)})):[]}(t);return xc(e)}class al{constructor(){this.modality=jc("speech"),this.rebuilt_=null,this.options_={}}getRebuilt(){return this.rebuilt_}setRebuilt(t){this.rebuilt_=t}setOptions(t){this.options_=t||{},this.modality=jc(this.options_.modality||"speech")}getOptions(){return this.options_}start(){}end(){}generateSpeech(t,e){return this.rebuilt_||(this.rebuilt_=new Qa(e)),Gi(this.options_),el(this.getRebuilt().xml)}}class ll extends al{getSpeech(t,e){const n=this.generateSpeech(t,e);return t.setAttribute(this.modality,n),n}}class ul extends al{constructor(){super(...arguments),this.modality=jc("foreground"),this.contrast=new Ya}static visitStree_(t,e,n){if(t.childNodes.length){if(t.contentNodes.length&&("punctuated"===t.type&&t.contentNodes.forEach((t=>n[t.id]=!0)),"implicit"!==t.role&&e.push(t.contentNodes.map((t=>t.id)))),t.childNodes.length){if("implicit"===t.role){const r=[];let s=[];for(const e of t.childNodes){const t=[];ul.visitStree_(e,t,n),t.length<=2&&r.push(t.shift()),s=s.concat(t)}return e.push(r),void s.forEach((t=>e.push(t)))}t.childNodes.forEach((t=>ul.visitStree_(t,e,n)))}}else n[t.id]||e.push(t.id)}getSpeech(t,e){return Ka(t,this.modality)}generateSpeech(t,e){return this.getRebuilt()||this.setRebuilt(new Qa(x(e))),this.colorLeaves_(t),Ka(t,this.modality)}colorLeaves_(t){const e=[];ul.visitStree_(this.getRebuilt().streeRoot,e,{});for(const n of e){const e=this.contrast.generate();let r=!1;r=Array.isArray(n)?n.map((n=>this.colorLeave_(t,n,e))).reduce(((t,e)=>t||e),!1):this.colorLeave_(t,n.toString(),e),r&&this.contrast.increment()}}colorLeave_(t,e,n){const r=Za(t,e);return!!r&&(r.setAttribute(this.modality,n),!0)}}class hl extends al{getSpeech(t,e){return Ka(t,this.modality)}}class dl extends al{getSpeech(t,e){return""}}class pl extends al{getSpeech(t,e,n=null){const r=this.generateSpeech(t,e),s=this.getRebuilt().nodeDict;for(const[r,o]of Object.entries(s)){const s=Za(e,r),i=Za(t,r)||n&&Za(n,r);s&&i&&(this.modality&&this.modality!==Pc.SPEECH?sl(i,o,this.modality):rl(i,o,this.getRebuilt().xml),this.modality===Pc.SPEECH&&ol(i,o))}return r}}class fl extends pl{getSpeech(t,e){return super.getSpeech(t,e),Ka(t,this.modality)}}class ml extends al{getSpeech(t,e){return function(t,e){const n=P(t,"maction");for(let t,r=0;t=n[r];r++){const n=t.childNodes[1].getAttribute(Pc.ID);D(e,"id",n)[0].setAttribute("alternative",n)}}(e,this.getRebuilt().xml),this.generateSpeech(t,e)}}function gl(t){return(Nl[t]||Nl.Direct)()}const Nl={Adhoc:()=>new ll,Color:()=>new ul,Direct:()=>new hl,Dummy:()=>new dl,Node:()=>new fl,Summary:()=>new ml,Tree:()=>new pl};class Sl extends o{static comparator(){return new bl(N.getInstance().dynamicCstr,s.createProp([o.DEFAULT_VALUES[t.LOCALE]],[o.DEFAULT_VALUES[t.MODALITY]],[o.DEFAULT_VALUES[t.DOMAIN]],[o.DEFAULT_VALUES[t.STYLE]]))}static fromPreference(t){const e=t.split(":"),n={},r=El.getProperties(),s=Object.keys(r);for(let t,o=0;t=e[o];o++){const e=t.split("_");if(-1===s.indexOf(e[0]))continue;const o=e[1];o&&o!==Sl.AUTO&&-1!==r[e[0]].indexOf(o)&&(n[e[0]]=e[1])}return n}static toPreference(t){const e=Object.keys(t),n=[];for(let r=0;r<e.length;r++)n.push(e[r]+"_"+t[e[r]]);return n.length?n.join(":"):o.DEFAULT_VALUE}static getLocalePreferences(t){const e=t||An(Ai.getInstance().enumerate());return Sl.getLocalePreferences_(e)}static currentPreference(){return h.clearspeak}static relevantPreferences(t){const e=yl[t.type];return e&&(e[t.role]||e[""])||"ImpliedTimes"}static findPreference(t,e){if("default"===t)return Sl.AUTO;return Sl.fromPreference(t)[e]||Sl.AUTO}static addPreference(t,e,n){if("default"===t)return e+"_"+n;const r=Sl.fromPreference(t);return r[e]=n,Sl.toPreference(r)}static getLocalePreferences_(t){const e={};for(const n of Object.keys(t)){if(!t[n].speech||!t[n].speech.clearspeak)continue;const r=Object.keys(t[n].speech.clearspeak);if(r.length<3)continue;const s=e[n]={};for(const t in El.getProperties()){const e=El.getProperties()[t],n=[t+"_Auto"];if(e)for(const s of e)-1!==r.indexOf(t+"_"+s)&&n.push(t+"_"+s);s[t]=n}}return e}constructor(t,e){super(t),this.preference=e}equal(t){if(!super.equal(t))return!1;const e=Object.keys(this.preference),n=t.preference;if(e.length!==Object.keys(n).length)return!1;for(let t,r=0;t=e[r];r++)if(this.preference[t]!==n[t])return!1;return!0}}Sl.AUTO="Auto";const El=new s({AbsoluteValue:["Auto","AbsEnd","Cardinality","Determinant"],Bar:["Auto","Conjugate"],Caps:["Auto","SayCaps"],CombinationPermutation:["Auto","ChoosePermute"],Currency:["Auto","Position","Prefix"],Ellipses:["Auto","AndSoOn"],Enclosed:["Auto","EndEnclose"],Exponent:["Auto","AfterPower","Ordinal","OrdinalPower","Exponent"],Fraction:["Auto","EndFrac","FracOver","General","GeneralEndFrac","Ordinal","Over","OverEndFrac","Per"],Functions:["Auto","None","Reciprocal"],ImpliedTimes:["Auto","MoreImpliedTimes","None"],Log:["Auto","LnAsNaturalLog"],Matrix:["Auto","Combinatoric","EndMatrix","EndVector","SilentColNum","SpeakColNum","Vector"],MultiLineLabel:["Auto","Case","Constraint","Equation","Line","None","Row","Step"],MultiLineOverview:["Auto","None"],MultiLinePausesBetweenColumns:["Auto","Long","Short"],MultsymbolDot:["Auto","Dot"],MultsymbolX:["Auto","By","Cross"],Paren:["Auto","CoordPoint","Interval","Silent","Speak","SpeakNestingLevel"],Prime:["Auto","Angle","Length"],Roots:["Auto","PosNegSqRoot","PosNegSqRootEnd","RootEnd"],SetMemberSymbol:["Auto","Belongs","Element","Member","In"],Sets:["Auto","SilentBracket","woAll"],TriangleSymbol:["Auto","Delta"],Trig:["Auto","ArcTrig","TrigInverse","Reciprocal"],VerticalLine:["Auto","Divides","Given","SuchThat"]});class bl extends c{constructor(t,e){super(t,e),this.preference=t instanceof Sl?t.preference:{}}match(e){if(!(e instanceof Sl))return super.match(e);if("default"===e.getComponents()[t.STYLE])return!0;const n=Object.keys(e.preference);for(let t,r=0;t=n[r];r++)if(this.preference[t]!==e.preference[t])return!1;return!0}compare(t,e){const n=super.compare(t,e);if(0!==n)return n;const r=t instanceof Sl,s=e instanceof Sl;if(!r&&s)return 1;if(r&&!s)return-1;if(!r&&!s)return 0;const o=Object.keys(t.preference).length,i=Object.keys(e.preference).length;return o>i?-1:o<i?1:0}}const Al=[["AbsoluteValue","fenced","neutral","metric"],["Bar","overscore","overaccent"],["Caps","identifier","latinletter"],["CombinationPermutation","appl","unknown"],["Ellipses","punctuation","ellipsis"],["Exponent","superscript",""],["Fraction","fraction",""],["Functions","appl","simple function"],["ImpliedTimes","operator","implicit"],["Log","appl","prefix function"],["Matrix","matrix",""],["Matrix","vector",""],["MultiLineLabel","multiline","label"],["MultiLineOverview","multiline","table"],["MultiLinePausesBetweenColumns","multiline","table"],["MultiLineLabel","table","label"],["MultiLineOverview","table","table"],["MultiLinePausesBetweenColumns","table","table"],["MultiLineLabel","cases","label"],["MultiLineOverview","cases","table"],["MultiLinePausesBetweenColumns","cases","table"],["MultsymbolDot","operator","multiplication"],["MultsymbolX","operator","multiplication"],["Paren","fenced","leftright"],["Prime","superscript","prime"],["Roots","root",""],["Roots","sqrt",""],["SetMemberSymbol","relation","element"],["Sets","fenced","set extended"],["TriangleSymbol","identifier","greekletter"],["Trig","appl","prefix function"],["VerticalLine","punctuated","vbar"]],yl=function(){const t={};for(let e,n=0;e=Al[n];n++){const n=e[0];let r=t[e[1]];r||(r={},t[e[1]]=r),r[e[2]]=n}return t}();N.getInstance().comparators.clearspeak=Sl.comparator,N.getInstance().parsers.clearspeak=new class extends i{constructor(){super([t.LOCALE,t.MODALITY,t.DOMAIN,t.STYLE])}parse(e){const n=super.parse(e);let r=n.getValue(t.STYLE);const s=n.getValue(t.LOCALE),i=n.getValue(t.MODALITY);let c={};return r!==o.DEFAULT_VALUE&&(c=this.fromPreference(r),r=this.toPreference(c)),new Sl({locale:s,modality:i,domain:"clearspeak",style:r},c)}fromPreference(t){return Sl.fromPreference(t)}toPreference(t){return Sl.toPreference(t)}};class Tl{static factory(t,e,n,r){const s=t=>Za(r,t),o=n.nodeDict,i=s(t),c=e.map(s),a=e.map((function(t){return o[t]})),l=new Tl(a,o[t]);return l.domNodes=c,l.domPrimary_=i,l.allNodes=Tl.generateAllVisibleNodes_(e,c,o,r),l}static generateAllVisibleNodes_(t,e,n,r){let s=[];for(let o=0,i=t.length;o<i;o++){if(e[o]){const n=Tl.getAllVisibleNodes([t[o]],r);n.length?s=s.concat(n):s.push(e[o]);continue}const i=n[t[o]];if(!i)continue;const c=i.childNodes.map((t=>t.id.toString())),a=Tl.getAllVisibleNodes(c,r);s=s.concat(Tl.generateAllVisibleNodes_(c,a,n,r))}return s}static getAllVisibleNodes(t,e){let n=[];for(const r of t)n=n.concat(Ja(e,r));return n}constructor(t,e){this.nodes=t,this.primary=e,this.domNodes=[],this.domPrimary_=null,this.allNodes=[]}getSemanticPrimary(){return this.primary}getSemanticNodes(){return this.nodes}getNodes(){return this.allNodes}getDomNodes(){return this.domNodes}getDomPrimary(){return this.domPrimary_}toString(){return"Primary:"+this.domPrimary_+" Nodes:"+this.domNodes}clone(){const t=new Tl(this.nodes,this.primary);return t.domNodes=this.domNodes,t.domPrimary_=this.domPrimary_,t.allNodes=this.allNodes,t}}var _l;!function(t){t.UP="up",t.DOWN="down",t.LEFT="left",t.RIGHT="right",t.REPEAT="repeat",t.DEPTH="depth",t.ENTER="enter",t.EXPAND="expand",t.HOME="home",t.SUMMARY="summary",t.DETAIL="detail",t.ROW="row",t.CELL="cell"}(_l||(_l={}));class Il{static resetState(t){delete Il.STATE[t]}static setState(t,e){Il.STATE[t]=e}static getState(t){return Il.STATE[t]}}Il.STATE={};class Cl{constructor(t,e,n,r){this.node=t,this.generator=e,this.highlighter=n,this.modifier=!1,this.keyMapping=new Map([[ji.UP,this.up.bind(this)],[ji.DOWN,this.down.bind(this)],[ji.RIGHT,this.right.bind(this)],[ji.LEFT,this.left.bind(this)],[ji.TAB,this.repeat.bind(this)],[ji.DASH,this.expand.bind(this)],[ji.SPACE,this.depth.bind(this)],[ji.HOME,this.home.bind(this)],[ji.X,this.summary.bind(this)],[ji.Z,this.detail.bind(this)],[ji.V,this.virtualize.bind(this)],[ji.P,this.previous.bind(this)],[ji.U,this.undo.bind(this)],[ji.LESS,this.previousRules.bind(this)],[ji.GREATER,this.nextRules.bind(this)]]),this.cursors=[],this.xml_=null,this.rebuilt_=null,this.focus_=null,this.active_=!1,this.node.id?this.id=this.node.id:this.node.hasAttribute(Cl.SRE_ID_ATTR)?this.id=this.node.getAttribute(Cl.SRE_ID_ATTR):(this.node.setAttribute(Cl.SRE_ID_ATTR,Cl.ID_COUNTER.toString()),this.id=Cl.ID_COUNTER++),this.rootNode=za(t),this.rootId=this.rootNode.getAttribute(Pc.ID),this.xmlString_=r,this.moved=_l.ENTER}getXml(){return this.xml_||(this.xml_=x(this.xmlString_)),this.xml_}getRebuilt(){return this.rebuilt_||this.rebuildStree(),this.rebuilt_}isActive(){return this.active_}activate(){this.isActive()||(this.generator.start(),this.toggleActive_())}deactivate(){this.isActive()&&(Il.setState(this.id,this.primaryId()),this.generator.end(),this.toggleActive_())}getFocus(t=!1){return null===this.rootId&&this.getRebuilt(),this.focus_||(this.focus_=this.singletonFocus(this.rootId)),t&&this.updateFocus(),this.focus_}setFocus(t){this.focus_=t}getDepth(){return this.levels.depth()-1}isSpeech(){return this.generator.modality===Pc.SPEECH}focusDomNodes(){return this.getFocus().getDomNodes()}focusSemanticNodes(){return this.getFocus().getSemanticNodes()}speech(){const t=this.focusDomNodes();if(!t.length)return"";const e=this.specialMove();if(null!==e)return e;switch(this.moved){case _l.DEPTH:return this.depth_();case _l.SUMMARY:return this.summary_();case _l.DETAIL:return this.detail_();default:{const e=[],n=this.focusSemanticNodes();for(let r=0,s=t.length;r<s;r++){const s=t[r],o=n[r];e.push(s?this.generator.getSpeech(s,this.getXml(),this.node):nl(o))}return this.mergePrefix_(e)}}}move(t){const e=this.keyMapping.get(t);if(!e)return null;const n=e();return!(!n||n===this.getFocus())&&(this.setFocus(n),this.moved===_l.HOME&&(this.levels=this.initLevels()),!0)}up(){return this.moved=_l.UP,this.getFocus()}down(){return this.moved=_l.DOWN,this.getFocus()}left(){return this.moved=_l.LEFT,this.getFocus()}right(){return this.moved=_l.RIGHT,this.getFocus()}repeat(){return this.moved=_l.REPEAT,this.getFocus().clone()}depth(){return this.moved=this.isSpeech()?_l.DEPTH:_l.REPEAT,this.getFocus().clone()}home(){this.moved=_l.HOME;return this.singletonFocus(this.rootId)}getBySemanticId(t){return Za(this.node,t)}primaryId(){return this.getFocus().getSemanticPrimary().id.toString()}expand(){const t=this.getFocus().getDomPrimary(),e=this.actionable_(t);return e?(this.moved=_l.EXPAND,e.dispatchEvent(new Event("click")),this.getFocus().clone()):this.getFocus()}expandable(t){return!!this.actionable_(t)&&0===t.childNodes.length}collapsible(t){return!!this.actionable_(t)&&t.childNodes.length>0}restoreState(){if(!this.highlighter)return;const t=Il.getState(this.id);if(!t)return;let e=this.getRebuilt().nodeDict[t];const n=[];for(;e;)n.push(e.id),e=e.parent;for(n.pop();n.length>0;){this.down();const t=n.pop(),e=this.findFocusOnLevel(t);if(!e)break;this.setFocus(e)}this.moved=_l.ENTER}updateFocus(){this.setFocus(Tl.factory(this.getFocus().getSemanticPrimary().id.toString(),this.getFocus().getSemanticNodes().map((t=>t.id.toString())),this.getRebuilt(),this.node))}rebuildStree(){this.rebuilt_=new Qa(this.getXml()),this.rootId=this.rebuilt_.stree.root.id.toString(),this.generator.setRebuilt(this.rebuilt_),this.skeleton=$c.fromTree(this.rebuilt_.stree),this.skeleton.populate(),this.focus_=this.singletonFocus(this.rootId),this.levels=this.initLevels(),function(t,e,n){const r=P(e,"maction");for(let e,s=0;e=r[s];s++){const r=D(t,"id",e.getAttribute("id"))[0];if(!r)continue;const s=e.childNodes[1],o=s.getAttribute(Pc.ID);let i=Za(t,o);if(i&&"dummy"!==i.getAttribute(Pc.TYPE))continue;if(i=r.childNodes[0],i.getAttribute("sre-highlighter-added"))continue;const c=s.getAttribute(Pc.PARENT);c&&i.setAttribute(Pc.PARENT,c),i.setAttribute(Pc.TYPE,"dummy"),i.setAttribute(Pc.ID,o),D(n,"id",o)[0].setAttribute("alternative",o)}}(this.node,this.getXml(),this.rebuilt_.xml)}previousLevel(){const t=this.getFocus().getDomPrimary();return t?Ka(t,Pc.PARENT):this.getFocus().getSemanticPrimary().parent.id.toString()}nextLevel(){const t=this.getFocus().getDomPrimary();let e,n;if(t){e=Xa(Ka(t,Pc.CHILDREN)),n=Xa(Ka(t,Pc.CONTENT));const r=Ka(t,Pc.TYPE),s=Ka(t,Pc.ROLE);return this.combineContentChildren(r,s,n,e)}const r=t=>t.id.toString(),s=this.getRebuilt().nodeDict[this.primaryId()];return e=s.childNodes.map(r),n=s.contentNodes.map(r),0===e.length?[]:this.combineContentChildren(s.type,s.role,n,e)}singletonFocus(t){this.getRebuilt();const e=this.retrieveVisuals(t);return this.focusFromId(t,e)}retrieveVisuals(t){if(!this.skeleton)return[t];const e=parseInt(t,10),n=this.skeleton.subtreeNodes(e);if(!n.length)return[t];n.unshift(e);const r={},s=[];C(this.getXml());for(const t of n)r[t]||(s.push(t.toString()),r[t]=!0,this.subtreeIds(t,r));return s}subtreeIds(t,e){const n=I(`//*[@data-semantic-id="${t}"]`,this.getXml());I("*//@data-semantic-id",n[0]).forEach((t=>e[parseInt(t.textContent,10)]=!0))}focusFromId(t,e){return Tl.factory(t,e,this.getRebuilt(),this.node)}summary(){return this.moved=this.isSpeech()?_l.SUMMARY:_l.REPEAT,this.getFocus().clone()}detail(){return this.moved=this.isSpeech()?_l.DETAIL:_l.REPEAT,this.getFocus().clone()}specialMove(){return null}virtualize(t){return this.cursors.push({focus:this.getFocus(),levels:this.levels,undo:t||!this.cursors.length}),this.levels=this.levels.clone(),this.getFocus().clone()}previous(){const t=this.cursors.pop();return t?(this.levels=t.levels,t.focus):this.getFocus()}undo(){let t;do{t=this.cursors.pop()}while(t&&!t.undo);return t?(this.levels=t.levels,t.focus):this.getFocus()}update(t){this.generator.setOptions(t),Gi(t).then((()=>gl("Tree").getSpeech(this.node,this.getXml())))}nextRules(){const t=this.generator.getOptions();return"speech"!==t.modality?this.getFocus():(h[t.domain]=t.style,t.domain="mathspeak"===t.domain?"clearspeak":"mathspeak",t.style=h[t.domain],this.update(t),this.moved=_l.REPEAT,this.getFocus().clone())}nextStyle(t,e){if("mathspeak"===t){const t=["default","brief","sbrief"],n=t.indexOf(e);return-1===n?e:n>=t.length-1?t[0]:t[n+1]}if("clearspeak"===t){const t=Sl.getLocalePreferences().en;if(!t)return"default";const n=Sl.relevantPreferences(this.getFocus().getSemanticPrimary()),r=Sl.findPreference(e,n),s=t[n].map((function(t){return t.split("_")[1]})),o=s.indexOf(r);if(-1===o)return e;const i=o>=s.length-1?s[0]:s[o+1];return Sl.addPreference(e,n,i)}return e}previousRules(){const t=this.generator.getOptions();return"speech"!==t.modality?this.getFocus():(t.style=this.nextStyle(t.domain,t.style),this.update(t),this.moved=_l.REPEAT,this.getFocus().clone())}refocus(){let t,e=this.getFocus();for(;!e.getNodes().length;){t=this.levels.peek();const n=this.up();if(!n)break;this.setFocus(n),e=this.getFocus(!0)}this.levels.push(t),this.setFocus(e)}toggleActive_(){this.active_=!this.active_}mergePrefix_(t,e=[]){const n=this.isSpeech()?this.prefix_():"";n&&t.unshift(n);const r=this.isSpeech()?this.postfix_():"";return r&&t.push(r),Lc(function(t){const e=t.map((t=>"string"==typeof t?Tn.stringEmpty(t):t)),n=Oc.get(N.getInstance().markup);return n?n.merge(e):t.join()}(e.concat(t)))}prefix_(){const t=this.getFocus().getDomNodes(),e=this.getFocus().getSemanticNodes();return t[0]?Ka(t[0],Pc.PREFIX):il(e[0])}postfix_(){const t=this.getFocus().getDomNodes();return t[0]?Ka(t[0],Pc.POSTFIX):""}depth_(){const t=tt.getInstance().getParameter("depth");tt.getInstance().setParameter("depth",!0);const e=this.getFocus().getDomPrimary(),n=this.expandable(e)?W.MESSAGES.navigate.EXPANDABLE:this.collapsible(e)?W.MESSAGES.navigate.COLLAPSIBLE:"",r=W.MESSAGES.navigate.LEVEL+" "+this.getDepth(),s=il(this.getFocus().getSemanticNodes()[0]),o=[new _n({text:r,personality:{}}),new _n({text:s,personality:{}}),new _n({text:n,personality:{}})];return tt.getInstance().setParameter("depth",t),Lc(xc(o))}actionable_(t){const e=null==t?void 0:t.parentNode;return e&&this.highlighter.isMactionNode(e)?e:null}summary_(){const t=this.getFocus().getSemanticPrimary().id.toString(),e=cl(this.getRebuilt().xml.getAttribute("id")===t?this.getRebuilt().xml:D(this.getRebuilt().xml,"id",t)[0]);return this.mergePrefix_([e])}detail_(){const t=this.getFocus().getSemanticPrimary().id.toString(),e=this.getRebuilt().xml.getAttribute("id")===t?this.getRebuilt().xml:D(this.getRebuilt().xml,"id",t)[0],n=e.getAttribute("alternative");e.removeAttribute("alternative");const r=el(e),s=this.mergePrefix_([r]);return e.setAttribute("alternative",n),s}}Cl.ID_COUNTER=0,Cl.SRE_ID_ATTR="sre-explorer-id";class Ol extends Cl{up(){return null}down(){return null}left(){return null}right(){return null}repeat(){return null}depth(){return null}home(){return null}getDepth(){return 0}initLevels(){return null}combineContentChildren(t,e,n,r){return[]}findFocusOnLevel(t){return null}}class xl{constructor(){this.level_=[]}push(t){this.level_.push(t)}pop(){return this.level_.pop()}peek(){return this.level_[this.level_.length-1]||null}indexOf(t){const e=this.peek();return e?e.indexOf(t):null}find(t){const e=this.peek();if(!e)return null;for(let n=0,r=e.length;n<r;n++)if(t(e[n]))return e[n];return null}get(t){const e=this.peek();return!e||t<0||t>=e.length?null:e[t]}depth(){return this.level_.length}clone(){const t=new xl;return t.level_=this.level_.slice(0),t}toString(){let t="";for(let e,n=0;e=this.level_[n];n++)t+="\n"+e.map((function(t){return t.toString()}));return t}}class Ll extends Cl{constructor(t,e,n,r){super(t,e,n,r),this.node=t,this.generator=e,this.highlighter=n,this.levels=null,this.restoreState()}initLevels(){const t=new xl;return t.push([this.getFocus()]),t}up(){super.up();const t=this.previousLevel();if(!t)return null;this.levels.pop();return this.levels.find((function(e){return e.getSemanticNodes().some((function(e){return e.id.toString()===t}))}))}down(){super.down();const t=this.nextLevel();return 0===t.length?null:(this.levels.push(t),t[0])}combineContentChildren(t,e,n,r){switch(t){case"relseq":case"infixop":case"multirel":return this.makePairList(r,n);case"prefixop":return[this.focusFromId(r[0],n.concat(r))];case"postfixop":return[this.focusFromId(r[0],r.concat(n))];case"matrix":case"vector":case"fenced":return[this.focusFromId(r[0],[n[0],r[0],n[1]])];case"cases":return[this.focusFromId(r[0],[n[0],r[0]])];case"punctuated":return"text"===e?r.map(this.singletonFocus.bind(this)):r.length===n.length?n.map(this.singletonFocus.bind(this)):this.combinePunctuations(r,n,[],[]);case"appl":return[this.focusFromId(r[0],[r[0],n[0]]),this.singletonFocus(r[1])];case"root":return[this.singletonFocus(r[1]),this.singletonFocus(r[0])];default:return r.map(this.singletonFocus.bind(this))}}combinePunctuations(t,e,n,r){if(0===t.length)return r;const s=t.shift(),o=e.shift();return s===o?(n.push(o),this.combinePunctuations(t,e,n,r)):(e.unshift(o),n.push(s),t.length===e.length?(r.push(this.focusFromId(s,n.concat(e))),r):(r.push(this.focusFromId(s,n)),this.combinePunctuations(t,e,[],r)))}makePairList(t,e){if(0===t.length)return[];if(1===t.length)return[this.singletonFocus(t[0])];const n=[this.singletonFocus(t.shift())];for(let r=0,s=t.length;r<s;r++)n.push(this.focusFromId(t[r],[e[r],t[r]]));return n}left(){super.left();const t=this.levels.indexOf(this.getFocus());if(null===t)return null;const e=this.levels.get(t-1);return e||null}right(){super.right();const t=this.levels.indexOf(this.getFocus());if(null===t)return null;const e=this.levels.get(t+1);return e||null}findFocusOnLevel(t){return this.levels.find((e=>e.getSemanticPrimary().id===t))}}class Ml extends Cl{constructor(t,e,n,r){super(t,e,n,r),this.node=t,this.generator=e,this.highlighter=n,this.levels=null,this.restoreState()}initLevels(){const t=new xl;return t.push([this.primaryId()]),t}up(){super.up();const t=this.previousLevel();return t?(this.levels.pop(),this.singletonFocus(t)):null}down(){super.down();const t=this.nextLevel();if(0===t.length)return null;const e=this.singletonFocus(t[0]);return e&&this.levels.push(t),e}combineContentChildren(t,e,n,r){switch(t){case"relseq":case"infixop":case"multirel":return nr(r,n);case"prefixop":return n.concat(r);case"postfixop":return r.concat(n);case"matrix":case"vector":case"fenced":return r.unshift(n[0]),r.push(n[1]),r;case"cases":return r.unshift(n[0]),r;case"punctuated":return"text"===e?nr(r,n):r;case"appl":return[r[0],n[0],r[1]];case"root":return[r[1],r[0]];default:return r}}left(){super.left();const t=this.levels.indexOf(this.primaryId());if(null===t)return null;const e=this.levels.get(t-1);return e?this.singletonFocus(e):null}right(){super.right();const t=this.levels.indexOf(this.primaryId());if(null===t)return null;const e=this.levels.get(t+1);return e?this.singletonFocus(e):null}findFocusOnLevel(t){return this.singletonFocus(t.toString())}focusDomNodes(){return[this.getFocus().getDomPrimary()]}focusSemanticNodes(){return[this.getFocus().getSemanticPrimary()]}}class Rl extends Ml{constructor(t,e,n,r){super(t,e,n,r),this.node=t,this.generator=e,this.highlighter=n,this.firstJump=null,this.key_=null,this.row_=0,this.currentTable_=null,this.keyMapping.set(ji.ZERO,this.jumpCell.bind(this)),this.keyMapping.set(ji.ONE,this.jumpCell.bind(this)),this.keyMapping.set(ji.TWO,this.jumpCell.bind(this)),this.keyMapping.set(ji.THREE,this.jumpCell.bind(this)),this.keyMapping.set(ji.FOUR,this.jumpCell.bind(this)),this.keyMapping.set(ji.FIVE,this.jumpCell.bind(this)),this.keyMapping.set(ji.SIX,this.jumpCell.bind(this)),this.keyMapping.set(ji.SEVEN,this.jumpCell.bind(this)),this.keyMapping.set(ji.EIGHT,this.jumpCell.bind(this)),this.keyMapping.set(ji.NINE,this.jumpCell.bind(this))}move(t){this.key_=t;const e=super.move(t);return this.modifier=!1,e}up(){return this.moved=_l.UP,this.eligibleCell_()?this.verticalMove_(!1):super.up()}down(){return this.moved=_l.DOWN,this.eligibleCell_()?this.verticalMove_(!0):super.down()}jumpCell(){if(!this.isInTable_()||null===this.key_)return this.getFocus();if(this.moved===_l.ROW){this.moved=_l.CELL;const t=this.key_-ji.ZERO;return this.isLegalJump_(this.row_,t)?this.jumpCell_(this.row_,t):this.getFocus()}const t=this.key_-ji.ZERO;return t>this.currentTable_.childNodes.length?this.getFocus():(this.row_=t,this.moved=_l.ROW,this.getFocus().clone())}undo(){const t=super.undo();return t===this.firstJump&&(this.firstJump=null),t}eligibleCell_(){const t=this.getFocus().getSemanticPrimary();return this.modifier&&"cell"===t.type&&-1!==Rl.ELIGIBLE_CELL_ROLES.indexOf(t.role)}verticalMove_(t){const e=this.previousLevel();if(!e)return null;const n=this.getFocus(),r=this.levels.indexOf(this.primaryId()),s=this.levels.pop(),o=this.levels.indexOf(e),i=this.levels.get(t?o+1:o-1);if(!i)return this.levels.push(s),null;this.setFocus(this.singletonFocus(i));const c=this.nextLevel();return c[r]?(this.levels.push(c),this.singletonFocus(c[r])):(this.setFocus(n),this.levels.push(s),null)}jumpCell_(t,e){this.firstJump?this.virtualize(!1):(this.firstJump=this.getFocus(),this.virtualize(!0));const n=this.currentTable_.id.toString();let r;do{r=this.levels.pop()}while(-1===r.indexOf(n));this.levels.push(r),this.setFocus(this.singletonFocus(n)),this.levels.push(this.nextLevel());const s=this.currentTable_.childNodes[t-1];return this.setFocus(this.singletonFocus(s.id.toString())),this.levels.push(this.nextLevel()),this.singletonFocus(s.childNodes[e-1].id.toString())}isLegalJump_(t,e){const n=D(this.getRebuilt().xml,"id",this.currentTable_.id.toString())[0];if(!n||n.hasAttribute("alternative"))return!1;const r=this.currentTable_.childNodes[t-1];if(!r)return!1;const s=D(n,"id",r.id.toString())[0];return!(!s||s.hasAttribute("alternative"))&&!(!r||!r.childNodes[e-1])}isInTable_(){let t=this.getFocus().getSemanticPrimary();for(;t;){if(-1!==Rl.ELIGIBLE_TABLE_TYPES.indexOf(t.type))return this.currentTable_=t,!0;t=t.parent}return!1}}Rl.ELIGIBLE_CELL_ROLES=["determinant","rowvector","binomial","squarematrix","multiline","matrix","vector","cases","table"],Rl.ELIGIBLE_TABLE_TYPES=["multiline","matrix","vector","cases","table"];const vl={dummy:(t,e,n,r)=>new Ol(t,e,n,r),semantic:(t,e,n,r)=>new Ll(t,e,n,r),syntax:(t,e,n,r)=>new Ml(t,e,n,r),table:(t,e,n,r)=>new Rl(t,e,n,r)};class Fl{static stringify_(t){return t?t.toString():t}constructor(t,e){this.name=t,this.process=e.processor,this.postprocess=e.postprocessor||((t,e)=>t),this.processor=this.postprocess?function(t){return this.postprocess(this.process(t),t)}:this.process,this.print=e.print||Fl.stringify_,this.pprint=e.pprint||this.print}}Fl.LocalState={walker:null,speechGenerator:null,highlighter:null};class wl extends Fl{static getKey_(t){return"string"==typeof t?ji[t.toUpperCase()]:t}constructor(t,e){super(t,e),this.key=e.key||wl.getKey_}}const Dl=new Map;function Pl(t){Dl.set(t.name,t)}function kl(t){const e=Dl.get(t);if(!e)throw new m("Unknown processor "+t);return e}function Ul(t,e){const n=kl(t);try{return n.processor(e)}catch(t){throw new m("Processing error for expression "+e)}}function Bl(t,e){const n=kl(t);try{const t=n.processor(e);return N.getInstance().pprint?n.pprint(t):n.print(t)}catch(t){throw console.log(t),new m("Processing error for expression "+e)}}Pl(new Fl("semantic",{processor:function(t){return Zc(x(t))},postprocessor:function(t,e){const n=N.getInstance().speech;if(n===l.NONE)return t;const r=U(t);let s=el(r);if(n===l.SHALLOW)return t.setAttribute("speech",Lc(s)),t;const o=I(".//*[@id]",t),i=I(".//*[@id]",r);for(let t,e,n=0;t=o[n],e=i[n];n++)s=el(e),t.setAttribute("speech",Lc(s));return t},pprint:function(t){return F(t.toString())}})),Pl(new Fl("speech",{processor:function(t){return Lc(xc(tl(Zc(x(t)))))},pprint:function(t){const e=t.toString();return Oc.get(N.getInstance().markup)instanceof ic?F(e):e}})),Pl(new Fl("json",{processor:function(t){return Jc(x(t)).toJson()},postprocessor:function(t,e){const n=N.getInstance().speech;if(n===l.NONE)return t;const r=Zc(x(e)),s=el(r);if(n===l.SHALLOW)return t.stree.speech=Lc(s),t;const o=t=>{const e=el(I(`.//*[@id=${t.id}]`,r)[0]);t.speech=Lc(e),t.children&&t.children.forEach(o)};return o(t.stree),t},print:function(t){return JSON.stringify(t)},pprint:function(t){return JSON.stringify(t,null,2)}})),Pl(new Fl("description",{processor:function(t){return tl(Zc(x(t)))},print:function(t){return JSON.stringify(t)},pprint:function(t){return JSON.stringify(t,null,2)}})),Pl(new Fl("enriched",{processor:function(t){return Ua(t)},postprocessor:function(t,e){const n=za(t);let r;switch(N.getInstance().speech){case l.NONE:break;case l.SHALLOW:r=gl("Adhoc"),r.getSpeech(n,t);break;case l.DEEP:r=gl("Tree"),r.getSpeech(t,t)}return t},pprint:function(t){return F(t.toString())}})),Pl(new Fl("walker",{processor:function(t){const e=gl("Node");Fl.LocalState.speechGenerator=e,e.setOptions({modality:N.getInstance().modality,locale:N.getInstance().locale,domain:N.getInstance().domain,style:N.getInstance().style}),Fl.LocalState.highlighter=function(t,e,n){const r=new Ha(t,e),s="NativeMML"===n.renderer&&"Safari"===n.browser?"MML-CSS":"SVG"===n.renderer&&"v3"===n.browser?"SVG-V3":n.renderer,o=new(Wa[s]||Wa.NativeMML);return o.setColor(r),o}({color:"black"},{color:"white"},{renderer:"NativeMML"});const n=Ul("enriched",t),r=function(t,e){const n=kl(t);return N.getInstance().pprint?n.pprint(e):n.print(e)}("enriched",n);return Fl.LocalState.walker=function(t,e,n,r,s){return(vl[t.toLowerCase()]||vl.dummy)(e,n,r,s)}(N.getInstance().walker,n,e,Fl.LocalState.highlighter,r),Fl.LocalState.walker},print:function(t){return Fl.LocalState.walker.speech()}})),Pl(new wl("move",{processor:function(t){if(!Fl.LocalState.walker)return null;return!1===Fl.LocalState.walker.move(t)?function(t){const e=Oc.get(N.getInstance().markup);return e?e.error(t):""}(t):Fl.LocalState.walker.speech()}})),Pl(new Fl("number",{processor:function(t){const e=parseInt(t,10);return isNaN(e)?"":W.NUMBERS.numberToWords(e)}})),Pl(new Fl("ordinal",{processor:function(t){const e=parseInt(t,10);return isNaN(e)?"":W.NUMBERS.wordOrdinal(e)}})),Pl(new Fl("numericOrdinal",{processor:function(t){const e=parseInt(t,10);return isNaN(e)?"":W.NUMBERS.numericOrdinal(e)}})),Pl(new Fl("vulgar",{processor:function(t){const[e,n]=t.split("/").map((t=>parseInt(t,10)));return isNaN(e)||isNaN(n)?"":Ul("speech",`<mfrac><mn>${e}</mn><mn>${n}</mn></mfrac>`)}})),Pl(new Fl("latex",{processor:function(t){return"braille"===N.getInstance().modality&&"euro"===N.getInstance().locale||console.info("LaTeX input currently only works for Euro Braille output. Please use the latex-to-speech package from npm for general LaTeX input to SRE."),Ul("speech",`<math latex="${t}"></math>`)}}));var jl=function(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{a(r.next(t))}catch(t){o(t)}}function c(t){try{a(r.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,c)}a((r=r.apply(t,e||[])).next())}))};const $l=f.L.VERSION;function Gl(t){return jl(this,void 0,void 0,(function*(){return Gi(t)}))}function Vl(){const t=["mode"].concat(N.STRING_FEATURES,N.BINARY_FEATURES),e=N.getInstance(),n={};return t.forEach((function(t){n[t]=e[t]})),n.json=d.Z.jsonPath,n.xpath=d.Z.WGXpath,n.rules=e.ruleSets.slice(),n}function Hl(){return jl(this,void 0,void 0,(function*(){return Gl({}).then((()=>S.getall()))}))}const Yl=wi;function ql(t){return eu("speech",t)}function Wl(t){return eu("semantic",t)}function Xl(t){return eu("json",t)}function Kl(t){return eu("description",t)}function zl(t){return eu("enriched",t)}function Zl(t){return eu("number",t)}function Jl(t){return eu("ordinal",t)}function Ql(t){return eu("numericOrdinal",t)}function tu(t){return eu("vulgar",t)}function eu(t,e){return Ul(t,e)}const nu={};function ru(t,n,r){switch(N.getInstance().mode){case e.ASYNC:return function(t,e,n){return jl(this,void 0,void 0,(function*(){const r=yield d.Z.fs.promises.readFile(e,{encoding:"utf8"}),s=Bl(t,r);if(n)try{d.Z.fs.promises.writeFile(n,s)}catch(t){throw new m("Can not write to file: "+n)}return s}))}(t,n,r);case e.SYNC:return function(t,e,n){const r=function(t){let e;try{e=d.Z.fs.readFileSync(t,{encoding:"utf8"})}catch(e){throw new m("Can not open file: "+t)}return e}(e),s=Bl(t,r);if(n)try{d.Z.fs.writeFileSync(n,s)}catch(t){throw new m("Can not write to file: "+n)}return s}(t,n,r);default:throw new m(`Can process files in ${N.getInstance().mode} mode`)}}function su(t){return Bl("walker",t)}function ou(t){return function(t,e){const n=kl(t),r=n instanceof wl?n.key(e):e,s=n.processor(r);return N.getInstance().pprint?n.pprint(s):n.print(s)}("move",t)}function iu(t){const e=t||0;S.getall().then((()=>process.exit(e)))}nu.toSpeech=function(t,e){return ru("speech",t,e)},nu.toSemantic=function(t,e){return ru("semantic",t,e)},nu.toJson=function(t,e){return ru("json",t,e)},nu.toDescription=function(t,e){return ru("description",t,e)},nu.toEnriched=function(t,e){return ru("enriched",t,e)};const cu=Pe;d.Z.documentSupported?Gl({mode:e.HTTP}).then((()=>Gl({}))):Gl({mode:e.SYNC}).then((()=>Gl({mode:e.ASYNC})));var au=function(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{a(r.next(t))}catch(t){o(t)}}function c(t){try{a(r.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,c)}a((r=r.apply(t,e||[])).next())}))};const lu=class{constructor(){this.process=d.Z.extRequire("process"),this.setup={mode:e.SYNC},this.processors=[],this.output=this.process.stdout,this.dp=new d.Z.xmldom.DOMParser({errorHandler:(t,e)=>{throw new m("XML DOM error!")}})}set(t,e,n){this.setup[t]=void 0===e||e}processor(t){this.processors.push(t)}loadLocales(){return au(this,void 0,void 0,(function*(){for(const t of f.L.LOCALES.keys())yield Gl({locale:t})}))}enumerate(t=!1){return au(this,void 0,void 0,(function*(){const e=Gl(this.setup),n=o.DEFAULT_ORDER.slice(0,-1);return(t?this.loadLocales():e).then((()=>S.getall().then((()=>{const t=n.map((t=>t.length)),e=(e,n)=>{t[n]=Math.max.apply(null,Object.keys(e).map((t=>t.length)).concat(t[n]))},r=(t,e)=>t+new Array(e-t.length+1).join(" ");let s=Ai.getInstance().enumerate();s=An(s);const o=[];e(s,0);for(const[n,i]of Object.entries(s)){let c=!0;e(i,1);for(const[a,l]of Object.entries(i)){let i=!0;e(l,2);for(const[e,u]of Object.entries(l)){const l=Object.keys(u).sort();if("clearspeak"===e){let l=!0;const u=Sl.getLocalePreferences(s)[n];if(!u)continue;for(const s of Object.values(u))o.push([r(c?n:"",t[0]),r(i?a:"",t[1]),r(l?e:"",t[2]),s.join(", ")]),c=!1,i=!1,l=!1}else o.push([r(c?n:"",t[0]),r(i?a:"",t[1]),r(e,t[2]),l.join(", ")]);c=!1,i=!1}}}let i=0;const c=n.map((e=>r(e,t[i++]))),a=d.Z.commander.opts().pprint,l=t.map((t=>new Array(t+1).join(a?"-":"=")));a||(l[i-1]=l[i-1]+"========================"),o.unshift(l),o.unshift(c);let u=o.map((t=>t.join(" | ")));a&&(u=u.map((t=>`| ${t} |`)),u.unshift(`# Options SRE v${$l}\n`)),console.info(u.join("\n"))}))))}))}execute(t){S.getall().then((()=>{this.runProcessors_(((t,e)=>this.output.write(ru(t,e)+"\n")),t)}))}readline(){this.process.stdin.setEncoding("utf8");const t=d.Z.extRequire("readline").createInterface({input:this.process.stdin,output:this.output});let e="";t.on("line",(n=>{e+=n,this.readExpression_(e)&&t.close()}).bind(this)),t.on("close",(()=>{this.runProcessors_(((e,n)=>{t.output.write(Bl(e,n)+"\n")}),e),Hl().then((()=>p.getInstance().exit((()=>iu(0)))))}).bind(this))}commandLine(){return au(this,void 0,void 0,(function*(){const e=d.Z.commander,n=r,s=(t=>(e,n)=>this.set(t,e,n)).bind(this),i=this.processor.bind(this);e.version(n.version).usage("[options] <file ...>").option("-i, --input [name]","Input file [name]. (Deprecated)").option("-o, --output [name]","Output file [name]. Defaults to stdout.").option("-d, --domain [name]","Speech rule set [name]. See --options for details.",s(t.DOMAIN),o.DEFAULT_VALUES[t.DOMAIN]).option("-s, --style [name]","Speech style [name]. See --options for details.",s(t.STYLE),o.DEFAULT_VALUES[t.STYLE]).option("-c, --locale [code]","Locale [code].",s(t.LOCALE),o.DEFAULT_VALUES[t.LOCALE]).option("-b, --modality [name]","Modality [name].",s(t.MODALITY),o.DEFAULT_VALUES[t.MODALITY]).option("-k, --markup [name]","Generate speech output with markup tags.",s("markup"),"none").option("-e, --automark","Automatically set marks for external reference.",s("automark")).option("-r, --rate [value]","Base rate [value] for tagged speech output.",s("rate"),"100").option("-p, --speech","Generate speech output (default).",(()=>i("speech"))).option("-a, --audit","Generate auditory descriptions (JSON format).",(()=>i("description"))).option("-j, --json","Generate JSON of semantic tree.",(()=>i("json"))).option("-x, --xml","Generate XML of semantic tree.",(()=>i("semantic"))).option("-m, --mathml","Generate enriched MathML.",(()=>i("enriched"))).option("-t, --latex","Accepts LaTeX input for certain locale/modality combinations.",(()=>i("latex"))).option("-g, --generate <depth>","Include generated speech in enriched MathML (with -m option only).",s("speech"),"none").option("-w, --structure","Include structure attribute in enriched MathML (with -m option only).",s("structure")).option("-A, --aria","Include aria tree annotations MathML (with -m and -w option only).",s("aria")).option("-P, --pprint","Pretty print output whenever possible.",s("pprint")).option("-f, --rules [name]","Loads a local rule file [name].",s("rules")).option("-C, --subiso [name]","Supplementary country code (or similar) for the given locale.",s("subiso")).option("-N, --number","Translate number to word.",(()=>i("number"))).option("-O, --ordinal","Translate number to ordinal.",(()=>i("ordinal")),"ordinal").option("-S, --numeric","Translate number to numeric ordinal.",(()=>i("numericOrdinal"))).option("-F, --vulgar","Translate vulgar fraction to word. Provide vulgar fraction as slash seperated numbers.",(()=>i("vulgar"))).option("-v, --verbose","Verbose mode.").option("-l, --log [name]","Log file [name].").option("--opt","List engine setup options. Output as markdown with -P option.").option("--opt-all","List engine setup options for all available locales. Output as markdown with -P option.").on("option:opt",(()=>{this.enumerate().then((()=>iu(0)))})).on("option:opt-all",(()=>{this.enumerate(!0).then((()=>iu(0)))})).parse(this.process.argv),yield Hl().then((()=>Gl(this.setup)));const c=e.opts();c.output&&(this.output=d.Z.fs.createWriteStream(c.output)),c.verbose&&(yield p.getInstance().init(c.log)),c.input&&this.execute(c.input),e.args.length?(e.args.forEach(this.execute.bind(this)),Hl().then((()=>p.getInstance().exit((()=>iu(0)))))):this.readline()}))}runProcessors_(t,e){try{this.processors.length||this.processors.push("speech"),e&&this.processors.forEach((n=>t(n,e)))}catch(t){console.error(t.name+": "+t.message),p.getInstance().exit((()=>this.process.exit(1)))}}readExpression_(t){try{const e=t.replace(/(&|#|;)/g,"");this.dp.parseFromString(e,"text/xml")}catch(t){return!1}return!0}},uu=f.L})(),__webpack_exports__})()));